(function(){"use strict";var Au=(()=>{var t=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(t=t||__filename),function(r){r=r||{};var r=typeof r<"u"?r:{},n,o;r.ready=new Promise(function(i,a){n=i,o=a});var s=Object.assign({},r),u="./this.program",c=(i,a)=>{throw a},f=typeof window=="object",p=typeof importScripts=="function",g=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="";function m(i){return r.locateFile?r.locateFile(i,y):y+i}var S,E,k;function x(i){if(i instanceof Es)return;L("exiting due to exception: "+i)}var A,U,O;g?(p?y=require("path").dirname(y)+"/":y=__dirname+"/",O=()=>{U||(A=require("fs"),U=require("path"))},S=function(a,l){return O(),a=U.normalize(a),A.readFileSync(a,l?void 0:"utf8")},k=i=>{var a=S(i,!0);return a.buffer||(a=new Uint8Array(a)),a},E=(i,a,l)=>{O(),i=U.normalize(i),A.readFile(i,function(h,d){h?l(h):a(d.buffer)})},process.argv.length>1&&(u=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(i){if(!(i instanceof Es))throw i}),process.on("unhandledRejection",function(i){throw i}),c=(i,a)=>{if(eu())throw process.exitCode=i,a;x(a),process.exit(i)},r.inspect=function(){return"[Emscripten Module object]"}):(f||p)&&(p?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),t&&(y=t),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",S=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.send(null),a.responseText},p&&(k=i=>{var a=new XMLHttpRequest;return a.open("GET",i,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),E=(i,a,l)=>{var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{if(h.status==200||h.status==0&&h.response){a(h.response);return}l()},h.onerror=l,h.send(null)});var V=r.print||console.log.bind(console),L=r.printErr||console.warn.bind(console);Object.assign(r,s),s=null,r.arguments&&r.arguments,r.thisProgram&&(u=r.thisProgram),r.quit&&(c=r.quit);var j=4,$;r.wasmBinary&&($=r.wasmBinary);var X=r.noExitRuntime||!0;typeof WebAssembly!="object"&&Gt("no native wasm support detected");var te,ne=!1;function K(i,a){i||Gt(a)}var Le=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Re(i,a,l){for(var h=a+l,d=a;i[d]&&!(d>=h);)++d;if(d-a>16&&i.buffer&&Le)return Le.decode(i.subarray(a,d));for(var w="";a<d;){var b=i[a++];if(!(b&128)){w+=String.fromCharCode(b);continue}var _=i[a++]&63;if((b&224)==192){w+=String.fromCharCode((b&31)<<6|_);continue}var T=i[a++]&63;if((b&240)==224?b=(b&15)<<12|_<<6|T:b=(b&7)<<18|_<<12|T<<6|i[a++]&63,b<65536)w+=String.fromCharCode(b);else{var P=b-65536;w+=String.fromCharCode(55296|P>>10,56320|P&1023)}}return w}function oe(i,a){return i?Re(We,i,a):""}function ye(i,a,l,h){if(!(h>0))return 0;for(var d=l,w=l+h-1,b=0;b<i.length;++b){var _=i.charCodeAt(b);if(_>=55296&&_<=57343){var T=i.charCodeAt(++b);_=65536+((_&1023)<<10)|T&1023}if(_<=127){if(l>=w)break;a[l++]=_}else if(_<=2047){if(l+1>=w)break;a[l++]=192|_>>6,a[l++]=128|_&63}else if(_<=65535){if(l+2>=w)break;a[l++]=224|_>>12,a[l++]=128|_>>6&63,a[l++]=128|_&63}else{if(l+3>=w)break;a[l++]=240|_>>18,a[l++]=128|_>>12&63,a[l++]=128|_>>6&63,a[l++]=128|_&63}}return a[l]=0,l-d}function Te(i,a,l){return ye(i,We,a,l)}function he(i){for(var a=0,l=0;l<i.length;++l){var h=i.charCodeAt(l);h>=55296&&h<=57343&&(h=65536+((h&1023)<<10)|i.charCodeAt(++l)&1023),h<=127?++a:h<=2047?a+=2:h<=65535?a+=3:a+=4}return a}var se=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function de(i,a){for(var l=i,h=l>>1,d=h+a/2;!(h>=d)&&Xr[h];)++h;if(l=h<<1,l-i>32&&se)return se.decode(We.subarray(i,l));for(var w="",b=0;!(b>=a/2);++b){var _=It[i+b*2>>1];if(_==0)break;w+=String.fromCharCode(_)}return w}function we(i,a,l){if(l===void 0&&(l=2147483647),l<2)return 0;l-=2;for(var h=a,d=l<i.length*2?l/2:i.length,w=0;w<d;++w){var b=i.charCodeAt(w);It[a>>1]=b,a+=2}return It[a>>1]=0,a-h}function pe(i){return i.length*2}function Me(i,a){for(var l=0,h="";!(l>=a/4);){var d=F[i+l*4>>2];if(d==0)break;if(++l,d>=65536){var w=d-65536;h+=String.fromCharCode(55296|w>>10,56320|w&1023)}else h+=String.fromCharCode(d)}return h}function Vr(i,a,l){if(l===void 0&&(l=2147483647),l<4)return 0;for(var h=a,d=h+l-4,w=0;w<i.length;++w){var b=i.charCodeAt(w);if(b>=55296&&b<=57343){var _=i.charCodeAt(++w);b=65536+((b&1023)<<10)|_&1023}if(F[a>>2]=b,a+=4,a+4>d)break}return F[a>>2]=0,a-h}function ss(i){for(var a=0,l=0;l<i.length;++l){var h=i.charCodeAt(l);h>=55296&&h<=57343&&++l,a+=4}return a}function Wn(i){var a=he(i)+1,l=xt(a);return l&&ye(i,Ne,l,a),l}function Yr(i,a){Ne.set(i,a)}function Vn(i,a,l){for(var h=0;h<i.length;++h)Ne[a++>>0]=i.charCodeAt(h);l||(Ne[a>>0]=0)}var bt,Ne,We,It,Xr,F,ie,at,qa;function ja(i){bt=i,r.HEAP8=Ne=new Int8Array(i),r.HEAP16=It=new Int16Array(i),r.HEAP32=F=new Int32Array(i),r.HEAPU8=We=new Uint8Array(i),r.HEAPU16=Xr=new Uint16Array(i),r.HEAPU32=ie=new Uint32Array(i),r.HEAPF32=at=new Float32Array(i),r.HEAPF64=qa=new Float64Array(i)}r.INITIAL_MEMORY;var Za,Ka=[],Qa=[],Ja=[];function eu(){return X}function fd(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)dd(r.preRun.shift());as(Ka)}function hd(){!r.noFSInit&&!v.init.initialized&&v.init(),v.ignorePermissions=!1,as(Qa)}function pd(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)gd(r.postRun.shift());as(Ja)}function dd(i){Ka.unshift(i)}function vd(i){Qa.unshift(i)}function gd(i){Ja.unshift(i)}var jt=0,$r=null;function $g(i){return i}function is(i){jt++,r.monitorRunDependencies&&r.monitorRunDependencies(jt)}function Yn(i){if(jt--,r.monitorRunDependencies&&r.monitorRunDependencies(jt),jt==0&&$r){var a=$r;$r=null,a()}}function Gt(i){r.onAbort&&r.onAbort(i),i="Aborted("+i+")",L(i),ne=!0,i+=". Build with -sASSERTIONS for more info.";var a=new WebAssembly.RuntimeError(i);throw o(a),a}var md="data:application/octet-stream;base64,";function tu(i){return i.startsWith(md)}function ru(i){return i.startsWith("file://")}var $e;$e="replicad_single.wasm",tu($e)||($e=m($e));function nu(i){try{if(i==$e&&$)return new Uint8Array($);if(k)return k(i);throw"both async and sync fetching of the wasm failed"}catch(a){Gt(a)}}function yd(){if(!$&&(f||p)){if(typeof fetch=="function"&&!ru($e))return fetch($e,{credentials:"same-origin"}).then(function(i){if(!i.ok)throw"failed to load wasm binary file at '"+$e+"'";return i.arrayBuffer()}).catch(function(){return nu($e)});if(E)return new Promise(function(i,a){E($e,function(l){i(new Uint8Array(l))},a)})}return Promise.resolve().then(function(){return nu($e)})}function wd(){var i={a:Wg};function a(b,_){var T=b.exports;r.asm=T,te=r.asm.oa,ja(te.buffer),Za=r.asm.va,vd(r.asm.pa),Yn()}is();function l(b){a(b.instance)}function h(b){return yd().then(function(_){return WebAssembly.instantiate(_,i)}).then(function(_){return _}).then(b,function(_){L("failed to asynchronously prepare wasm: "+_),Gt(_)})}function d(){return!$&&typeof WebAssembly.instantiateStreaming=="function"&&!tu($e)&&!ru($e)&&!g&&typeof fetch=="function"?fetch($e,{credentials:"same-origin"}).then(function(b){var _=WebAssembly.instantiateStreaming(b,i);return _.then(l,function(T){return L("wasm streaming compile failed: "+T),L("falling back to ArrayBuffer instantiation"),h(l)})}):h(l)}if(r.instantiateWasm)try{var w=r.instantiateWasm(i,a);return w}catch(b){return L("Module.instantiateWasm callback failed with error: "+b),!1}return d().catch(o),{}}var Ie,St;function bd(){return r.HEAP8.length}function as(i){for(;i.length>0;){var a=i.shift();if(typeof a=="function"){a(r);continue}var l=a.func;typeof l=="number"?a.arg===void 0?$n(l)():$n(l)(a.arg):l(a.arg===void 0?null:a.arg)}}var Xn=[];function $n(i){var a=Xn[i];return a||(i>=Xn.length&&(Xn.length=i+1),Xn[i]=a=Za.get(i)),a}function Sd(i,a,l,h){Gt("Assertion failed: "+oe(i)+", at: "+[a?oe(a):"unknown filename",l,h?oe(h):"unknown function"])}function _d(i){return xt(i+24)+24}function Ed(i){this.excPtr=i,this.ptr=i-24,this.set_type=function(a){ie[this.ptr+4>>2]=a},this.get_type=function(){return ie[this.ptr+4>>2]},this.set_destructor=function(a){ie[this.ptr+8>>2]=a},this.get_destructor=function(){return ie[this.ptr+8>>2]},this.set_refcount=function(a){F[this.ptr>>2]=a},this.set_caught=function(a){a=a?1:0,Ne[this.ptr+12>>0]=a},this.get_caught=function(){return Ne[this.ptr+12>>0]!=0},this.set_rethrown=function(a){a=a?1:0,Ne[this.ptr+13>>0]=a},this.get_rethrown=function(){return Ne[this.ptr+13>>0]!=0},this.init=function(a,l){this.set_adjusted_ptr(0),this.set_type(a),this.set_destructor(l),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var a=F[this.ptr>>2];F[this.ptr>>2]=a+1},this.release_ref=function(){var a=F[this.ptr>>2];return F[this.ptr>>2]=a-1,a===1},this.set_adjusted_ptr=function(a){ie[this.ptr+16>>2]=a},this.get_adjusted_ptr=function(){return ie[this.ptr+16>>2]},this.get_exception_ptr=function(){var a=Pu(this.get_type());if(a)return ie[this.excPtr>>2];var l=this.get_adjusted_ptr();return l!==0?l:this.excPtr}}function Td(i,a,l){var h=new Ed(i);throw h.init(a,l),i}var ue={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return a.exec(i).slice(1)},normalizeArray:(i,a)=>{for(var l=0,h=i.length-1;h>=0;h--){var d=i[h];d==="."?i.splice(h,1):d===".."?(i.splice(h,1),l++):l&&(i.splice(h,1),l--)}if(a)for(;l;l--)i.unshift("..");return i},normalize:i=>{var a=ue.isAbs(i),l=i.substr(-1)==="/";return i=ue.normalizeArray(i.split("/").filter(h=>!!h),!a).join("/"),!i&&!a&&(i="."),i&&l&&(i+="/"),(a?"/":"")+i},dirname:i=>{var a=ue.splitPath(i),l=a[0],h=a[1];return!l&&!h?".":(h&&(h=h.substr(0,h.length-1)),l+h)},basename:i=>{if(i==="/")return"/";i=ue.normalize(i),i=i.replace(/\/$/,"");var a=i.lastIndexOf("/");return a===-1?i:i.substr(a+1)},join:function(){var i=Array.prototype.slice.call(arguments,0);return ue.normalize(i.join("/"))},join2:(i,a)=>ue.normalize(i+"/"+a)};function xd(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var i=new Uint8Array(1);return function(){return crypto.getRandomValues(i),i[0]}}else if(g)try{var a=require("crypto");return function(){return a.randomBytes(1)[0]}}catch{}return function(){Gt("randomDevice")}}var _t={resolve:function(){for(var i="",a=!1,l=arguments.length-1;l>=-1&&!a;l--){var h=l>=0?arguments[l]:v.cwd();if(typeof h!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!h)return"";i=h+"/"+i,a=ue.isAbs(h)}return i=ue.normalizeArray(i.split("/").filter(d=>!!d),!a).join("/"),(a?"/":"")+i||"."},relative:(i,a)=>{i=_t.resolve(i).substr(1),a=_t.resolve(a).substr(1);function l(P){for(var B=0;B<P.length&&P[B]==="";B++);for(var M=P.length-1;M>=0&&P[M]==="";M--);return B>M?[]:P.slice(B,M-B+1)}for(var h=l(i.split("/")),d=l(a.split("/")),w=Math.min(h.length,d.length),b=w,_=0;_<w;_++)if(h[_]!==d[_]){b=_;break}for(var T=[],_=b;_<h.length;_++)T.push("..");return T=T.concat(d.slice(b)),T.join("/")}},Zt={ttys:[],init:function(){},shutdown:function(){},register:function(i,a){Zt.ttys[i]={input:[],output:[],ops:a},v.registerDevice(i,Zt.stream_ops)},stream_ops:{open:function(i){var a=Zt.ttys[i.node.rdev];if(!a)throw new v.ErrnoError(43);i.tty=a,i.seekable=!1},close:function(i){i.tty.ops.flush(i.tty)},flush:function(i){i.tty.ops.flush(i.tty)},read:function(i,a,l,h,d){if(!i.tty||!i.tty.ops.get_char)throw new v.ErrnoError(60);for(var w=0,b=0;b<h;b++){var _;try{_=i.tty.ops.get_char(i.tty)}catch{throw new v.ErrnoError(29)}if(_===void 0&&w===0)throw new v.ErrnoError(6);if(_==null)break;w++,a[l+b]=_}return w&&(i.node.timestamp=Date.now()),w},write:function(i,a,l,h,d){if(!i.tty||!i.tty.ops.put_char)throw new v.ErrnoError(60);try{for(var w=0;w<h;w++)i.tty.ops.put_char(i.tty,a[l+w])}catch{throw new v.ErrnoError(29)}return h&&(i.node.timestamp=Date.now()),w}},default_tty_ops:{get_char:function(i){if(!i.input.length){var a=null;if(g){var l=256,h=Buffer.alloc(l),d=0;try{d=A.readSync(process.stdin.fd,h,0,l,-1)}catch(w){if(w.toString().includes("EOF"))d=0;else throw w}d>0?a=h.slice(0,d).toString("utf-8"):a=null}else typeof window<"u"&&typeof window.prompt=="function"?(a=window.prompt("Input: "),a!==null&&(a+=`
`)):typeof readline=="function"&&(a=readline(),a!==null&&(a+=`
`));if(!a)return null;i.input=uo(a,!0)}return i.input.shift()},put_char:function(i,a){a===null||a===10?(V(Re(i.output,0)),i.output=[]):a!=0&&i.output.push(a)},flush:function(i){i.output&&i.output.length>0&&(V(Re(i.output,0)),i.output=[])}},default_tty1_ops:{put_char:function(i,a){a===null||a===10?(L(Re(i.output,0)),i.output=[]):a!=0&&i.output.push(a)},flush:function(i){i.output&&i.output.length>0&&(L(Re(i.output,0)),i.output=[])}}};function kd(i,a){We.fill(0,i,i+a)}function Cd(i,a){return Math.ceil(i/a)*a}function ou(i){i=Cd(i,65536);var a=Cu(65536,i);return a?(kd(a,i),a):0}var J={ops_table:null,mount:function(i){return J.createNode(null,"/",16895,0)},createNode:function(i,a,l,h){if(v.isBlkdev(l)||v.isFIFO(l))throw new v.ErrnoError(63);J.ops_table||(J.ops_table={dir:{node:{getattr:J.node_ops.getattr,setattr:J.node_ops.setattr,lookup:J.node_ops.lookup,mknod:J.node_ops.mknod,rename:J.node_ops.rename,unlink:J.node_ops.unlink,rmdir:J.node_ops.rmdir,readdir:J.node_ops.readdir,symlink:J.node_ops.symlink},stream:{llseek:J.stream_ops.llseek}},file:{node:{getattr:J.node_ops.getattr,setattr:J.node_ops.setattr},stream:{llseek:J.stream_ops.llseek,read:J.stream_ops.read,write:J.stream_ops.write,allocate:J.stream_ops.allocate,mmap:J.stream_ops.mmap,msync:J.stream_ops.msync}},link:{node:{getattr:J.node_ops.getattr,setattr:J.node_ops.setattr,readlink:J.node_ops.readlink},stream:{}},chrdev:{node:{getattr:J.node_ops.getattr,setattr:J.node_ops.setattr},stream:v.chrdev_stream_ops}});var d=v.createNode(i,a,l,h);return v.isDir(d.mode)?(d.node_ops=J.ops_table.dir.node,d.stream_ops=J.ops_table.dir.stream,d.contents={}):v.isFile(d.mode)?(d.node_ops=J.ops_table.file.node,d.stream_ops=J.ops_table.file.stream,d.usedBytes=0,d.contents=null):v.isLink(d.mode)?(d.node_ops=J.ops_table.link.node,d.stream_ops=J.ops_table.link.stream):v.isChrdev(d.mode)&&(d.node_ops=J.ops_table.chrdev.node,d.stream_ops=J.ops_table.chrdev.stream),d.timestamp=Date.now(),i&&(i.contents[a]=d,i.timestamp=d.timestamp),d},getFileDataAsTypedArray:function(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage:function(i,a){var l=i.contents?i.contents.length:0;if(!(l>=a)){var h=1024*1024;a=Math.max(a,l*(l<h?2:1.125)>>>0),l!=0&&(a=Math.max(a,256));var d=i.contents;i.contents=new Uint8Array(a),i.usedBytes>0&&i.contents.set(d.subarray(0,i.usedBytes),0)}},resizeFileStorage:function(i,a){if(i.usedBytes!=a)if(a==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(a),l&&i.contents.set(l.subarray(0,Math.min(a,i.usedBytes))),i.usedBytes=a}},node_ops:{getattr:function(i){var a={};return a.dev=v.isChrdev(i.mode)?i.id:1,a.ino=i.id,a.mode=i.mode,a.nlink=1,a.uid=0,a.gid=0,a.rdev=i.rdev,v.isDir(i.mode)?a.size=4096:v.isFile(i.mode)?a.size=i.usedBytes:v.isLink(i.mode)?a.size=i.link.length:a.size=0,a.atime=new Date(i.timestamp),a.mtime=new Date(i.timestamp),a.ctime=new Date(i.timestamp),a.blksize=4096,a.blocks=Math.ceil(a.size/a.blksize),a},setattr:function(i,a){a.mode!==void 0&&(i.mode=a.mode),a.timestamp!==void 0&&(i.timestamp=a.timestamp),a.size!==void 0&&J.resizeFileStorage(i,a.size)},lookup:function(i,a){throw v.genericErrors[44]},mknod:function(i,a,l,h){return J.createNode(i,a,l,h)},rename:function(i,a,l){if(v.isDir(i.mode)){var h;try{h=v.lookupNode(a,l)}catch{}if(h)for(var d in h.contents)throw new v.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,a.contents[l]=i,a.timestamp=i.parent.timestamp,i.parent=a},unlink:function(i,a){delete i.contents[a],i.timestamp=Date.now()},rmdir:function(i,a){var l=v.lookupNode(i,a);for(var h in l.contents)throw new v.ErrnoError(55);delete i.contents[a],i.timestamp=Date.now()},readdir:function(i){var a=[".",".."];for(var l in i.contents)i.contents.hasOwnProperty(l)&&a.push(l);return a},symlink:function(i,a,l){var h=J.createNode(i,a,41471,0);return h.link=l,h},readlink:function(i){if(!v.isLink(i.mode))throw new v.ErrnoError(28);return i.link}},stream_ops:{read:function(i,a,l,h,d){var w=i.node.contents;if(d>=i.node.usedBytes)return 0;var b=Math.min(i.node.usedBytes-d,h);if(b>8&&w.subarray)a.set(w.subarray(d,d+b),l);else for(var _=0;_<b;_++)a[l+_]=w[d+_];return b},write:function(i,a,l,h,d,w){if(a.buffer===Ne.buffer&&(w=!1),!h)return 0;var b=i.node;if(b.timestamp=Date.now(),a.subarray&&(!b.contents||b.contents.subarray)){if(w)return b.contents=a.subarray(l,l+h),b.usedBytes=h,h;if(b.usedBytes===0&&d===0)return b.contents=a.slice(l,l+h),b.usedBytes=h,h;if(d+h<=b.usedBytes)return b.contents.set(a.subarray(l,l+h),d),h}if(J.expandFileStorage(b,d+h),b.contents.subarray&&a.subarray)b.contents.set(a.subarray(l,l+h),d);else for(var _=0;_<h;_++)b.contents[d+_]=a[l+_];return b.usedBytes=Math.max(b.usedBytes,d+h),h},llseek:function(i,a,l){var h=a;if(l===1?h+=i.position:l===2&&v.isFile(i.node.mode)&&(h+=i.node.usedBytes),h<0)throw new v.ErrnoError(28);return h},allocate:function(i,a,l){J.expandFileStorage(i.node,a+l),i.node.usedBytes=Math.max(i.node.usedBytes,a+l)},mmap:function(i,a,l,h,d){if(!v.isFile(i.node.mode))throw new v.ErrnoError(43);var w,b,_=i.node.contents;if(!(d&2)&&_.buffer===bt)b=!1,w=_.byteOffset;else{if((l>0||l+a<_.length)&&(_.subarray?_=_.subarray(l,l+a):_=Array.prototype.slice.call(_,l,l+a)),b=!0,w=ou(a),!w)throw new v.ErrnoError(48);Ne.set(_,w)}return{ptr:w,allocated:b}},msync:function(i,a,l,h,d){if(!v.isFile(i.node.mode))throw new v.ErrnoError(43);return d&2||J.stream_ops.write(i,a,0,h,l,!1),0}}};function Pd(i,a,l,h){var d=h?"":"al "+i;E(i,function(w){K(w,'Loading data file "'+i+'" failed (no arrayBuffer).'),a(new Uint8Array(w)),d&&Yn()},function(w){if(l)l();else throw'Loading data file "'+i+'" failed.'}),d&&is()}var v={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(i,a={})=>{if(i=_t.resolve(v.cwd(),i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(a=Object.assign(l,a),a.recurse_count>8)throw new v.ErrnoError(32);for(var h=ue.normalizeArray(i.split("/").filter(M=>!!M),!1),d=v.root,w="/",b=0;b<h.length;b++){var _=b===h.length-1;if(_&&a.parent)break;if(d=v.lookupNode(d,h[b]),w=ue.join2(w,h[b]),v.isMountpoint(d)&&(!_||_&&a.follow_mount)&&(d=d.mounted.root),!_||a.follow)for(var T=0;v.isLink(d.mode);){var P=v.readlink(w);w=_t.resolve(ue.dirname(w),P);var B=v.lookupPath(w,{recurse_count:a.recurse_count+1});if(d=B.node,T++>40)throw new v.ErrnoError(32)}}return{path:w,node:d}},getPath:i=>{for(var a;;){if(v.isRoot(i)){var l=i.mount.mountpoint;return a?l[l.length-1]!=="/"?l+"/"+a:l+a:l}a=a?i.name+"/"+a:i.name,i=i.parent}},hashName:(i,a)=>{for(var l=0,h=0;h<a.length;h++)l=(l<<5)-l+a.charCodeAt(h)|0;return(i+l>>>0)%v.nameTable.length},hashAddNode:i=>{var a=v.hashName(i.parent.id,i.name);i.name_next=v.nameTable[a],v.nameTable[a]=i},hashRemoveNode:i=>{var a=v.hashName(i.parent.id,i.name);if(v.nameTable[a]===i)v.nameTable[a]=i.name_next;else for(var l=v.nameTable[a];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode:(i,a)=>{var l=v.mayLookup(i);if(l)throw new v.ErrnoError(l,i);for(var h=v.hashName(i.id,a),d=v.nameTable[h];d;d=d.name_next){var w=d.name;if(d.parent.id===i.id&&w===a)return d}return v.lookup(i,a)},createNode:(i,a,l,h)=>{var d=new v.FSNode(i,a,l,h);return v.hashAddNode(d),d},destroyNode:i=>{v.hashRemoveNode(i)},isRoot:i=>i===i.parent,isMountpoint:i=>!!i.mounted,isFile:i=>(i&61440)===32768,isDir:i=>(i&61440)===16384,isLink:i=>(i&61440)===40960,isChrdev:i=>(i&61440)===8192,isBlkdev:i=>(i&61440)===24576,isFIFO:i=>(i&61440)===4096,isSocket:i=>(i&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:i=>{var a=v.flagModes[i];if(typeof a>"u")throw new Error("Unknown file open mode: "+i);return a},flagsToPermissionString:i=>{var a=["r","w","rw"][i&3];return i&512&&(a+="w"),a},nodePermissions:(i,a)=>v.ignorePermissions?0:a.includes("r")&&!(i.mode&292)||a.includes("w")&&!(i.mode&146)||a.includes("x")&&!(i.mode&73)?2:0,mayLookup:i=>{var a=v.nodePermissions(i,"x");return a||(i.node_ops.lookup?0:2)},mayCreate:(i,a)=>{try{var l=v.lookupNode(i,a);return 20}catch{}return v.nodePermissions(i,"wx")},mayDelete:(i,a,l)=>{var h;try{h=v.lookupNode(i,a)}catch(w){return w.errno}var d=v.nodePermissions(i,"wx");if(d)return d;if(l){if(!v.isDir(h.mode))return 54;if(v.isRoot(h)||v.getPath(h)===v.cwd())return 10}else if(v.isDir(h.mode))return 31;return 0},mayOpen:(i,a)=>i?v.isLink(i.mode)?32:v.isDir(i.mode)&&(v.flagsToPermissionString(a)!=="r"||a&512)?31:v.nodePermissions(i,v.flagsToPermissionString(a)):44,MAX_OPEN_FDS:4096,nextfd:(i=0,a=v.MAX_OPEN_FDS)=>{for(var l=i;l<=a;l++)if(!v.streams[l])return l;throw new v.ErrnoError(33)},getStream:i=>v.streams[i],createStream:(i,a,l)=>{v.FSStream||(v.FSStream=function(){this.shared={}},v.FSStream.prototype={},Object.defineProperties(v.FSStream.prototype,{object:{get:function(){return this.node},set:function(d){this.node=d}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(d){this.shared.flags=d}},position:{get:function(){return this.shared.position},set:function(d){this.shared.position=d}}})),i=Object.assign(new v.FSStream,i);var h=v.nextfd(a,l);return i.fd=h,v.streams[h]=i,i},closeStream:i=>{v.streams[i]=null},chrdev_stream_ops:{open:i=>{var a=v.getDevice(i.node.rdev);i.stream_ops=a.stream_ops,i.stream_ops.open&&i.stream_ops.open(i)},llseek:()=>{throw new v.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,a)=>i<<8|a,registerDevice:(i,a)=>{v.devices[i]={stream_ops:a}},getDevice:i=>v.devices[i],getMounts:i=>{for(var a=[],l=[i];l.length;){var h=l.pop();a.push(h),l.push.apply(l,h.mounts)}return a},syncfs:(i,a)=>{typeof i=="function"&&(a=i,i=!1),v.syncFSRequests++,v.syncFSRequests>1&&L("warning: "+v.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var l=v.getMounts(v.root.mount),h=0;function d(b){return v.syncFSRequests--,a(b)}function w(b){if(b)return w.errored?void 0:(w.errored=!0,d(b));++h>=l.length&&d(null)}l.forEach(b=>{if(!b.type.syncfs)return w(null);b.type.syncfs(b,i,w)})},mount:(i,a,l)=>{var h=l==="/",d=!l,w;if(h&&v.root)throw new v.ErrnoError(10);if(!h&&!d){var b=v.lookupPath(l,{follow_mount:!1});if(l=b.path,w=b.node,v.isMountpoint(w))throw new v.ErrnoError(10);if(!v.isDir(w.mode))throw new v.ErrnoError(54)}var _={type:i,opts:a,mountpoint:l,mounts:[]},T=i.mount(_);return T.mount=_,_.root=T,h?v.root=T:w&&(w.mounted=_,w.mount&&w.mount.mounts.push(_)),T},unmount:i=>{var a=v.lookupPath(i,{follow_mount:!1});if(!v.isMountpoint(a.node))throw new v.ErrnoError(28);var l=a.node,h=l.mounted,d=v.getMounts(h);Object.keys(v.nameTable).forEach(b=>{for(var _=v.nameTable[b];_;){var T=_.name_next;d.includes(_.mount)&&v.destroyNode(_),_=T}}),l.mounted=null;var w=l.mount.mounts.indexOf(h);l.mount.mounts.splice(w,1)},lookup:(i,a)=>i.node_ops.lookup(i,a),mknod:(i,a,l)=>{var h=v.lookupPath(i,{parent:!0}),d=h.node,w=ue.basename(i);if(!w||w==="."||w==="..")throw new v.ErrnoError(28);var b=v.mayCreate(d,w);if(b)throw new v.ErrnoError(b);if(!d.node_ops.mknod)throw new v.ErrnoError(63);return d.node_ops.mknod(d,w,a,l)},create:(i,a)=>(a=a!==void 0?a:438,a&=4095,a|=32768,v.mknod(i,a,0)),mkdir:(i,a)=>(a=a!==void 0?a:511,a&=1023,a|=16384,v.mknod(i,a,0)),mkdirTree:(i,a)=>{for(var l=i.split("/"),h="",d=0;d<l.length;++d)if(l[d]){h+="/"+l[d];try{v.mkdir(h,a)}catch(w){if(w.errno!=20)throw w}}},mkdev:(i,a,l)=>(typeof l>"u"&&(l=a,a=438),a|=8192,v.mknod(i,a,l)),symlink:(i,a)=>{if(!_t.resolve(i))throw new v.ErrnoError(44);var l=v.lookupPath(a,{parent:!0}),h=l.node;if(!h)throw new v.ErrnoError(44);var d=ue.basename(a),w=v.mayCreate(h,d);if(w)throw new v.ErrnoError(w);if(!h.node_ops.symlink)throw new v.ErrnoError(63);return h.node_ops.symlink(h,d,i)},rename:(i,a)=>{var l=ue.dirname(i),h=ue.dirname(a),d=ue.basename(i),w=ue.basename(a),b,_,T;if(b=v.lookupPath(i,{parent:!0}),_=b.node,b=v.lookupPath(a,{parent:!0}),T=b.node,!_||!T)throw new v.ErrnoError(44);if(_.mount!==T.mount)throw new v.ErrnoError(75);var P=v.lookupNode(_,d),B=_t.relative(i,h);if(B.charAt(0)!==".")throw new v.ErrnoError(28);if(B=_t.relative(a,l),B.charAt(0)!==".")throw new v.ErrnoError(55);var M;try{M=v.lookupNode(T,w)}catch{}if(P!==M){var D=v.isDir(P.mode),I=v.mayDelete(_,d,D);if(I)throw new v.ErrnoError(I);if(I=M?v.mayDelete(T,w,D):v.mayCreate(T,w),I)throw new v.ErrnoError(I);if(!_.node_ops.rename)throw new v.ErrnoError(63);if(v.isMountpoint(P)||M&&v.isMountpoint(M))throw new v.ErrnoError(10);if(T!==_&&(I=v.nodePermissions(_,"w"),I))throw new v.ErrnoError(I);v.hashRemoveNode(P);try{_.node_ops.rename(P,T,w)}catch(Y){throw Y}finally{v.hashAddNode(P)}}},rmdir:i=>{var a=v.lookupPath(i,{parent:!0}),l=a.node,h=ue.basename(i),d=v.lookupNode(l,h),w=v.mayDelete(l,h,!0);if(w)throw new v.ErrnoError(w);if(!l.node_ops.rmdir)throw new v.ErrnoError(63);if(v.isMountpoint(d))throw new v.ErrnoError(10);l.node_ops.rmdir(l,h),v.destroyNode(d)},readdir:i=>{var a=v.lookupPath(i,{follow:!0}),l=a.node;if(!l.node_ops.readdir)throw new v.ErrnoError(54);return l.node_ops.readdir(l)},unlink:i=>{var a=v.lookupPath(i,{parent:!0}),l=a.node;if(!l)throw new v.ErrnoError(44);var h=ue.basename(i),d=v.lookupNode(l,h),w=v.mayDelete(l,h,!1);if(w)throw new v.ErrnoError(w);if(!l.node_ops.unlink)throw new v.ErrnoError(63);if(v.isMountpoint(d))throw new v.ErrnoError(10);l.node_ops.unlink(l,h),v.destroyNode(d)},readlink:i=>{var a=v.lookupPath(i),l=a.node;if(!l)throw new v.ErrnoError(44);if(!l.node_ops.readlink)throw new v.ErrnoError(28);return _t.resolve(v.getPath(l.parent),l.node_ops.readlink(l))},stat:(i,a)=>{var l=v.lookupPath(i,{follow:!a}),h=l.node;if(!h)throw new v.ErrnoError(44);if(!h.node_ops.getattr)throw new v.ErrnoError(63);return h.node_ops.getattr(h)},lstat:i=>v.stat(i,!0),chmod:(i,a,l)=>{var h;if(typeof i=="string"){var d=v.lookupPath(i,{follow:!l});h=d.node}else h=i;if(!h.node_ops.setattr)throw new v.ErrnoError(63);h.node_ops.setattr(h,{mode:a&4095|h.mode&-4096,timestamp:Date.now()})},lchmod:(i,a)=>{v.chmod(i,a,!0)},fchmod:(i,a)=>{var l=v.getStream(i);if(!l)throw new v.ErrnoError(8);v.chmod(l.node,a)},chown:(i,a,l,h)=>{var d;if(typeof i=="string"){var w=v.lookupPath(i,{follow:!h});d=w.node}else d=i;if(!d.node_ops.setattr)throw new v.ErrnoError(63);d.node_ops.setattr(d,{timestamp:Date.now()})},lchown:(i,a,l)=>{v.chown(i,a,l,!0)},fchown:(i,a,l)=>{var h=v.getStream(i);if(!h)throw new v.ErrnoError(8);v.chown(h.node,a,l)},truncate:(i,a)=>{if(a<0)throw new v.ErrnoError(28);var l;if(typeof i=="string"){var h=v.lookupPath(i,{follow:!0});l=h.node}else l=i;if(!l.node_ops.setattr)throw new v.ErrnoError(63);if(v.isDir(l.mode))throw new v.ErrnoError(31);if(!v.isFile(l.mode))throw new v.ErrnoError(28);var d=v.nodePermissions(l,"w");if(d)throw new v.ErrnoError(d);l.node_ops.setattr(l,{size:a,timestamp:Date.now()})},ftruncate:(i,a)=>{var l=v.getStream(i);if(!l)throw new v.ErrnoError(8);if(!(l.flags&2097155))throw new v.ErrnoError(28);v.truncate(l.node,a)},utime:(i,a,l)=>{var h=v.lookupPath(i,{follow:!0}),d=h.node;d.node_ops.setattr(d,{timestamp:Math.max(a,l)})},open:(i,a,l)=>{if(i==="")throw new v.ErrnoError(44);a=typeof a=="string"?v.modeStringToFlags(a):a,l=typeof l>"u"?438:l,a&64?l=l&4095|32768:l=0;var h;if(typeof i=="object")h=i;else{i=ue.normalize(i);try{var d=v.lookupPath(i,{follow:!(a&131072)});h=d.node}catch{}}var w=!1;if(a&64)if(h){if(a&128)throw new v.ErrnoError(20)}else h=v.mknod(i,l,0),w=!0;if(!h)throw new v.ErrnoError(44);if(v.isChrdev(h.mode)&&(a&=-513),a&65536&&!v.isDir(h.mode))throw new v.ErrnoError(54);if(!w){var b=v.mayOpen(h,a);if(b)throw new v.ErrnoError(b)}a&512&&!w&&v.truncate(h,0),a&=-131713;var _=v.createStream({node:h,path:v.getPath(h),flags:a,seekable:!0,position:0,stream_ops:h.stream_ops,ungotten:[],error:!1});return _.stream_ops.open&&_.stream_ops.open(_),r.logReadFiles&&!(a&1)&&(v.readFiles||(v.readFiles={}),i in v.readFiles||(v.readFiles[i]=1)),_},close:i=>{if(v.isClosed(i))throw new v.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(a){throw a}finally{v.closeStream(i.fd)}i.fd=null},isClosed:i=>i.fd===null,llseek:(i,a,l)=>{if(v.isClosed(i))throw new v.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new v.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new v.ErrnoError(28);return i.position=i.stream_ops.llseek(i,a,l),i.ungotten=[],i.position},read:(i,a,l,h,d)=>{if(h<0||d<0)throw new v.ErrnoError(28);if(v.isClosed(i))throw new v.ErrnoError(8);if((i.flags&2097155)===1)throw new v.ErrnoError(8);if(v.isDir(i.node.mode))throw new v.ErrnoError(31);if(!i.stream_ops.read)throw new v.ErrnoError(28);var w=typeof d<"u";if(!w)d=i.position;else if(!i.seekable)throw new v.ErrnoError(70);var b=i.stream_ops.read(i,a,l,h,d);return w||(i.position+=b),b},write:(i,a,l,h,d,w)=>{if(h<0||d<0)throw new v.ErrnoError(28);if(v.isClosed(i))throw new v.ErrnoError(8);if(!(i.flags&2097155))throw new v.ErrnoError(8);if(v.isDir(i.node.mode))throw new v.ErrnoError(31);if(!i.stream_ops.write)throw new v.ErrnoError(28);i.seekable&&i.flags&1024&&v.llseek(i,0,2);var b=typeof d<"u";if(!b)d=i.position;else if(!i.seekable)throw new v.ErrnoError(70);var _=i.stream_ops.write(i,a,l,h,d,w);return b||(i.position+=_),_},allocate:(i,a,l)=>{if(v.isClosed(i))throw new v.ErrnoError(8);if(a<0||l<=0)throw new v.ErrnoError(28);if(!(i.flags&2097155))throw new v.ErrnoError(8);if(!v.isFile(i.node.mode)&&!v.isDir(i.node.mode))throw new v.ErrnoError(43);if(!i.stream_ops.allocate)throw new v.ErrnoError(138);i.stream_ops.allocate(i,a,l)},mmap:(i,a,l,h,d)=>{if(h&2&&!(d&2)&&(i.flags&2097155)!==2)throw new v.ErrnoError(2);if((i.flags&2097155)===1)throw new v.ErrnoError(2);if(!i.stream_ops.mmap)throw new v.ErrnoError(43);return i.stream_ops.mmap(i,a,l,h,d)},msync:(i,a,l,h,d)=>!i||!i.stream_ops.msync?0:i.stream_ops.msync(i,a,l,h,d),munmap:i=>0,ioctl:(i,a,l)=>{if(!i.stream_ops.ioctl)throw new v.ErrnoError(59);return i.stream_ops.ioctl(i,a,l)},readFile:(i,a={})=>{if(a.flags=a.flags||0,a.encoding=a.encoding||"binary",a.encoding!=="utf8"&&a.encoding!=="binary")throw new Error('Invalid encoding type "'+a.encoding+'"');var l,h=v.open(i,a.flags),d=v.stat(i),w=d.size,b=new Uint8Array(w);return v.read(h,b,0,w,0),a.encoding==="utf8"?l=Re(b,0):a.encoding==="binary"&&(l=b),v.close(h),l},writeFile:(i,a,l={})=>{l.flags=l.flags||577;var h=v.open(i,l.flags,l.mode);if(typeof a=="string"){var d=new Uint8Array(he(a)+1),w=ye(a,d,0,d.length);v.write(h,d,0,w,void 0,l.canOwn)}else if(ArrayBuffer.isView(a))v.write(h,a,0,a.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");v.close(h)},cwd:()=>v.currentPath,chdir:i=>{var a=v.lookupPath(i,{follow:!0});if(a.node===null)throw new v.ErrnoError(44);if(!v.isDir(a.node.mode))throw new v.ErrnoError(54);var l=v.nodePermissions(a.node,"x");if(l)throw new v.ErrnoError(l);v.currentPath=a.path},createDefaultDirectories:()=>{v.mkdir("/tmp"),v.mkdir("/home"),v.mkdir("/home/web_user")},createDefaultDevices:()=>{v.mkdir("/dev"),v.registerDevice(v.makedev(1,3),{read:()=>0,write:(a,l,h,d,w)=>d}),v.mkdev("/dev/null",v.makedev(1,3)),Zt.register(v.makedev(5,0),Zt.default_tty_ops),Zt.register(v.makedev(6,0),Zt.default_tty1_ops),v.mkdev("/dev/tty",v.makedev(5,0)),v.mkdev("/dev/tty1",v.makedev(6,0));var i=xd();v.createDevice("/dev","random",i),v.createDevice("/dev","urandom",i),v.mkdir("/dev/shm"),v.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{v.mkdir("/proc");var i=v.mkdir("/proc/self");v.mkdir("/proc/self/fd"),v.mount({mount:()=>{var a=v.createNode(i,"fd",16895,73);return a.node_ops={lookup:(l,h)=>{var d=+h,w=v.getStream(d);if(!w)throw new v.ErrnoError(8);var b={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>w.path}};return b.parent=b,b}},a}},{},"/proc/self/fd")},createStandardStreams:()=>{r.stdin?v.createDevice("/dev","stdin",r.stdin):v.symlink("/dev/tty","/dev/stdin"),r.stdout?v.createDevice("/dev","stdout",null,r.stdout):v.symlink("/dev/tty","/dev/stdout"),r.stderr?v.createDevice("/dev","stderr",null,r.stderr):v.symlink("/dev/tty1","/dev/stderr"),v.open("/dev/stdin",0),v.open("/dev/stdout",1),v.open("/dev/stderr",1)},ensureErrnoError:()=>{v.ErrnoError||(v.ErrnoError=function(a,l){this.node=l,this.setErrno=function(h){this.errno=h},this.setErrno(a),this.message="FS error"},v.ErrnoError.prototype=new Error,v.ErrnoError.prototype.constructor=v.ErrnoError,[44].forEach(i=>{v.genericErrors[i]=new v.ErrnoError(i),v.genericErrors[i].stack="<generic error, no stack>"}))},staticInit:()=>{v.ensureErrnoError(),v.nameTable=new Array(4096),v.mount(J,{},"/"),v.createDefaultDirectories(),v.createDefaultDevices(),v.createSpecialDirectories(),v.filesystems={MEMFS:J}},init:(i,a,l)=>{v.init.initialized=!0,v.ensureErrnoError(),r.stdin=i||r.stdin,r.stdout=a||r.stdout,r.stderr=l||r.stderr,v.createStandardStreams()},quit:()=>{v.init.initialized=!1;for(var i=0;i<v.streams.length;i++){var a=v.streams[i];a&&v.close(a)}},getMode:(i,a)=>{var l=0;return i&&(l|=365),a&&(l|=146),l},findObject:(i,a)=>{var l=v.analyzePath(i,a);return l.exists?l.object:null},analyzePath:(i,a)=>{try{var l=v.lookupPath(i,{follow:!a});i=l.path}catch{}var h={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=v.lookupPath(i,{parent:!0});h.parentExists=!0,h.parentPath=l.path,h.parentObject=l.node,h.name=ue.basename(i),l=v.lookupPath(i,{follow:!a}),h.exists=!0,h.path=l.path,h.object=l.node,h.name=l.node.name,h.isRoot=l.path==="/"}catch(d){h.error=d.errno}return h},createPath:(i,a,l,h)=>{i=typeof i=="string"?i:v.getPath(i);for(var d=a.split("/").reverse();d.length;){var w=d.pop();if(w){var b=ue.join2(i,w);try{v.mkdir(b)}catch{}i=b}}return b},createFile:(i,a,l,h,d)=>{var w=ue.join2(typeof i=="string"?i:v.getPath(i),a),b=v.getMode(h,d);return v.create(w,b)},createDataFile:(i,a,l,h,d,w)=>{var b=a;i&&(i=typeof i=="string"?i:v.getPath(i),b=a?ue.join2(i,a):i);var _=v.getMode(h,d),T=v.create(b,_);if(l){if(typeof l=="string"){for(var P=new Array(l.length),B=0,M=l.length;B<M;++B)P[B]=l.charCodeAt(B);l=P}v.chmod(T,_|146);var D=v.open(T,577);v.write(D,l,0,l.length,0,w),v.close(D),v.chmod(T,_)}return T},createDevice:(i,a,l,h)=>{var d=ue.join2(typeof i=="string"?i:v.getPath(i),a),w=v.getMode(!!l,!!h);v.createDevice.major||(v.createDevice.major=64);var b=v.makedev(v.createDevice.major++,0);return v.registerDevice(b,{open:_=>{_.seekable=!1},close:_=>{h&&h.buffer&&h.buffer.length&&h(10)},read:(_,T,P,B,M)=>{for(var D=0,I=0;I<B;I++){var Y;try{Y=l()}catch{throw new v.ErrnoError(29)}if(Y===void 0&&D===0)throw new v.ErrnoError(6);if(Y==null)break;D++,T[P+I]=Y}return D&&(_.node.timestamp=Date.now()),D},write:(_,T,P,B,M)=>{for(var D=0;D<B;D++)try{h(T[P+D])}catch{throw new v.ErrnoError(29)}return B&&(_.node.timestamp=Date.now()),D}}),v.mkdev(d,w,b)},forceLoadFile:i=>{if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(S)try{i.contents=uo(S(i.url),!0),i.usedBytes=i.contents.length}catch{throw new v.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(i,a,l,h,d)=>{function w(){this.lengthKnown=!1,this.chunks=[]}if(w.prototype.get=function(I){if(!(I>this.length-1||I<0)){var Y=I%this.chunkSize,fe=I/this.chunkSize|0;return this.getter(fe)[Y]}},w.prototype.setDataGetter=function(I){this.getter=I},w.prototype.cacheLength=function(){var I=new XMLHttpRequest;if(I.open("HEAD",l,!1),I.send(null),!(I.status>=200&&I.status<300||I.status===304))throw new Error("Couldn't load "+l+". Status: "+I.status);var Y=Number(I.getResponseHeader("Content-length")),fe,Se=(fe=I.getResponseHeader("Accept-Ranges"))&&fe==="bytes",xe=(fe=I.getResponseHeader("Content-Encoding"))&&fe==="gzip",R=1024*1024;Se||(R=Y);var W=(ge,qe)=>{if(ge>qe)throw new Error("invalid range ("+ge+", "+qe+") or no bytes requested!");if(qe>Y-1)throw new Error("only "+Y+" bytes available! programmer error!");var ke=new XMLHttpRequest;if(ke.open("GET",l,!1),Y!==R&&ke.setRequestHeader("Range","bytes="+ge+"-"+qe),ke.responseType="arraybuffer",ke.overrideMimeType&&ke.overrideMimeType("text/plain; charset=x-user-defined"),ke.send(null),!(ke.status>=200&&ke.status<300||ke.status===304))throw new Error("Couldn't load "+l+". Status: "+ke.status);return ke.response!==void 0?new Uint8Array(ke.response||[]):uo(ke.responseText||"",!0)},Ue=this;Ue.setDataGetter(ge=>{var qe=ge*R,ke=(ge+1)*R-1;if(ke=Math.min(ke,Y-1),typeof Ue.chunks[ge]>"u"&&(Ue.chunks[ge]=W(qe,ke)),typeof Ue.chunks[ge]>"u")throw new Error("doXHR failed!");return Ue.chunks[ge]}),(xe||!Y)&&(R=Y=1,Y=this.getter(0).length,R=Y,V("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=Y,this._chunkSize=R,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!p)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var b=new w;Object.defineProperties(b,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var _={isDevice:!1,contents:b}}else var _={isDevice:!1,url:l};var T=v.createFile(i,a,_,h,d);_.contents?T.contents=_.contents:_.url&&(T.contents=null,T.url=_.url),Object.defineProperties(T,{usedBytes:{get:function(){return this.contents.length}}});var P={},B=Object.keys(T.stream_ops);B.forEach(D=>{var I=T.stream_ops[D];P[D]=function(){return v.forceLoadFile(T),I.apply(null,arguments)}});function M(D,I,Y,fe,Se){var xe=D.node.contents;if(Se>=xe.length)return 0;var R=Math.min(xe.length-Se,fe);if(xe.slice)for(var W=0;W<R;W++)I[Y+W]=xe[Se+W];else for(var W=0;W<R;W++)I[Y+W]=xe.get(Se+W);return R}return P.read=(D,I,Y,fe,Se)=>(v.forceLoadFile(T),M(D,I,Y,fe,Se)),P.mmap=(D,I,Y,fe,Se)=>{v.forceLoadFile(T);var xe=ou(I);if(!xe)throw new v.ErrnoError(48);return M(D,Ne,xe,I,Y),{ptr:xe,allocated:!0}},T.stream_ops=P,T},createPreloadedFile:(i,a,l,h,d,w,b,_,T,P)=>{var B=a?_t.resolve(ue.join2(i,a)):i;function M(D){function I(Y){P&&P(),_||v.createDataFile(i,a,Y,h,d,T),w&&w(),Yn()}Browser.handledByPreloadPlugin(D,B,I,()=>{b&&b(),Yn()})||I(D)}is(),typeof l=="string"?Pd(l,D=>M(D),b):M(l)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(i,a,l)=>{a=a||(()=>{}),l=l||(()=>{});var h=v.indexedDB();try{var d=h.open(v.DB_NAME(),v.DB_VERSION)}catch(w){return l(w)}d.onupgradeneeded=()=>{V("creating db");var w=d.result;w.createObjectStore(v.DB_STORE_NAME)},d.onsuccess=()=>{var w=d.result,b=w.transaction([v.DB_STORE_NAME],"readwrite"),_=b.objectStore(v.DB_STORE_NAME),T=0,P=0,B=i.length;function M(){P==0?a():l()}i.forEach(D=>{var I=_.put(v.analyzePath(D).object.contents,D);I.onsuccess=()=>{T++,T+P==B&&M()},I.onerror=()=>{P++,T+P==B&&M()}}),b.onerror=l},d.onerror=l},loadFilesFromDB:(i,a,l)=>{a=a||(()=>{}),l=l||(()=>{});var h=v.indexedDB();try{var d=h.open(v.DB_NAME(),v.DB_VERSION)}catch(w){return l(w)}d.onupgradeneeded=l,d.onsuccess=()=>{var w=d.result;try{var b=w.transaction([v.DB_STORE_NAME],"readonly")}catch(D){l(D);return}var _=b.objectStore(v.DB_STORE_NAME),T=0,P=0,B=i.length;function M(){P==0?a():l()}i.forEach(D=>{var I=_.get(D);I.onsuccess=()=>{v.analyzePath(D).exists&&v.unlink(D),v.createDataFile(ue.dirname(D),ue.basename(D),I.result,!0,!0,!0),T++,T+P==B&&M()},I.onerror=()=>{P++,T+P==B&&M()}}),b.onerror=l},d.onerror=l}},le={DEFAULT_POLLMASK:5,calculateAt:function(i,a,l){if(ue.isAbs(a))return a;var h;if(i===-100)h=v.cwd();else{var d=v.getStream(i);if(!d)throw new v.ErrnoError(8);h=d.path}if(a.length==0){if(!l)throw new v.ErrnoError(44);return h}return ue.join2(h,a)},doStat:function(i,a,l){try{var h=i(a)}catch(d){if(d&&d.node&&ue.normalize(a)!==ue.normalize(v.getPath(d.node)))return-54;throw d}return F[l>>2]=h.dev,F[l+4>>2]=0,F[l+8>>2]=h.ino,F[l+12>>2]=h.mode,F[l+16>>2]=h.nlink,F[l+20>>2]=h.uid,F[l+24>>2]=h.gid,F[l+28>>2]=h.rdev,F[l+32>>2]=0,St=[h.size>>>0,(Ie=h.size,+Math.abs(Ie)>=1?Ie>0?(Math.min(+Math.floor(Ie/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ie-+(~~Ie>>>0))/4294967296)>>>0:0)],F[l+40>>2]=St[0],F[l+44>>2]=St[1],F[l+48>>2]=4096,F[l+52>>2]=h.blocks,F[l+56>>2]=h.atime.getTime()/1e3|0,F[l+60>>2]=0,F[l+64>>2]=h.mtime.getTime()/1e3|0,F[l+68>>2]=0,F[l+72>>2]=h.ctime.getTime()/1e3|0,F[l+76>>2]=0,St=[h.ino>>>0,(Ie=h.ino,+Math.abs(Ie)>=1?Ie>0?(Math.min(+Math.floor(Ie/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ie-+(~~Ie>>>0))/4294967296)>>>0:0)],F[l+80>>2]=St[0],F[l+84>>2]=St[1],0},doMsync:function(i,a,l,h,d){var w=We.slice(i,i+l);v.msync(a,w,d,l,h)},varargs:void 0,get:function(){le.varargs+=4;var i=F[le.varargs-4>>2];return i},getStr:function(i){var a=oe(i);return a},getStreamFromFD:function(i){var a=v.getStream(i);if(!a)throw new v.ErrnoError(8);return a}};function Ad(i,a){try{return i=le.getStr(i),v.chmod(i,a),0}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return-l.errno}}function Od(i,a,l,h){try{if(a=le.getStr(a),a=le.calculateAt(i,a),l&-8)return-28;var d=v.lookupPath(a,{follow:!0}),w=d.node;if(!w)return-44;var b="";return l&4&&(b+="r"),l&2&&(b+="w"),l&1&&(b+="x"),b&&v.nodePermissions(w,b)?-2:0}catch(_){if(typeof v>"u"||!(_ instanceof v.ErrnoError))throw _;return-_.errno}}function Rd(i){return F[Tu()>>2]=i,i}function Dd(i,a,l){le.varargs=l;try{var h=le.getStreamFromFD(i);switch(a){case 0:{var d=le.get();if(d<0)return-28;var w;return w=v.createStream(h,d),w.fd}case 1:case 2:return 0;case 3:return h.flags;case 4:{var d=le.get();return h.flags|=d,0}case 5:{var d=le.get(),b=0;return It[d+b>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return Rd(28),-1;default:return-28}}catch(_){if(typeof v>"u"||!(_ instanceof v.ErrnoError))throw _;return-_.errno}}function Ud(i,a){try{var l=le.getStreamFromFD(i);return le.doStat(v.stat,l.path,a)}catch(h){if(typeof v>"u"||!(h instanceof v.ErrnoError))throw h;return-h.errno}}function Bd(i,a,l){le.varargs=l;try{var h=le.getStreamFromFD(i);switch(a){case 21509:case 21505:return h.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return h.tty?0:-59;case 21519:{if(!h.tty)return-59;var d=le.get();return F[d>>2]=0,0}case 21520:return h.tty?-28:-59;case 21531:{var d=le.get();return v.ioctl(h,a,d)}case 21523:return h.tty?0:-59;case 21524:return h.tty?0:-59;default:Gt("bad ioctl syscall "+a)}}catch(w){if(typeof v>"u"||!(w instanceof v.ErrnoError))throw w;return-w.errno}}function Md(i,a){try{return i=le.getStr(i),le.doStat(v.lstat,i,a)}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return-l.errno}}function Fd(i,a,l,h){try{a=le.getStr(a);var d=h&256,w=h&4096;return h=h&-4353,a=le.calculateAt(i,a,w),le.doStat(d?v.lstat:v.stat,a,l)}catch(b){if(typeof v>"u"||!(b instanceof v.ErrnoError))throw b;return-b.errno}}function Ld(i,a,l,h){le.varargs=h;try{a=le.getStr(a),a=le.calculateAt(i,a);var d=h?le.get():0;return v.open(a,l,d).fd}catch(w){if(typeof v>"u"||!(w instanceof v.ErrnoError))throw w;return-w.errno}}function Id(i,a){try{return i=le.getStr(i),le.doStat(v.stat,i,a)}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return-l.errno}}function Gd(i,a,l,h,d){}function qn(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+i)}}function Nd(){for(var i=new Array(256),a=0;a<256;++a)i[a]=String.fromCharCode(a);su=i}var su=void 0;function Ve(i){for(var a="",l=i;We[l];)a+=su[We[l++]];return a}var gr={},Kt={},jn={},Hd=48,zd=57;function Zn(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var a=i.charCodeAt(0);return a>=Hd&&a<=zd?"_"+i:i}function Kn(i,a){return i=Zn(i),new Function("body","return function "+i+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(a)}function us(i,a){var l=Kn(a,function(h){this.name=a,this.message=h;var d=new Error(h).stack;d!==void 0&&(this.stack=this.toString()+`
`+d.replace(/^Error(:[^\n]*)?\n/,""))});return l.prototype=Object.create(i.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},l}var mr=void 0;function ce(i){throw new mr(i)}var iu=void 0;function Qn(i){throw new iu(i)}function Qt(i,a,l){i.forEach(function(_){jn[_]=a});function h(_){var T=l(_);T.length!==i.length&&Qn("Mismatched type converter count");for(var P=0;P<i.length;++P)ht(i[P],T[P])}var d=new Array(a.length),w=[],b=0;a.forEach((_,T)=>{Kt.hasOwnProperty(_)?d[T]=Kt[_]:(w.push(_),gr.hasOwnProperty(_)||(gr[_]=[]),gr[_].push(()=>{d[T]=Kt[_],++b,b===w.length&&h(d)}))}),w.length===0&&h(d)}function ht(i,a,l={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");var h=a.name;if(i||ce('type "'+h+'" must have a positive integer typeid pointer'),Kt.hasOwnProperty(i)){if(l.ignoreDuplicateRegistrations)return;ce("Cannot register type '"+h+"' twice")}if(Kt[i]=a,delete jn[i],gr.hasOwnProperty(i)){var d=gr[i];delete gr[i],d.forEach(w=>w())}}function Wd(i,a,l,h,d){var w=qn(l);a=Ve(a),ht(i,{name:a,fromWireType:function(b){return!!b},toWireType:function(b,_){return _?h:d},argPackAdvance:8,readValueFromPointer:function(b){var _;if(l===1)_=Ne;else if(l===2)_=It;else if(l===4)_=F;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(_[b>>w])},destructorFunction:null})}function Vd(i){if(!(this instanceof Nt)||!(i instanceof Nt))return!1;for(var a=this.$$.ptrType.registeredClass,l=this.$$.ptr,h=i.$$.ptrType.registeredClass,d=i.$$.ptr;a.baseClass;)l=a.upcast(l),a=a.baseClass;for(;h.baseClass;)d=h.upcast(d),h=h.baseClass;return a===h&&l===d}function Yd(i){return{count:i.count,deleteScheduled:i.deleteScheduled,preservePointerOnDelete:i.preservePointerOnDelete,ptr:i.ptr,ptrType:i.ptrType,smartPtr:i.smartPtr,smartPtrType:i.smartPtrType}}function ls(i){function a(l){return l.$$.ptrType.registeredClass.name}ce(a(i)+" instance already deleted")}var cs=!1;function au(i){}function Xd(i){i.smartPtr?i.smartPtrType.rawDestructor(i.smartPtr):i.ptrType.registeredClass.rawDestructor(i.ptr)}function uu(i){i.count.value-=1;var a=i.count.value===0;a&&Xd(i)}function lu(i,a,l){if(a===l)return i;if(l.baseClass===void 0)return null;var h=lu(i,a,l.baseClass);return h===null?null:l.downcast(h)}var cu={};function $d(){return Object.keys(Zr).length}function qd(){var i=[];for(var a in Zr)Zr.hasOwnProperty(a)&&i.push(Zr[a]);return i}var qr=[];function fs(){for(;qr.length;){var i=qr.pop();i.$$.deleteScheduled=!1,i.delete()}}var jr=void 0;function jd(i){jr=i,qr.length&&jr&&jr(fs)}function Zd(){r.getInheritedInstanceCount=$d,r.getLiveInheritedInstances=qd,r.flushPendingDeletes=fs,r.setDelayFunction=jd}var Zr={};function Kd(i,a){for(a===void 0&&ce("ptr should not be undefined");i.baseClass;)a=i.upcast(a),i=i.baseClass;return a}function Qd(i,a){return a=Kd(i,a),Zr[a]}function Jn(i,a){(!a.ptrType||!a.ptr)&&Qn("makeClassHandle requires ptr and ptrType");var l=!!a.smartPtrType,h=!!a.smartPtr;return l!==h&&Qn("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Kr(Object.create(i,{$$:{value:a}}))}function Jd(i){var a=this.getPointee(i);if(!a)return this.destructor(i),null;var l=Qd(this.registeredClass,a);if(l!==void 0){if(l.$$.count.value===0)return l.$$.ptr=a,l.$$.smartPtr=i,l.clone();var h=l.clone();return this.destructor(i),h}function d(){return this.isSmartPointer?Jn(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:a,smartPtrType:this,smartPtr:i}):Jn(this.registeredClass.instancePrototype,{ptrType:this,ptr:i})}var w=this.registeredClass.getActualType(a),b=cu[w];if(!b)return d.call(this);var _;this.isConst?_=b.constPointerType:_=b.pointerType;var T=lu(a,this.registeredClass,_.registeredClass);return T===null?d.call(this):this.isSmartPointer?Jn(_.registeredClass.instancePrototype,{ptrType:_,ptr:T,smartPtrType:this,smartPtr:i}):Jn(_.registeredClass.instancePrototype,{ptrType:_,ptr:T})}function Kr(i){return typeof FinalizationRegistry>"u"?(Kr=a=>a,i):(cs=new FinalizationRegistry(a=>{uu(a.$$)}),Kr=a=>{var l=a.$$,h=!!l.smartPtr;if(h){var d={$$:l};cs.register(a,d,a)}return a},au=a=>cs.unregister(a),Kr(i))}function ev(){if(this.$$.ptr||ls(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var i=Kr(Object.create(Object.getPrototypeOf(this),{$$:{value:Yd(this.$$)}}));return i.$$.count.value+=1,i.$$.deleteScheduled=!1,i}function tv(){this.$$.ptr||ls(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ce("Object already scheduled for deletion"),au(this),uu(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function rv(){return!this.$$.ptr}function nv(){return this.$$.ptr||ls(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ce("Object already scheduled for deletion"),qr.push(this),qr.length===1&&jr&&jr(fs),this.$$.deleteScheduled=!0,this}function ov(){Nt.prototype.isAliasOf=Vd,Nt.prototype.clone=ev,Nt.prototype.delete=tv,Nt.prototype.isDeleted=rv,Nt.prototype.deleteLater=nv}function Nt(){}function hs(i,a,l){if(i[a].overloadTable===void 0){var h=i[a];i[a]=function(){return i[a].overloadTable.hasOwnProperty(arguments.length)||ce("Function '"+l+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+i[a].overloadTable+")!"),i[a].overloadTable[arguments.length].apply(this,arguments)},i[a].overloadTable=[],i[a].overloadTable[h.argCount]=h}}function fu(i,a,l){r.hasOwnProperty(i)?((l===void 0||r[i].overloadTable!==void 0&&r[i].overloadTable[l]!==void 0)&&ce("Cannot register public name '"+i+"' twice"),hs(r,i,i),r.hasOwnProperty(l)&&ce("Cannot register multiple overloads of a function with the same number of arguments ("+l+")!"),r[i].overloadTable[l]=a):(r[i]=a,l!==void 0&&(r[i].numArguments=l))}function sv(i,a,l,h,d,w,b,_){this.name=i,this.constructor=a,this.instancePrototype=l,this.rawDestructor=h,this.baseClass=d,this.getActualType=w,this.upcast=b,this.downcast=_,this.pureVirtualFunctions=[]}function ps(i,a,l){for(;a!==l;)a.upcast||ce("Expected null or instance of "+l.name+", got an instance of "+a.name),i=a.upcast(i),a=a.baseClass;return i}function iv(i,a){if(a===null)return this.isReference&&ce("null is not a valid "+this.name),0;a.$$||ce('Cannot pass "'+ys(a)+'" as a '+this.name),a.$$.ptr||ce("Cannot pass deleted object as a pointer of type "+this.name);var l=a.$$.ptrType.registeredClass,h=ps(a.$$.ptr,l,this.registeredClass);return h}function av(i,a){var l;if(a===null)return this.isReference&&ce("null is not a valid "+this.name),this.isSmartPointer?(l=this.rawConstructor(),i!==null&&i.push(this.rawDestructor,l),l):0;a.$$||ce('Cannot pass "'+ys(a)+'" as a '+this.name),a.$$.ptr||ce("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&a.$$.ptrType.isConst&&ce("Cannot convert argument of type "+(a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name)+" to parameter type "+this.name);var h=a.$$.ptrType.registeredClass;if(l=ps(a.$$.ptr,h,this.registeredClass),this.isSmartPointer)switch(a.$$.smartPtr===void 0&&ce("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:a.$$.smartPtrType===this?l=a.$$.smartPtr:ce("Cannot convert argument of type "+(a.$$.smartPtrType?a.$$.smartPtrType.name:a.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:l=a.$$.smartPtr;break;case 2:if(a.$$.smartPtrType===this)l=a.$$.smartPtr;else{var d=a.clone();l=this.rawShare(l,De.toHandle(function(){d.delete()})),i!==null&&i.push(this.rawDestructor,l)}break;default:ce("Unsupporting sharing policy")}return l}function uv(i,a){if(a===null)return this.isReference&&ce("null is not a valid "+this.name),0;a.$$||ce('Cannot pass "'+ys(a)+'" as a '+this.name),a.$$.ptr||ce("Cannot pass deleted object as a pointer of type "+this.name),a.$$.ptrType.isConst&&ce("Cannot convert argument of type "+a.$$.ptrType.name+" to parameter type "+this.name);var l=a.$$.ptrType.registeredClass,h=ps(a.$$.ptr,l,this.registeredClass);return h}function eo(i){return this.fromWireType(ie[i>>2])}function lv(i){return this.rawGetPointee&&(i=this.rawGetPointee(i)),i}function cv(i){this.rawDestructor&&this.rawDestructor(i)}function fv(i){i!==null&&i.delete()}function hv(){Et.prototype.getPointee=lv,Et.prototype.destructor=cv,Et.prototype.argPackAdvance=8,Et.prototype.readValueFromPointer=eo,Et.prototype.deleteObject=fv,Et.prototype.fromWireType=Jd}function Et(i,a,l,h,d,w,b,_,T,P,B){this.name=i,this.registeredClass=a,this.isReference=l,this.isConst=h,this.isSmartPointer=d,this.pointeeType=w,this.sharingPolicy=b,this.rawGetPointee=_,this.rawConstructor=T,this.rawShare=P,this.rawDestructor=B,!d&&a.baseClass===void 0?h?(this.toWireType=iv,this.destructorFunction=null):(this.toWireType=uv,this.destructorFunction=null):this.toWireType=av}function pv(i,a,l){r.hasOwnProperty(i)||Qn("Replacing nonexistant public symbol"),r[i].overloadTable!==void 0&&l!==void 0?r[i].overloadTable[l]=a:(r[i]=a,r[i].argCount=l)}function dv(i,a,l){var h=r["dynCall_"+i];return l&&l.length?h.apply(null,[a].concat(l)):h.call(null,a)}function vv(i,a,l){return i.includes("j")?dv(i,a,l):$n(a).apply(null,l)}function gv(i,a){var l=[];return function(){return l.length=0,Object.assign(l,arguments),vv(i,a,l)}}function Jt(i,a){i=Ve(i);function l(){return i.includes("j")?gv(i,a):$n(a)}var h=l();return typeof h!="function"&&ce("unknown function pointer with signature "+i+": "+a),h}var hu=void 0;function pu(i){var a=xu(i),l=Ve(a);return kt(a),l}function to(i,a){var l=[],h={};function d(w){if(!h[w]&&!Kt[w]){if(jn[w]){jn[w].forEach(d);return}l.push(w),h[w]=!0}}throw a.forEach(d),new hu(i+": "+l.map(pu).join([", "]))}function mv(i,a,l,h,d,w,b,_,T,P,B,M,D){B=Ve(B),w=Jt(d,w),_&&(_=Jt(b,_)),P&&(P=Jt(T,P)),D=Jt(M,D);var I=Zn(B);fu(I,function(){to("Cannot construct "+B+" due to unbound types",[h])}),Qt([i,a,l],h?[h]:[],function(Y){Y=Y[0];var fe,Se;h?(fe=Y.registeredClass,Se=fe.instancePrototype):Se=Nt.prototype;var xe=Kn(I,function(){if(Object.getPrototypeOf(this)!==R)throw new mr("Use 'new' to construct "+B);if(W.constructor_body===void 0)throw new mr(B+" has no accessible constructor");var ke=W.constructor_body[arguments.length];if(ke===void 0)throw new mr("Tried to invoke ctor of "+B+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(W.constructor_body).toString()+") parameters instead!");return ke.apply(this,arguments)}),R=Object.create(Se,{constructor:{value:xe}});xe.prototype=R;var W=new sv(B,xe,R,D,fe,w,_,P),Ue=new Et(B,W,!0,!1,!1),ge=new Et(B+"*",W,!1,!1,!1),qe=new Et(B+" const*",W,!1,!0,!1);return cu[i]={pointerType:ge,constPointerType:qe},pv(I,xe),[Ue,ge,qe]})}function du(i,a){if(!(i instanceof Function))throw new TypeError("new_ called with constructor type "+typeof i+" which is not a function");var l=Kn(i.name||"unknownFunctionName",function(){});l.prototype=i.prototype;var h=new l,d=i.apply(h,a);return d instanceof Object?d:h}function vu(i){for(;i.length;){var a=i.pop(),l=i.pop();l(a)}}function ds(i,a,l,h,d){var w=a.length;w<2&&ce("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var b=a[1]!==null&&l!==null,_=!1,T=1;T<a.length;++T)if(a[T]!==null&&a[T].destructorFunction===void 0){_=!0;break}for(var P=a[0].name!=="void",B="",M="",T=0;T<w-2;++T)B+=(T!==0?", ":"")+"arg"+T,M+=(T!==0?", ":"")+"arg"+T+"Wired";var D="return function "+Zn(i)+"("+B+`) {
if (arguments.length !== `+(w-2)+`) {
throwBindingError('function `+i+" called with ' + arguments.length + ' arguments, expected "+(w-2)+` args!');
}
`;_&&(D+=`var destructors = [];
`);var I=_?"destructors":"null",Y=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],fe=[ce,h,d,vu,a[0],a[1]];b&&(D+="var thisWired = classParam.toWireType("+I+`, this);
`);for(var T=0;T<w-2;++T)D+="var arg"+T+"Wired = argType"+T+".toWireType("+I+", arg"+T+"); // "+a[T+2].name+`
`,Y.push("argType"+T),fe.push(a[T+2]);if(b&&(M="thisWired"+(M.length>0?", ":"")+M),D+=(P?"var rv = ":"")+"invoker(fn"+(M.length>0?", ":"")+M+`);
`,_)D+=`runDestructors(destructors);
`;else for(var T=b?1:2;T<a.length;++T){var Se=T===1?"thisWired":"arg"+(T-2)+"Wired";a[T].destructorFunction!==null&&(D+=Se+"_dtor("+Se+"); // "+a[T].name+`
`,Y.push(Se+"_dtor"),fe.push(a[T].destructorFunction))}P&&(D+=`var ret = retType.fromWireType(rv);
return ret;
`),D+=`}
`,Y.push(D);var xe=du(Function,Y).apply(null,fe);return xe}function vs(i,a){for(var l=[],h=0;h<i;h++)l.push(F[(a>>2)+h]);return l}function yv(i,a,l,h,d,w,b){var _=vs(l,h);a=Ve(a),w=Jt(d,w),Qt([],[i],function(T){T=T[0];var P=T.name+"."+a;function B(){to("Cannot call "+P+" due to unbound types",_)}a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var M=T.registeredClass.constructor;return M[a]===void 0?(B.argCount=l-1,M[a]=B):(hs(M,a,P),M[a].overloadTable[l-1]=B),Qt([],_,function(D){var I=[D[0],null].concat(D.slice(1)),Y=ds(P,I,null,w,b);return M[a].overloadTable===void 0?(Y.argCount=l-1,M[a]=Y):M[a].overloadTable[l-1]=Y,[]}),[]})}function wv(i,a,l,h,d,w){K(a>0);var b=vs(a,l);d=Jt(h,d),Qt([],[i],function(_){_=_[0];var T="constructor "+_.name;if(_.registeredClass.constructor_body===void 0&&(_.registeredClass.constructor_body=[]),_.registeredClass.constructor_body[a-1]!==void 0)throw new mr("Cannot register multiple constructors with identical number of parameters ("+(a-1)+") for class '"+_.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return _.registeredClass.constructor_body[a-1]=()=>{to("Cannot construct "+_.name+" due to unbound types",b)},Qt([],b,function(P){return P.splice(1,0,null),_.registeredClass.constructor_body[a-1]=ds(T,P,null,d,w),[]}),[]})}function bv(i,a,l,h,d,w,b,_){var T=vs(l,h);a=Ve(a),w=Jt(d,w),Qt([],[i],function(P){P=P[0];var B=P.name+"."+a;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),_&&P.registeredClass.pureVirtualFunctions.push(a);function M(){to("Cannot call "+B+" due to unbound types",T)}var D=P.registeredClass.instancePrototype,I=D[a];return I===void 0||I.overloadTable===void 0&&I.className!==P.name&&I.argCount===l-2?(M.argCount=l-2,M.className=P.name,D[a]=M):(hs(D,a,B),D[a].overloadTable[l-2]=M),Qt([],T,function(Y){var fe=ds(B,Y,P,w,b);return D[a].overloadTable===void 0?(fe.argCount=l-2,D[a]=fe):D[a].overloadTable[l-2]=fe,[]}),[]})}var gs=[],ut=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function ms(i){i>4&&--ut[i].refcount===0&&(ut[i]=void 0,gs.push(i))}function Sv(){for(var i=0,a=5;a<ut.length;++a)ut[a]!==void 0&&++i;return i}function _v(){for(var i=5;i<ut.length;++i)if(ut[i]!==void 0)return ut[i];return null}function Ev(){r.count_emval_handles=Sv,r.get_first_emval=_v}var De={toValue:i=>(i||ce("Cannot use deleted val. handle = "+i),ut[i].value),toHandle:i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var a=gs.length?gs.pop():ut.length;return ut[a]={refcount:1,value:i},a}}}};function Tv(i,a){a=Ve(a),ht(i,{name:a,fromWireType:function(l){var h=De.toValue(l);return ms(l),h},toWireType:function(l,h){return De.toHandle(h)},argPackAdvance:8,readValueFromPointer:eo,destructorFunction:null})}function xv(i,a,l){switch(a){case 0:return function(h){var d=l?Ne:We;return this.fromWireType(d[h])};case 1:return function(h){var d=l?It:Xr;return this.fromWireType(d[h>>1])};case 2:return function(h){var d=l?F:ie;return this.fromWireType(d[h>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function kv(i,a,l,h){var d=qn(l);a=Ve(a);function w(){}w.values={},ht(i,{name:a,constructor:w,fromWireType:function(b){return this.constructor.values[b]},toWireType:function(b,_){return _.value},argPackAdvance:8,readValueFromPointer:xv(a,d,h),destructorFunction:null}),fu(a,w)}function ro(i,a){var l=Kt[i];return l===void 0&&ce(a+" has unknown type "+pu(i)),l}function Cv(i,a,l){var h=ro(i,"enum");a=Ve(a);var d=h.constructor,w=Object.create(h.constructor.prototype,{value:{value:l},constructor:{value:Kn(h.name+"_"+a,function(){})}});d.values[l]=w,d[a]=w}function ys(i){if(i===null)return"null";var a=typeof i;return a==="object"||a==="array"||a==="function"?i.toString():""+i}function Pv(i,a){switch(a){case 2:return function(l){return this.fromWireType(at[l>>2])};case 3:return function(l){return this.fromWireType(qa[l>>3])};default:throw new TypeError("Unknown float type: "+i)}}function Av(i,a,l){var h=qn(l);a=Ve(a),ht(i,{name:a,fromWireType:function(d){return d},toWireType:function(d,w){return w},argPackAdvance:8,readValueFromPointer:Pv(a,h),destructorFunction:null})}function Ov(i,a,l){switch(a){case 0:return l?function(d){return Ne[d]}:function(d){return We[d]};case 1:return l?function(d){return It[d>>1]}:function(d){return Xr[d>>1]};case 2:return l?function(d){return F[d>>2]}:function(d){return ie[d>>2]};default:throw new TypeError("Unknown integer type: "+i)}}function Rv(i,a,l,h,d){a=Ve(a);var w=qn(l),b=M=>M;if(h===0){var _=32-8*l;b=M=>M<<_>>>_}var T=a.includes("unsigned"),P=(M,D)=>{},B;T?B=function(M,D){return P(D,this.name),D>>>0}:B=function(M,D){return P(D,this.name),D},ht(i,{name:a,fromWireType:b,toWireType:B,argPackAdvance:8,readValueFromPointer:Ov(a,w,h!==0),destructorFunction:null})}function Dv(i,a,l){var h=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],d=h[a];function w(b){b=b>>2;var _=ie,T=_[b],P=_[b+1];return new d(bt,P,T)}l=Ve(l),ht(i,{name:l,fromWireType:w,argPackAdvance:8,readValueFromPointer:w},{ignoreDuplicateRegistrations:!0})}function Uv(i,a){a=Ve(a);var l=a==="std::string";ht(i,{name:a,fromWireType:function(h){var d=ie[h>>2],w;if(l)for(var b=h+4,_=0;_<=d;++_){var T=h+4+_;if(_==d||We[T]==0){var P=T-b,B=oe(b,P);w===void 0?w=B:(w+=String.fromCharCode(0),w+=B),b=T+1}}else{for(var M=new Array(d),_=0;_<d;++_)M[_]=String.fromCharCode(We[h+4+_]);w=M.join("")}return kt(h),w},toWireType:function(h,d){d instanceof ArrayBuffer&&(d=new Uint8Array(d));var w,b=typeof d=="string";b||d instanceof Uint8Array||d instanceof Uint8ClampedArray||d instanceof Int8Array||ce("Cannot pass non-string to std::string"),l&&b?w=()=>he(d):w=()=>d.length;var _=w(),T=xt(4+_+1);if(ie[T>>2]=_,l&&b)Te(d,T+4,_+1);else if(b)for(var P=0;P<_;++P){var B=d.charCodeAt(P);B>255&&(kt(T),ce("String has UTF-16 code units that do not fit in 8 bits")),We[T+4+P]=B}else for(var P=0;P<_;++P)We[T+4+P]=d[P];return h!==null&&h.push(kt,T),T},argPackAdvance:8,readValueFromPointer:eo,destructorFunction:function(h){kt(h)}})}function Bv(i,a,l){l=Ve(l);var h,d,w,b,_;a===2?(h=de,d=we,b=pe,w=()=>Xr,_=1):a===4&&(h=Me,d=Vr,b=ss,w=()=>ie,_=2),ht(i,{name:l,fromWireType:function(T){for(var P=ie[T>>2],B=w(),M,D=T+4,I=0;I<=P;++I){var Y=T+4+I*a;if(I==P||B[Y>>_]==0){var fe=Y-D,Se=h(D,fe);M===void 0?M=Se:(M+=String.fromCharCode(0),M+=Se),D=Y+a}}return kt(T),M},toWireType:function(T,P){typeof P!="string"&&ce("Cannot pass non-string to C++ string type "+l);var B=b(P),M=xt(4+B+a);return ie[M>>2]=B>>_,d(P,M+4,B+a),T!==null&&T.push(kt,M),M},argPackAdvance:8,readValueFromPointer:eo,destructorFunction:function(T){kt(T)}})}function Mv(i,a){a=Ve(a),ht(i,{isVoid:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(l,h){}})}function Fv(){return Date.now()}var Lv=!0;function Iv(){return Lv}function Gv(i,a,l){i=De.toValue(i),a=ro(a,"emval::as");var h=[],d=De.toHandle(h);return F[l>>2]=d,a.toWireType(h,i)}function Nv(i){var a=[];return F[i>>2]=De.toHandle(a),a}var Hv={};function ws(i){var a=Hv[i];return a===void 0?Ve(i):a}var bs=[];function zv(i,a,l,h,d){return i=bs[i],a=De.toValue(a),l=ws(l),i(a,l,Nv(h),d)}function gu(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function Wv(i){return i===0?De.toHandle(gu()):(i=ws(i),De.toHandle(gu()[i]))}function Vv(i){var a=bs.length;return bs.push(i),a}function Yv(i,a){for(var l=new Array(i),h=0;h<i;++h)l[h]=ro(ie[a+h*j>>2],"parameter "+h);return l}var mu=[];function Xv(i,a){var l=Yv(i,a),h=l[0],d=h.name+"_$"+l.slice(1).map(function(Y){return Y.name}).join("_")+"$",w=mu[d];if(w!==void 0)return w;for(var b=["retType"],_=[h],T="",P=0;P<i-1;++P)T+=(P!==0?", ":"")+"arg"+P,b.push("argType"+P),_.push(l[1+P]);for(var B=Zn("methodCaller_"+d),M="return function "+B+`(handle, name, destructors, args) {
`,D=0,P=0;P<i-1;++P)M+="    var arg"+P+" = argType"+P+".readValueFromPointer(args"+(D?"+"+D:"")+`);
`,D+=l[P+1].argPackAdvance;M+="    var rv = handle[name]("+T+`);
`;for(var P=0;P<i-1;++P)l[P+1].deleteObject&&(M+="    argType"+P+".deleteObject(arg"+P+`);
`);h.isVoid||(M+=`    return retType.toWireType(destructors, rv);
`),M+=`};
`,b.push(M);var I=du(Function,b).apply(null,_);return w=Vv(I),mu[d]=w,w}function $v(i,a){return i=De.toValue(i),a=De.toValue(a),De.toHandle(i[a])}function qv(i){i>4&&(ut[i].refcount+=1)}function jv(i){return De.toHandle(ws(i))}function Zv(i){var a=De.toValue(i);vu(a),ms(i)}function Kv(i,a,l){i=De.toValue(i),a=De.toValue(a),l=De.toValue(l),i[a]=l}function Qv(i,a){i=ro(i,"_emval_take_value");var l=i.readValueFromPointer(a);return De.toHandle(l)}function Jv(i){return i=De.toValue(i),De.toHandle(typeof i)}function eg(i,a){var l=new Date(F[i>>2]*1e3);F[a>>2]=l.getSeconds(),F[a+4>>2]=l.getMinutes(),F[a+8>>2]=l.getHours(),F[a+12>>2]=l.getDate(),F[a+16>>2]=l.getMonth(),F[a+20>>2]=l.getFullYear()-1900,F[a+24>>2]=l.getDay();var h=new Date(l.getFullYear(),0,1),d=(l.getTime()-h.getTime())/(1e3*60*60*24)|0;F[a+28>>2]=d,F[a+36>>2]=-(l.getTimezoneOffset()*60);var w=new Date(l.getFullYear(),6,1).getTimezoneOffset(),b=h.getTimezoneOffset(),_=(w!=b&&l.getTimezoneOffset()==Math.min(b,w))|0;F[a+32>>2]=_}function tg(i,a,l,h,d,w){try{var b=v.getStream(d);b&&(l&2&&le.doMsync(i,b,a,h,w),v.munmap(b))}catch(_){if(typeof v>"u"||!(_ instanceof v.ErrnoError))throw _;return-_.errno}}function rg(i,a,l){var h=new Date().getFullYear(),d=new Date(h,0,1),w=new Date(h,6,1),b=d.getTimezoneOffset(),_=w.getTimezoneOffset(),T=Math.max(b,_);F[i>>2]=T*60,F[a>>2]=+(b!=_);function P(Y){var fe=Y.toTimeString().match(/\(([A-Za-z ]+)\)$/);return fe?fe[1]:"GMT"}var B=P(d),M=P(w),D=Wn(B),I=Wn(M);_<b?(ie[l>>2]=D,ie[l+4>>2]=I):(ie[l>>2]=I,ie[l+4>>2]=D)}function Ss(i,a,l){Ss.called||(Ss.called=!0,rg(i,a,l))}function ng(){Gt("")}function yu(){return 2147483648}function og(){return yu()}function sg(i,a,l){We.copyWithin(i,a,a+l)}function ig(i){try{return te.grow(i-bt.byteLength+65535>>>16),ja(te.buffer),1}catch{}}function ag(i){var a=We.length;i=i>>>0;var l=yu();if(i>l)return!1;let h=(T,P)=>T+(P-T%P)%P;for(var d=1;d<=4;d*=2){var w=a*(1+.2/d);w=Math.min(w,i+100663296);var b=Math.min(l,h(Math.max(i,w),65536)),_=ig(b);if(_)return!0}return!1}var _s={};function ug(){return u||"./this.program"}function Qr(){if(!Qr.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",a={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:ug()};for(var l in _s)_s[l]===void 0?delete a[l]:a[l]=_s[l];var h=[];for(var l in a)h.push(l+"="+a[l]);Qr.strings=h}return Qr.strings}function lg(i,a){var l=0;return Qr().forEach(function(h,d){var w=a+l;ie[i+d*4>>2]=w,Vn(h,w),l+=h.length+1}),0}function cg(i,a){var l=Qr();ie[i>>2]=l.length;var h=0;return l.forEach(function(d){h+=d.length+1}),ie[a>>2]=h,0}function fg(i){Vg(i)}function hg(i){try{var a=le.getStreamFromFD(i);return v.close(a),0}catch(l){if(typeof v>"u"||!(l instanceof v.ErrnoError))throw l;return l.errno}}function pg(i,a,l,h){for(var d=0,w=0;w<l;w++){var b=ie[a>>2],_=ie[a+4>>2];a+=8;var T=v.read(i,Ne,b,_,h);if(T<0)return-1;if(d+=T,T<_)break}return d}function dg(i,a,l,h){try{var d=le.getStreamFromFD(i),w=pg(d,a,l);return F[h>>2]=w,0}catch(b){if(typeof v>"u"||!(b instanceof v.ErrnoError))throw b;return b.errno}}function vg(i,a){return a+2097152>>>0<4194305-!!i?(i>>>0)+a*4294967296:NaN}function gg(i,a,l,h,d){try{var w=vg(a,l);if(isNaN(w))return 61;var b=le.getStreamFromFD(i);return v.llseek(b,w,h),St=[b.position>>>0,(Ie=b.position,+Math.abs(Ie)>=1?Ie>0?(Math.min(+Math.floor(Ie/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ie-+(~~Ie>>>0))/4294967296)>>>0:0)],F[d>>2]=St[0],F[d+4>>2]=St[1],b.getdents&&w===0&&h===0&&(b.getdents=null),0}catch(_){if(typeof v>"u"||!(_ instanceof v.ErrnoError))throw _;return _.errno}}function mg(i,a,l,h){for(var d=0,w=0;w<l;w++){var b=ie[a>>2],_=ie[a+4>>2];a+=8;var T=v.write(i,Ne,b,_,h);if(T<0)return-1;d+=T}return d}function yg(i,a,l,h){try{var d=le.getStreamFromFD(i),w=mg(d,a,l);return ie[h>>2]=w,0}catch(b){if(typeof v>"u"||!(b instanceof v.ErrnoError))throw b;return b.errno}}function wu(i){for(var a=i.split("."),l=0;l<4;l++){var h=Number(a[l]);if(isNaN(h))return null;a[l]=h}return(a[0]|a[1]<<8|a[2]<<16|a[3]<<24)>>>0}function Jr(i){return parseInt(i)}function wg(i){var a,l,h,d,w=/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,b=[];if(!w.test(i))return null;if(i==="::")return[0,0,0,0,0,0,0,0];for(i.startsWith("::")?i=i.replace("::","Z:"):i=i.replace("::",":Z:"),i.indexOf(".")>0?(i=i.replace(new RegExp("[.]","g"),":"),a=i.split(":"),a[a.length-4]=Jr(a[a.length-4])+Jr(a[a.length-3])*256,a[a.length-3]=Jr(a[a.length-2])+Jr(a[a.length-1])*256,a=a.slice(0,a.length-2)):a=i.split(":"),h=0,d=0,l=0;l<a.length;l++)if(typeof a[l]=="string")if(a[l]==="Z"){for(d=0;d<8-a.length+1;d++)b[l+d]=0;h=d-1}else b[l+h]=ku(parseInt(a[l],16));else b[l+h]=a[l];return[b[1]<<16|b[0],b[3]<<16|b[2],b[5]<<16|b[4],b[7]<<16|b[6]]}var Ht={address_map:{id:1,addrs:{},names:{}},lookup_name:function(i){var a=wu(i);if(a!==null||(a=wg(i),a!==null))return i;var l;if(Ht.address_map.addrs[i])l=Ht.address_map.addrs[i];else{var h=Ht.address_map.id++;K(h<65535,"exceeded max address mappings of 65535"),l="172.29."+(h&255)+"."+(h&65280),Ht.address_map.names[l]=i,Ht.address_map.addrs[i]=l}return l},lookup_addr:function(i){return Ht.address_map.names[i]?Ht.address_map.names[i]:null}};function bg(i){var a=xt(20),l=xt(i.length+1);Te(i,l,i.length+1),ie[a>>2]=l;var h=xt(4);ie[h>>2]=0,ie[a+4>>2]=h;var d=2;F[a+8>>2]=d,F[a+12>>2]=4;var w=xt(12);return ie[w>>2]=w+8,ie[w+4>>2]=0,F[w+8>>2]=wu(Ht.lookup_name(i)),ie[a+16>>2]=w,a}function Sg(i){return bg(oe(i))}function _g(i){var a=i.getExtension("ANGLE_instanced_arrays");if(a)return i.vertexAttribDivisor=function(l,h){a.vertexAttribDivisorANGLE(l,h)},i.drawArraysInstanced=function(l,h,d,w){a.drawArraysInstancedANGLE(l,h,d,w)},i.drawElementsInstanced=function(l,h,d,w,b){a.drawElementsInstancedANGLE(l,h,d,w,b)},1}function Eg(i){var a=i.getExtension("OES_vertex_array_object");if(a)return i.createVertexArray=function(){return a.createVertexArrayOES()},i.deleteVertexArray=function(l){a.deleteVertexArrayOES(l)},i.bindVertexArray=function(l){a.bindVertexArrayOES(l)},i.isVertexArray=function(l){return a.isVertexArrayOES(l)},1}function Tg(i){var a=i.getExtension("WEBGL_draw_buffers");if(a)return i.drawBuffers=function(l,h){a.drawBuffersWEBGL(l,h)},1}function xg(i){return!!(i.multiDrawWebgl=i.getExtension("WEBGL_multi_draw"))}var be={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(a){be.lastError||(be.lastError=a)},getNewId:function(i){for(var a=be.counter++,l=i.length;l<a;l++)i[l]=null;return a},getSource:function(i,a,l,h){for(var d="",w=0;w<a;++w){var b=h?F[h+w*4>>2]:-1;d+=oe(F[l+w*4>>2],b<0?void 0:b)}return d},createContext:function(i,a){if(!i.getContextSafariWebGL2Fixed){let d=function(w,b){var _=i.getContextSafariWebGL2Fixed(w,b);return w=="webgl"==_ instanceof WebGLRenderingContext?_:null};i.getContextSafariWebGL2Fixed=i.getContext,i.getContext=d}var l=i.getContext("webgl",a);if(!l)return 0;var h=be.registerContext(l,a);return h},registerContext:function(i,a){var l=be.getNewId(be.contexts),h={handle:l,attributes:a,version:a.majorVersion,GLctx:i};return i.canvas&&(i.canvas.GLctxObject=h),be.contexts[l]=h,(typeof a.enableExtensionsByDefault>"u"||a.enableExtensionsByDefault)&&be.initExtensions(h),l},makeContextCurrent:function(i){return be.currentContext=be.contexts[i],r.ctx=Ye=be.currentContext&&be.currentContext.GLctx,!(i&&!Ye)},getContext:function(i){return be.contexts[i]},deleteContext:function(i){be.currentContext===be.contexts[i]&&(be.currentContext=null),typeof JSEvents=="object"&&JSEvents.removeAllHandlersOnTarget(be.contexts[i].GLctx.canvas),be.contexts[i]&&be.contexts[i].GLctx.canvas&&(be.contexts[i].GLctx.canvas.GLctxObject=void 0),be.contexts[i]=null},initExtensions:function(i){if(i||(i=be.currentContext),!i.initExtensionsDone){i.initExtensionsDone=!0;var a=i.GLctx;_g(a),Eg(a),Tg(a),a.disjointTimerQueryExt=a.getExtension("EXT_disjoint_timer_query"),xg(a);var l=a.getSupportedExtensions()||[];l.forEach(function(h){!h.includes("lose_context")&&!h.includes("debug")&&a.getExtension(h)})}}};function bu(i){return i.slice(-1)=="]"&&i.lastIndexOf("[")}function kg(i){var a=i.uniformLocsById,l=i.uniformSizeAndIdsByName,h,d;if(!a)for(i.uniformLocsById=a={},i.uniformArrayNamesById={},h=0;h<Ye.getProgramParameter(i,35718);++h){var w=Ye.getActiveUniform(i,h),b=w.name,_=w.size,T=bu(b),P=T>0?b.slice(0,T):b,B=i.uniformIdCounter;for(i.uniformIdCounter+=_,l[P]=[_,B],d=0;d<_;++d)a[B]=d,i.uniformArrayNamesById[B++]=P}}function Cg(i,a){if(a=oe(a),i=be.programs[i]){kg(i);var l=i.uniformLocsById,h=0,d=a,w=bu(a);w>0&&(h=Jr(a.slice(w+1))>>>0,d=a.slice(0,w));var b=i.uniformSizeAndIdsByName[d];if(b&&h<b[0]&&(h+=b[1],l[h]=l[h]||Ye.getUniformLocation(i,a)))return h}else be.recordError(1281);return-1}function zt(i){var a=Ye.currentProgram;if(a){var l=a.uniformLocsById[i];return typeof l=="number"&&(a.uniformLocsById[i]=l=Ye.getUniformLocation(a,a.uniformArrayNamesById[i]+(l>0?"["+l+"]":""))),l}else be.recordError(1282)}function Pg(i,a){Ye.uniform1f(zt(i),a)}function Ag(i,a){Ye.uniform1i(zt(i),a)}var no=[];function Og(i,a,l){if(a<=144)for(var h=no[2*a-1],d=0;d<2*a;d+=2)h[d]=at[l+4*d>>2],h[d+1]=at[l+(4*d+4)>>2];else var h=at.subarray(l>>2,l+a*8>>2);Ye.uniform2fv(zt(i),h)}var oo=[];function Rg(i,a,l){if(a<=144)for(var h=oo[2*a-1],d=0;d<2*a;d+=2)h[d]=F[l+4*d>>2],h[d+1]=F[l+(4*d+4)>>2];else var h=F.subarray(l>>2,l+a*8>>2);Ye.uniform2iv(zt(i),h)}function Dg(i,a,l){if(a<=96)for(var h=no[3*a-1],d=0;d<3*a;d+=3)h[d]=at[l+4*d>>2],h[d+1]=at[l+(4*d+4)>>2],h[d+2]=at[l+(4*d+8)>>2];else var h=at.subarray(l>>2,l+a*12>>2);Ye.uniform3fv(zt(i),h)}function Ug(i,a,l){if(a<=96)for(var h=oo[3*a-1],d=0;d<3*a;d+=3)h[d]=F[l+4*d>>2],h[d+1]=F[l+(4*d+4)>>2],h[d+2]=F[l+(4*d+8)>>2];else var h=F.subarray(l>>2,l+a*12>>2);Ye.uniform3iv(zt(i),h)}function Bg(i,a,l){if(a<=72){var h=no[4*a-1],d=at;l>>=2;for(var w=0;w<4*a;w+=4){var b=l+w;h[w]=d[b],h[w+1]=d[b+1],h[w+2]=d[b+2],h[w+3]=d[b+3]}}else var h=at.subarray(l>>2,l+a*16>>2);Ye.uniform4fv(zt(i),h)}function Mg(i,a,l){if(a<=72)for(var h=oo[4*a-1],d=0;d<4*a;d+=4)h[d]=F[l+4*d>>2],h[d+1]=F[l+(4*d+4)>>2],h[d+2]=F[l+(4*d+8)>>2],h[d+3]=F[l+(4*d+12)>>2];else var h=F.subarray(l>>2,l+a*16>>2);Ye.uniform4iv(zt(i),h)}function Fg(i){}function so(i){return i%4===0&&(i%100!==0||i%400===0)}function Lg(i,a){for(var l=0,h=0;h<=a;l+=i[h++]);return l}var Su=[31,29,31,30,31,30,31,31,30,31,30,31],_u=[31,28,31,30,31,30,31,31,30,31,30,31];function Ig(i,a){for(var l=new Date(i.getTime());a>0;){var h=so(l.getFullYear()),d=l.getMonth(),w=(h?Su:_u)[d];if(a>w-l.getDate())a-=w-l.getDate()+1,l.setDate(1),d<11?l.setMonth(d+1):(l.setMonth(0),l.setFullYear(l.getFullYear()+1));else return l.setDate(l.getDate()+a),l}return l}function Gg(i,a,l,h){var d=F[h+40>>2],w={tm_sec:F[h>>2],tm_min:F[h+4>>2],tm_hour:F[h+8>>2],tm_mday:F[h+12>>2],tm_mon:F[h+16>>2],tm_year:F[h+20>>2],tm_wday:F[h+24>>2],tm_yday:F[h+28>>2],tm_isdst:F[h+32>>2],tm_gmtoff:F[h+36>>2],tm_zone:d?oe(d):""},b=oe(l),_={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var T in _)b=b.replace(new RegExp(T,"g"),_[T]);var P=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],B=["January","February","March","April","May","June","July","August","September","October","November","December"];function M(R,W,Ue){for(var ge=typeof R=="number"?R.toString():R||"";ge.length<W;)ge=Ue[0]+ge;return ge}function D(R,W){return M(R,W,"0")}function I(R,W){function Ue(qe){return qe<0?-1:qe>0?1:0}var ge;return(ge=Ue(R.getFullYear()-W.getFullYear()))===0&&(ge=Ue(R.getMonth()-W.getMonth()))===0&&(ge=Ue(R.getDate()-W.getDate())),ge}function Y(R){switch(R.getDay()){case 0:return new Date(R.getFullYear()-1,11,29);case 1:return R;case 2:return new Date(R.getFullYear(),0,3);case 3:return new Date(R.getFullYear(),0,2);case 4:return new Date(R.getFullYear(),0,1);case 5:return new Date(R.getFullYear()-1,11,31);case 6:return new Date(R.getFullYear()-1,11,30)}}function fe(R){var W=Ig(new Date(R.tm_year+1900,0,1),R.tm_yday),Ue=new Date(W.getFullYear(),0,4),ge=new Date(W.getFullYear()+1,0,4),qe=Y(Ue),ke=Y(ge);return I(qe,W)<=0?I(ke,W)<=0?W.getFullYear()+1:W.getFullYear():W.getFullYear()-1}var Se={"%a":function(R){return P[R.tm_wday].substring(0,3)},"%A":function(R){return P[R.tm_wday]},"%b":function(R){return B[R.tm_mon].substring(0,3)},"%B":function(R){return B[R.tm_mon]},"%C":function(R){var W=R.tm_year+1900;return D(W/100|0,2)},"%d":function(R){return D(R.tm_mday,2)},"%e":function(R){return M(R.tm_mday,2," ")},"%g":function(R){return fe(R).toString().substring(2)},"%G":function(R){return fe(R)},"%H":function(R){return D(R.tm_hour,2)},"%I":function(R){var W=R.tm_hour;return W==0?W=12:W>12&&(W-=12),D(W,2)},"%j":function(R){return D(R.tm_mday+Lg(so(R.tm_year+1900)?Su:_u,R.tm_mon-1),3)},"%m":function(R){return D(R.tm_mon+1,2)},"%M":function(R){return D(R.tm_min,2)},"%n":function(){return`
`},"%p":function(R){return R.tm_hour>=0&&R.tm_hour<12?"AM":"PM"},"%S":function(R){return D(R.tm_sec,2)},"%t":function(){return"	"},"%u":function(R){return R.tm_wday||7},"%U":function(R){var W=R.tm_yday+7-R.tm_wday;return D(Math.floor(W/7),2)},"%V":function(R){var W=Math.floor((R.tm_yday+7-(R.tm_wday+6)%7)/7);if((R.tm_wday+371-R.tm_yday-2)%7<=2&&W++,W){if(W==53){var ge=(R.tm_wday+371-R.tm_yday)%7;ge!=4&&(ge!=3||!so(R.tm_year))&&(W=1)}}else{W=52;var Ue=(R.tm_wday+7-R.tm_yday-1)%7;(Ue==4||Ue==5&&so(R.tm_year%400-1))&&W++}return D(W,2)},"%w":function(R){return R.tm_wday},"%W":function(R){var W=R.tm_yday+7-(R.tm_wday+6)%7;return D(Math.floor(W/7),2)},"%y":function(R){return(R.tm_year+1900).toString().substring(2)},"%Y":function(R){return R.tm_year+1900},"%z":function(R){var W=R.tm_gmtoff,Ue=W>=0;return W=Math.abs(W)/60,W=W/60*100+W%60,(Ue?"+":"-")+("0000"+W).slice(-4)},"%Z":function(R){return R.tm_zone},"%%":function(){return"%"}};b=b.replace(/%%/g,"\0\0");for(var T in Se)b.includes(T)&&(b=b.replace(new RegExp(T,"g"),Se[T](w)));b=b.replace(/\0\0/g,"%");var xe=uo(b,!1);return xe.length>a?0:(Yr(xe,i),xe.length-1)}function Ng(i,a,l,h){return Gg(i,a,l,h)}var Eu=function(i,a,l,h){i||(i=this),this.parent=i,this.mount=i.mount,this.mounted=null,this.id=v.nextInode++,this.name=a,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=h},io=365,ao=146;Object.defineProperties(Eu.prototype,{read:{get:function(){return(this.mode&io)===io},set:function(i){i?this.mode|=io:this.mode&=~io}},write:{get:function(){return(this.mode&ao)===ao},set:function(i){i?this.mode|=ao:this.mode&=~ao}},isFolder:{get:function(){return v.isDir(this.mode)}},isDevice:{get:function(){return v.isChrdev(this.mode)}}}),v.FSNode=Eu,v.staticInit(),Nd(),mr=r.BindingError=us(Error,"BindingError"),iu=r.InternalError=us(Error,"InternalError"),ov(),Zd(),hv(),hu=r.UnboundTypeError=us(Error,"UnboundTypeError"),Ev();for(var Ye,Hg=new Float32Array(288),Tt=0;Tt<288;++Tt)no[Tt]=Hg.subarray(0,Tt+1);for(var zg=new Int32Array(288),Tt=0;Tt<288;++Tt)oo[Tt]=zg.subarray(0,Tt+1);function uo(i,a,l){var h=l>0?l:he(i)+1,d=new Array(h),w=ye(i,d,0,d.length);return a&&(d.length=w),d}var Wg={_:bd,k:Sd,a:_d,b:Td,S:Ad,T:Od,p:Dd,M:Ud,V:Bd,J:Md,K:Fd,t:Ld,L:Id,B:Gd,X:Wd,d:mv,f:yv,e:wv,c:bv,W:Tv,i:kv,h:Cv,w:Av,j:Rv,g:Dv,v:Uv,q:Bv,Y:Mv,P:Fv,O:Iv,m:Gv,la:zv,y:ms,ma:Wv,ka:Xv,r:$v,z:qv,ja:jv,na:Zv,n:Kv,l:Qv,x:Jv,Q:eg,G:tg,R:Ss,s:ng,F:og,N:sg,E:ag,H:lg,I:cg,$:fg,o:hg,U:dg,A:gg,u:yg,Z:Sg,ia:Cg,ga:Pg,ha:Ag,ca:Og,fa:Rg,ba:Dg,ea:Ug,aa:Bg,da:Mg,C:Fg,D:Ng};wd(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.pa).apply(null,arguments)};var xt=r._malloc=function(){return(xt=r._malloc=r.asm.qa).apply(null,arguments)},kt=r._free=function(){return(kt=r._free=r.asm.ra).apply(null,arguments)},Tu=r.___errno_location=function(){return(Tu=r.___errno_location=r.asm.sa).apply(null,arguments)},xu=r.___getTypeName=function(){return(xu=r.___getTypeName=r.asm.ta).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ua).apply(null,arguments)};var ku=r._htons=function(){return(ku=r._htons=r.asm.wa).apply(null,arguments)},Cu=r._emscripten_builtin_memalign=function(){return(Cu=r._emscripten_builtin_memalign=r.asm.xa).apply(null,arguments)},Pu=r.___cxa_is_pointer_type=function(){return(Pu=r.___cxa_is_pointer_type=r.asm.ya).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.za).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.Aa).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.Ba).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.Ca).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.Da).apply(null,arguments)},r.dynCall_viiiiji=function(){return(r.dynCall_viiiiji=r.asm.Ea).apply(null,arguments)},r.FS=v;var lo;function Es(i){this.name="ExitStatus",this.message="Program terminated with exit("+i+")",this.status=i}$r=function i(){lo||Ts(),lo||($r=i)};function Ts(i){if(jt>0||(fd(),jt>0))return;function a(){lo||(lo=!0,r.calledRun=!0,!ne&&(hd(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),pd()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),a()},1)):a()}r.run=Ts;function Vg(i,a){Yg(i)}function Yg(i){eu()||(r.onExit&&r.onExit(i),ne=!0),c(i,new Es(i))}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Ts(),r.ready}})(),Ou="/assets/replicad_single-356dd161.wasm";const co={library:null},Ru=t=>{co.library=t},N=()=>{if(!co.library)throw new Error("oppencascade has not been loaded");return co.library};globalThis.FinalizationRegistry||(console.log("Garbage collection will not work"),globalThis.FinalizationRegistry=()=>({register:()=>null,unregister:()=>null}));const er=new globalThis.FinalizationRegistry(t=>{try{t.delete()}catch(e){console.error(e)}});class pt{constructor(e){this.oc=N(),e&&er.register(this,e,e),this._wrapped=e}get wrapped(){if(this._wrapped===null)throw new Error("This object has been deleted");return this._wrapped}set wrapped(e){this._wrapped&&(er.unregister(this._wrapped),this._wrapped.delete()),er.register(this,e,e),this._wrapped=e}delete(){var e;er.unregister(this.wrapped),(e=this.wrapped)==null||e.delete(),this._wrapped=null}}const Ce=()=>{function t(e){return er.register(t,e),e}return t},xs=t=>{function e(r){return er.register(t,r),r}return e},Pe=t=>{const e=new Set;return[r=>(e.add(r),r),()=>{[...e.values()].forEach(r=>r.delete()),e.clear()},t?e:void 0]},ks=2147483647,et=Math.PI/180,yr=180/Math.PI,fo=t=>Math.round(t*1e3)/1e3,wr=(t,e,r)=>{const n=N(),o=je(t),s=tr(e);let u;if(r){const c=tr(r);u=new n.gp_Ax3_3(o,s,c),c.delete()}else u=new n.gp_Ax3_4(o,s);return o.delete(),s.delete(),u},Cs=(t,e,r)=>{const n=N(),o=je(t),s=tr(e);let u;if(r){const c=tr(r);u=new n.gp_Ax2_2(o,s,c),c.delete()}else u=new n.gp_Ax2_3(o,s);return o.delete(),s.delete(),u},Ps=(t,e)=>{const r=N(),n=je(t),o=tr(e),s=new r.gp_Ax1_2(n,o);return n.delete(),o.delete(),s},Du=(t=[0,0,0])=>{const e=N();if(Array.isArray(t)){if(t.length===3)return new e.gp_Vec_4(...t);if(t.length===2)return new e.gp_Vec_4(...t,0)}else{if(t instanceof re)return new e.gp_Vec_3(t.wrapped.XYZ());if(t.XYZ)return new e.gp_Vec_3(t.XYZ())}return new e.gp_Vec_4(0,0,0)};class re extends pt{constructor(e=[0,0,0]){super(Du(e))}get repr(){return`x: ${fo(this.x)}, y: ${fo(this.y)}, z: ${fo(this.z)}`}get x(){return this.wrapped.X()}get y(){return this.wrapped.Y()}get z(){return this.wrapped.Z()}get Length(){return this.wrapped.Magnitude()}toTuple(){return[this.x,this.y,this.z]}cross(e){return new re(this.wrapped.Crossed(e.wrapped))}dot(e){return this.wrapped.Dot(e.wrapped)}sub(e){return new re(this.wrapped.Subtracted(e.wrapped))}add(e){return new re(this.wrapped.Added(e.wrapped))}multiply(e){return new re(this.wrapped.Multiplied(e))}normalized(){return new re(this.wrapped.Normalized())}normalize(){return this.wrapped.Normalize(),this}getCenter(){return this}getAngle(e){return this.wrapped.Angle(e.wrapped)*yr}projectToPlane(e){const r=e.origin,n=e.zDir,o=this.sub(r),s=n.multiply(o.dot(n)/n.Length**2),u=this.sub(s);return o.delete(),s.delete(),u}equals(e){return this.wrapped.IsEqual(e.wrapped,1e-5,1e-5)}toPnt(){return new this.oc.gp_Pnt_2(this.wrapped.XYZ())}toDir(){return new this.oc.gp_Dir_3(this.wrapped.XYZ())}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Ps(r,n);return this.wrapped.Rotate(o,e*et),o.delete(),this}}const Uu={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]};function Bu(t){return t==="X"||t==="Y"||t==="Z"?Uu[t]:t}function je(t){const e=new re(t),r=e.toPnt();return e.delete(),r}function tr(t){const e=new re(t),r=e.toDir();return e.delete(),r}class rr extends pt{constructor(e){const r=N();super(e||new r.gp_Trsf_1)}translate(e,r=0,n=0){const o=new re(typeof e=="number"?[e,r,n]:e);return this.wrapped.SetTranslation_1(o.wrapped),this}rotate(e,r=[0,0,0],n=[0,0,1]){const o=tr(n),s=je(r),u=new this.oc.gp_Ax1_2(s,o);return this.wrapped.SetRotation_1(u,e*et),u.delete(),o.delete(),s.delete(),this}mirror(e="YZ",r){const n=Ce();let o,s;if(typeof e=="string"){const c=n(As(e,r));o=c.origin,s=c.zDir}else e instanceof Ze?(o=r||e.origin,s=e.zDir):(o=r||[0,0,0],s=e);const u=n(Cs(o,s));return this.wrapped.SetMirror_3(u),this}scale(e,r){const n=je(e);return this.wrapped.SetScale(n,r),n.delete(),this}coordSystemChange(e,r){const n=Ce(),o=n(e==="reference"?new this.oc.gp_Ax3_1:wr(e.origin,e.zDir,e.xDir)),s=n(r==="reference"?new this.oc.gp_Ax3_1:wr(r.origin,r.zDir,r.xDir));return this.wrapped.SetTransformation_1(o,s),this}transformPoint(e){const r=je(e),n=r.Transformed(this.wrapped);return r.delete(),n}transform(e){return new this.oc.BRepBuilderAPI_Transform_2(e,this.wrapped,!0).ModifiedShape(e)}}class Ze{constructor(e,r=null,n=[0,0,1]){this.oc=N();const o=new re(n);if(o.Length===0)throw new Error("normal should be non null");this.zDir=o.normalize();let s;if(r)s=new re(r);else{const u=wr(e,o);s=new re(u.XDirection()),u.delete()}if(s.Length===0)throw new Error("xDir should be non null");this.xDir=s.normalize(),this.yDir=this.zDir.cross(this.xDir).normalize(),this.origin=new re(e)}delete(){this.localToGlobal.delete(),this.xDir.delete(),this.yDir.delete(),this.zDir.delete(),this._origin.delete()}clone(){return new Ze(this.origin,this.xDir,this.zDir)}get origin(){return this._origin}set origin(e){this._origin=e,this._calcTransforms()}translateTo(e){const r=this.clone();return r.origin=new re(e),r}translate(e,r=0,n=0){const o=new re(typeof e=="number"?[e,r,n]:e);return this.translateTo(this.origin.add(o))}translateX(e){return this.translate(e,0,0)}translateY(e){return this.translate(0,e,0)}translateZ(e){return this.translate(0,0,e)}pivot(e,r=[1,0,0]){const n=Bu(r),o=new re(this.zDir).rotate(e,[0,0,0],n),s=new re(this.xDir).rotate(e,[0,0,0],n);return new Ze(this.origin,s,o)}rotate2DAxes(e){const r=new re(this.xDir).rotate(e,[0,0,0],this.zDir);return new Ze(this.origin,r,this.zDir)}_calcTransforms(){const e=new this.oc.gp_Ax3_1,r=wr(this.origin,this.zDir,this.xDir);new this.oc.gp_Trsf_1().SetTransformation_1(e,r),this.globalToLocal=new rr,this.globalToLocal.coordSystemChange("reference",{origin:this.origin,zDir:this.zDir,xDir:this.xDir}),this.localToGlobal=new rr,this.localToGlobal.coordSystemChange({origin:this.origin,zDir:this.zDir,xDir:this.xDir},"reference")}setOrigin2d(e,r){this.origin=this.toWorldCoords([e,r])}toLocalCoords(e){const r=this.globalToLocal.transformPoint(e),n=new re(r);return r.delete(),n}toWorldCoords(e){const r=this.localToGlobal.transformPoint(e),n=new re(r);return r.delete(),n}}const Mu={XY:{xDir:[1,0,0],normal:[0,0,1]},YZ:{xDir:[0,1,0],normal:[1,0,0]},ZX:{xDir:[0,0,1],normal:[0,1,0]},XZ:{xDir:[1,0,0],normal:[0,-1,0]},YX:{xDir:[0,1,0],normal:[0,0,-1]},ZY:{xDir:[0,0,1],normal:[-1,0,0]},front:{xDir:[1,0,0],normal:[0,0,1]},back:{xDir:[-1,0,0],normal:[0,0,-1]},left:{xDir:[0,0,1],normal:[-1,0,0]},right:{xDir:[0,0,-1],normal:[1,0,0]},top:{xDir:[1,0,0],normal:[0,1,0]},bottom:{xDir:[1,0,0],normal:[0,-1,0]}},As=(t,e=[0,0,0])=>{const r=Mu[t];if(!r)throw new Error(`Could not find plane ${t}`);let n;return typeof e=="number"?n=r.normal.map(o=>o*e):n=e,new Ze(n,r.xDir,r.normal)};let Fu=class extends pt{constructor(e){const r=N();let n=e;n||(n=new r.Bnd_Box_1),super(n)}get repr(){const[e,r]=this.bounds;return`${new re(e).repr} - ${new re(r).repr}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0},s={current:0},u={current:0};return this.wrapped.Get(e,r,n,o,s,u),[[e.current,r.current,n.current],[o.current,s.current,u.current]]}get center(){const[[e,r,n],[o,s,u]]=this.bounds;return[e+(o-e)/2,r+(s-r)/2,n+(u-n)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}get depth(){const[[,,e],[,,r]]=this.bounds;return Math.abs(r-e)}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}};function Xe(t="XY",e=[0,0,0]){return t instanceof Ze?t.clone():As(t,e)}function Lu(t,e,r=[0,0,0],n=[0,0,1]){const o=new rr;o.rotate(e,r,n);const s=o.transform(t);return o.delete(),s}function Iu(t,e){const r=new rr;r.translate(e);const n=r.transform(t);return r.delete(),n}function Gu(t,e,r){const n=new rr;n.mirror(e,r);const o=n.transform(t);return n.delete(),o}function Nu(t,e,r){const n=new rr;n.scale(e,r);const o=n.transform(t);return n.delete(),o}function en(t){return Array.isArray(t)&&t.length===2}let tn=null;const Os=t=>{if(tn&&!t)return tn;const r=N().GeomAbs_CurveType;return tn=new Map([[r.GeomAbs_Line,"LINE"],[r.GeomAbs_Circle,"CIRCLE"],[r.GeomAbs_Ellipse,"ELLIPSE"],[r.GeomAbs_Hyperbola,"HYPERBOLA"],[r.GeomAbs_Parabola,"PARABOLA"],[r.GeomAbs_BezierCurve,"BEZIER_CURVE"],[r.GeomAbs_BSplineCurve,"BSPLINE_CURVE"],[r.GeomAbs_OffsetCurve,"OFFSET_CURVE"],[r.GeomAbs_OtherCurve,"OTHER_CURVE"]]),tn},rn=t=>{let e=Os().get(t);if(e||(e=Os(!0).get(t)),!e)throw new Error("unknown type");return e};function Hu(t,e){const r=Math.pow(10,e),n=e<0?t:.01/r+t;return Math.round(n*r)/r}function zu(t){return Array.from(Array(t).keys())}function nr(t){const e=Math.min(...t.map(r=>r.length));return zu(e).map(r=>t.map(n=>n[r]))}function nn(t){return Math.round(t*100)/100}const br=([t,e])=>`(${nn(t)},${nn(e)})`,Rs=(t,e=1e-9)=>{let r=t;return Math.abs(t)<e&&(r=0),r.toFixed(-Math.log10(e))},Ds=(t,e=1e-9)=>Array.from(new Map(t.map(([r,n])=>[`[${Rs(r,e)},${Rs(n,e)}]`,[r,n]])).values()),Ge=([t,e])=>{const r=N();return new r.gp_Pnt2d_3(t,e)},Wu=([t,e])=>{const r=N();return new r.gp_Dir2d_4(t,e)},Us=([t,e])=>{const r=N();return new r.gp_Vec2d_4(t,e)},or=(t,e)=>{const r=N(),[n,o]=Pe(),s=new r.gp_Ax2d_2(n(Ge(t)),n(Wu(e)));return o(),s};class Sr extends pt{constructor(e){const r=N();let n=e;n||(n=new r.Bnd_Box2d),super(n)}get repr(){const[e,r]=this.bounds;return`${br(e)} - ${br(r)}`}get bounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.wrapped.Get(e,r,n,o),[[e.current,r.current],[n.current,o.current]]}get center(){const[[e,r],[n,o]]=this.bounds;return[e+(n-e)/2,r+(o-r)/2]}get width(){const[[e],[r]]=this.bounds;return Math.abs(r-e)}get height(){const[[,e],[,r]]=this.bounds;return Math.abs(r-e)}outsidePoint(e=1){const[r,n]=this.bounds,o=n[0]-r[0],s=n[1]-r[1];return[n[0]+o/100*e,n[1]+s/100*e*.9]}add(e){this.wrapped.Add_1(e.wrapped)}isOut(e){return this.wrapped.IsOut_4(e.wrapped)}containsPoint(e){const n=Ce()(Ge(e));return!this.wrapped.IsOut_1(n)}}const He=([t,e],[r,n],o=1e-6)=>Math.abs(t-r)<=o&&Math.abs(e-n)<=o,sr=([t,e],[r,n])=>[t+r,e+n],ho=([t,e],[r,n])=>[t-r,e-n],po=([t,e],r)=>[t*r,e*r],lt=([t,e],[r,n]=[0,0])=>Math.sqrt((t-r)**2+(e-n)**2),Vu=([t,e],[r,n]=[0,0])=>(t-r)**2+(e-n)**2;function Yu([t,e],[r,n]){return t*n-e*r}const Xu=([t,e],[r,n]=[0,0])=>Math.atan2(n*t-e*r,t*r+e*n),$u=([t,e],[r,n]=[0,0])=>Math.atan2(n-e,r-t),Ct=([t,e])=>{const r=lt([t,e]);return[t/r,e/r]},qu=(t,e,r=[0,0])=>{const[n,o]=t,[s,u]=r,c=n-s,f=o-u,p=Math.sin(e),g=Math.cos(e),y=c*g-f*p,m=c*p+f*g;return[y+s,m+u]},ir=(t,e)=>{const r=Math.cos(e)*t,n=Math.sin(e)*t;return[r,n]},ju=([t,e])=>{const r=lt([t,e]),n=Math.atan2(e,t);return[r,n]};class _e extends pt{constructor(e){const r=N(),n=e.get();super(new r.Handle_Geom2d_Curve_2(n)),this._boundingBox=null}get boundingBox(){if(this._boundingBox)return this._boundingBox;const e=N(),r=new e.Bnd_Box2d;return e.BndLib_Add2dCurve.Add_3(this.wrapped,1e-6,r),this._boundingBox=new Sr(r),this._boundingBox}get repr(){return`${this.geomType} ${br(this.firstPoint)} - ${br(this.lastPoint)}`}get innerCurve(){return this.wrapped.get()}value(e){const r=this.innerCurve.Value(e),n=[r.X(),r.Y()];return r.delete(),n}get firstPoint(){return this.value(this.firstParameter)}get lastPoint(){return this.value(this.lastParameter)}get firstParameter(){return this.innerCurve.FirstParameter()}get lastParameter(){return this.innerCurve.LastParameter()}adaptor(){const e=N();return new e.Geom2dAdaptor_Curve_2(this.wrapped)}get geomType(){const e=this.adaptor(),r=rn(e.GetType());return e.delete(),r}clone(){return new _e(this.innerCurve.Copy())}reverse(){this.innerCurve.Reverse()}distanceFromPoint(e){const r=N(),n=Ce(),o=n(new r.Geom2dAPI_ProjectPointOnCurve_2(n(Ge(e)),this.wrapped));let s=1/0;try{s=o.LowerDistance()}catch{s=1/0}return Math.min(s,lt(e,this.firstPoint),lt(e,this.lastPoint))}distanceFromCurve(e){const r=N(),n=Ce();let o=1/0;const s=n(new r.Geom2dAPI_ExtremaCurveCurve(this.wrapped,e.wrapped,this.firstParameter,this.lastParameter,e.firstParameter,e.lastParameter));try{o=s.LowerDistance()}catch{o=1/0}return Math.min(o,this.distanceFromPoint(e.firstPoint),this.distanceFromPoint(e.lastPoint),e.distanceFromPoint(this.firstPoint),e.distanceFromPoint(this.lastPoint))}distanceFrom(e){return en(e)?this.distanceFromPoint(e):this.distanceFromCurve(e)}isOnCurve(e){return this.distanceFromPoint(e)<1e-9}parameter(e,r=1e-9){const n=N(),o=Ce();let s,u;try{const c=o(new n.Geom2dAPI_ProjectPointOnCurve_2(o(Ge(e)),this.wrapped));s=c.LowerDistance(),u=c.LowerDistanceParameter()}catch{if(He(e,this.firstPoint,r))return this.firstParameter;if(He(e,this.lastPoint,r))return this.lastParameter;throw new Error("Failed to find parameter")}if(s>r)throw new Error(`Point ${br(e)} not on curve ${this.repr}, ${s.toFixed(9)}`);return u}tangentAt(e){const r=N(),[n,o]=Pe();let s;Array.isArray(e)?s=this.parameter(e):s=(this.innerCurve.LastParameter()-this.innerCurve.FirstParameter())*e+this.innerCurve.FirstParameter();const u=n(new r.gp_Pnt2d_1),c=n(new r.gp_Vec2d_1);this.innerCurve.D1(s,u,c);const f=[c.X(),c.Y()];return o(),f}splitAt(e,r=1e-9){const n=N(),o=Ce();let s=e.map(f=>en(f)?this.parameter(f,r):f);s=Array.from(new Map(s.map(f=>[Hu(f,-Math.log10(r)),f])).values()).sort((f,p)=>f-p);const u=this.firstParameter,c=this.lastParameter;return u>c&&s.reverse(),Math.abs(s[0]-u)<r*100&&(s=s.slice(1)),s.length?(Math.abs(s[s.length-1]-c)<r*100&&(s=s.slice(0,-1)),s.length?nr([[u,...s],[...s,c]]).map(([f,p])=>{try{if(this.geomType==="BEZIER_CURVE"){const y=new n.Geom2d_BezierCurve_1(o(this.adaptor()).Bezier().get().Poles_2());return y.Segment(f,p),new _e(new n.Handle_Geom2d_Curve_2(y))}if(this.geomType==="BSPLINE_CURVE"){const y=o(this.adaptor()).BSpline().get(),m=new n.Geom2d_BSplineCurve_1(y.Poles_2(),y.Knots_2(),y.Multiplicities_2(),y.Degree(),y.IsPeriodic());return m.Segment(f,p,r),new _e(new n.Handle_Geom2d_Curve_2(m))}const g=new n.Geom2d_TrimmedCurve(this.wrapped,f,p,!0,!0);return new _e(new n.Handle_Geom2d_Curve_2(g))}catch{throw new Error("Failed to split the curve")}}):[this]):[this]}}const Bs=(t,e=1e-8)=>{const r=N(),o=Ce()(new r.Geom2dConvert_ApproxCurve_2(t.ShallowCopy(),e,r.GeomAbs_Shape.GeomAbs_C0,30,3));return new _e(o.Curve())},Ms=t=>{if(rn(t.GetType())!=="BSPLINE_CURVE")throw new Error("You can only convert a Bspline");const e=t.BSpline(),r=N(),n=new r.Geom2dConvert_BSplineCurveToBezierCurve_1(e);function*o(){const u=n.NbArcs();if(u)for(let c=1;c<=u;c++){const f=n.Arc(c);yield new _e(f)}}const s=Array.from(o());return n.delete(),s};function*Fs(t){const e=t.NbPoints();if(e)for(let r=1;r<=e;r++){const n=t.Point(r);yield[n.X(),n.Y()]}}function*Zu(t){const e=t.NbSegments();if(!e)return;const r=N();for(let n=1;n<=e;n++){const o=new r.Handle_Geom2d_Curve_1,s=new r.Handle_Geom2d_Curve_1;try{t.Segment(n,o,s)}catch{continue}yield new _e(o),s.delete()}}const _r=(t,e,r=1e-9)=>{if(t.boundingBox.isOut(e.boundingBox))return{intersections:[],commonSegments:[],commonSegmentsPoints:[]};const n=N(),o=new n.Geom2dAPI_InterCurveCurve_1;let s,u;try{o.Init_1(t.wrapped,e.wrapped,r),s=Array.from(Fs(o)),u=Array.from(Zu(o))}catch(p){throw console.error(t,e,p),new Error("Intersections failed between curves")}finally{o.delete()}const c=u.filter(p=>He(p.firstPoint,p.lastPoint,r)).map(p=>p.firstPoint);c.length&&(s.push(...c),u=u.filter(p=>!He(p.firstPoint,p.lastPoint,r)));const f=u.flatMap(p=>[p.firstPoint,p.lastPoint]);return{intersections:s,commonSegments:u,commonSegmentsPoints:f}},Ku=(t,e=1e-9)=>{const r=N(),n=new r.Geom2dAPI_InterCurveCurve_1;let o;try{n.Init_1(t.wrapped,t.wrapped,e),o=Array.from(Fs(n))}catch{throw new Error("Self intersection failed")}finally{n.delete()}return o},Er=(t,e)=>{const r=N(),[n,o]=Pe(),s=n(new r.GCE2d_MakeSegment_1(n(Ge(t)),n(Ge(e)))).Value(),u=new _e(s);return He(u.firstPoint,t)||u.reverse(),o(),u},vo=(t,e,r)=>{const n=N(),[o,s]=Pe(),u=o(new n.GCE2d_MakeArcOfCircle_4(o(Ge(t)),o(Ge(e)),o(Ge(r)))).Value();s();const c=new _e(u);return He(c.firstPoint,t)||c.wrapped.get().SetTrim(c.lastParameter,c.firstParameter,!0,!0),c},Qu=(t,e,r)=>{const n=N(),[o,s]=Pe(),u=o(new n.GCE2d_MakeArcOfCircle_5(o(Ge(t)),o(Us(e)),o(Ge(r)))).Value();s();const c=new _e(u);return He(c.firstPoint,t)||c.wrapped.get().SetTrim(c.lastParameter,c.firstParameter,!0,!0),c},Ju=(t,e,r,n,o=[0,0],s,u=!0)=>{const c=N(),[f,p]=Pe(),g=f(new c.gp_Elips2d_2(f(or(o,s)),t,e,!0)),y=f(new c.GCE2d_MakeArcOfEllipse_1(g,r,n,u)).Value();return p(),new _e(y)},el=(t,e,r)=>{const n=N(),[o,s]=Pe(),u=o(new n.TColgp_Array1OfPnt2d_2(1,e.length+2));u.SetValue(1,o(Ge(t))),e.forEach((f,p)=>{u.SetValue(p+2,o(Ge(f)))}),u.SetValue(e.length+2,o(Ge(r)));const c=new n.Geom2d_BezierCurve_1(u);return s(),new _e(new n.Handle_Geom2d_Curve_2(c))},Ls=(t,e,r)=>{const n=po(sr(t,e),.5),o=lt(r,t),s=Ct(ho(n,r));return vo(t,sr(po(s,o),r),e)},tl=(t,e,r)=>{const n=Ct(ho(e,t)),o=[n[1],-n[0]],s=[o[0]*r,o[1]*r];return{firstPoint:sr(t,s),lastPoint:sr(e,s)}},go=(t,e)=>{const r=Ce(),n=t.geomType;if(n==="CIRCLE"){const f=r(r(t.adaptor()).Circle()),p=f.Radius(),g=f.IsDirect()?1:-1,y=e*g,m=p+y;if(m<1e-10){const A=r(f.Location()),U=[A.X(),A.Y()],O=V=>{const[L,j]=Ct(ho(V,U));return sr(V,[y*L,y*j])};return{collapsed:!0,firstPoint:O(t.firstPoint),lastPoint:O(t.lastPoint)}}const S=N(),E=new S.gp_Circ2d_3(f.Axis(),m),k=new S.Geom2d_Circle_1(E),x=new S.Geom2d_TrimmedCurve(new S.Handle_Geom2d_Curve_2(k),t.firstParameter,t.lastParameter,!0,!0);return new _e(new S.Handle_Geom2d_Curve_2(x))}if(n==="LINE"){const{firstPoint:f,lastPoint:p}=tl(t.firstPoint,t.lastPoint,e);return Er(f,p)}const o=N(),s=new _e(new o.Handle_Geom2d_Curve_2(new o.Geom2d_OffsetCurve(t.wrapped,e,!0))),u=Bs(s.adaptor());return Ku(u).length?{collapsed:!0,firstPoint:u.firstPoint,lastPoint:u.lastPoint}:u};function Is(t,e,r){const n=Yu(t.tangentAt(1),e.tangentAt(0));if(Math.abs(n)<1e-10)return null;const o=n>0?-1:1,s=Math.abs(r)*o,u=go(t,s),c=go(e,s);if(!(u instanceof _e)||!(c instanceof _e))return null;let f;try{const{intersections:S}=_r(u,c,1e-9);f=S.at(-1)}catch{return null}if(!en(f))return null;const p=f,g=(S,E)=>{const[k,x]=E.tangentAt(p),A=Ct([-x,k]),U=sr(p,po(A,s)),O=S.parameter(U,1e-6);return S.splitAt([O])},[y]=g(t,u),[,m]=g(e,c);return{first:y,second:m,center:p}}function mo(t,e,r){const n=Is(t,e,r);if(!n)return console.warn("Cannot fillet between curves",t.repr,e.repr),[t,e];const{first:o,second:s,center:u}=n;return[o,Ls(o.lastPoint,s.firstPoint,u),s]}function yo(t,e,r){const n=Is(t,e,r);if(!n)return console.warn("Cannot chamfer between curves",t.repr,e.repr),[t,e];const{first:o,second:s}=n;return[o,Er(o.lastPoint,s.firstPoint),s]}class rl{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,r){let n=this.length++;for(;n>0;){const o=n-1>>1,s=this.values[o];if(r>=s)break;this.ids[n]=this.ids[o],this.values[n]=s,n=o}this.ids[n]=e,this.values[n]=r}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const r=this.ids[0]=this.ids[this.length],n=this.values[0]=this.values[this.length],o=this.length>>1;let s=0;for(;s<o;){let u=(s<<1)+1;const c=u+1;let f=this.ids[u],p=this.values[u];const g=this.values[c];if(c<this.length&&g<p&&(u=c,f=this.ids[c],p=g),p>=n)break;this.ids[s]=f,this.values[s]=p,s=u}this.ids[s]=r,this.values[s]=n}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Gs=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],wo=3;class bo{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==251)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!==wo)throw new Error(`Got v${n>>4} data when expected v${wo}.`);const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new bo(s,o,Gs[n&15],e)}constructor(e,r=16,n=Float64Array,o){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535);let s=e,u=s;this._levelBounds=[s*4];do s=Math.ceil(s/this.nodeSize),u+=s,this._levelBounds.push(u*4);while(s!==1);this.ArrayType=n||Float64Array,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const c=Gs.indexOf(this.ArrayType),f=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(c<0)throw new Error(`Unexpected typed array class: ${n}.`);o&&o instanceof ArrayBuffer?(this.data=o,this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+f+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+f,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(wo<<4)+c]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e),this._queue=new rl}add(e,r,n,o){const s=this._pos>>2;return this._indices[s]=s,this._boxes[this._pos++]=e,this._boxes[this._pos++]=r,this._boxes[this._pos++]=n,this._boxes[this._pos++]=o,e<this.minX&&(this.minX=e),r<this.minY&&(this.minY=r),n>this.maxX&&(this.maxX=n),o>this.maxY&&(this.maxY=o),s}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);if(this.numItems<=this.nodeSize){this._boxes[this._pos++]=this.minX,this._boxes[this._pos++]=this.minY,this._boxes[this._pos++]=this.maxX,this._boxes[this._pos++]=this.maxY;return}const e=this.maxX-this.minX||1,r=this.maxY-this.minY||1,n=new Uint32Array(this.numItems),o=65536-1;for(let s=0;s<this.numItems;s++){let u=4*s;const c=this._boxes[u++],f=this._boxes[u++],p=this._boxes[u++],g=this._boxes[u++],y=Math.floor(o*((c+p)/2-this.minX)/e),m=Math.floor(o*((f+g)/2-this.minY)/r);n[s]=ol(y,m)}So(n,this._boxes,this._indices,0,this.numItems-1,this.nodeSize);for(let s=0,u=0;s<this._levelBounds.length-1;s++){const c=this._levelBounds[s];for(;u<c;){const f=u;let p=1/0,g=1/0,y=-1/0,m=-1/0;for(let S=0;S<this.nodeSize&&u<c;S++)p=Math.min(p,this._boxes[u++]),g=Math.min(g,this._boxes[u++]),y=Math.max(y,this._boxes[u++]),m=Math.max(m,this._boxes[u++]);this._indices[this._pos>>2]=f,this._boxes[this._pos++]=p,this._boxes[this._pos++]=g,this._boxes[this._pos++]=y,this._boxes[this._pos++]=m}}}search(e,r,n,o,s){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const c=[],f=[];for(;u!==void 0;){const p=Math.min(u+this.nodeSize*4,Hs(u,this._levelBounds));for(let g=u;g<p;g+=4){if(n<this._boxes[g]||o<this._boxes[g+1]||e>this._boxes[g+2]||r>this._boxes[g+3])continue;const y=this._indices[g>>2]|0;u<this.numItems*4?(s===void 0||s(y))&&f.push(y):c.push(y)}u=c.pop()}return f}neighbors(e,r,n=1/0,o=1/0,s){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let u=this._boxes.length-4;const c=this._queue,f=[],p=o*o;for(;u!==void 0;){const g=Math.min(u+this.nodeSize*4,Hs(u,this._levelBounds));for(let y=u;y<g;y+=4){const m=this._indices[y>>2]|0,S=Ns(e,this._boxes[y],this._boxes[y+2]),E=Ns(r,this._boxes[y+1],this._boxes[y+3]),k=S*S+E*E;u<this.numItems*4?(s===void 0||s(m))&&c.push((m<<1)+1,k):c.push(m<<1,k)}for(;c.length&&c.peek()&1;)if(c.peekValue()>p||(f.push(c.pop()>>1),f.length===n))return c.clear(),f;u=c.pop()>>1}return c.clear(),f}}function Ns(t,e,r){return t<e?e-t:t<=r?0:t-r}function Hs(t,e){let r=0,n=e.length-1;for(;r<n;){const o=r+n>>1;e[o]>t?n=o:r=o+1}return e[r]}function So(t,e,r,n,o,s){if(Math.floor(n/s)>=Math.floor(o/s))return;const u=t[n+o>>1];let c=n-1,f=o+1;for(;;){do c++;while(t[c]<u);do f--;while(t[f]>u);if(c>=f)break;nl(t,e,r,c,f)}So(t,e,r,n,f,s),So(t,e,r,f+1,o,s)}function nl(t,e,r,n,o){const s=t[n];t[n]=t[o],t[o]=s;const u=4*n,c=4*o,f=e[u],p=e[u+1],g=e[u+2],y=e[u+3];e[u]=e[c],e[u+1]=e[c+1],e[u+2]=e[c+2],e[u+3]=e[c+3],e[c]=f,e[c+1]=p,e[c+2]=g,e[c+3]=y;const m=r[n];r[n]=r[o],r[o]=m}function ol(t,e){let r=t^e,n=65535^r,o=65535^(t|e),s=t&(e^65535),u=r|n>>1,c=r>>1^r,f=o>>1^n&s>>1^o,p=r&o>>1^s>>1^s;r=u,n=c,o=f,s=p,u=r&r>>2^n&n>>2,c=r&n>>2^n&(r^n)>>2,f^=r&o>>2^n&s>>2,p^=n&o>>2^(r^n)&s>>2,r=u,n=c,o=f,s=p,u=r&r>>4^n&n>>4,c=r&n>>4^n&(r^n)>>4,f^=r&o>>4^n&s>>4,p^=n&o>>4^(r^n)&s>>4,r=u,n=c,o=f,s=p,f^=r&o>>8^n&s>>8,p^=n&o>>8^(r^n)&s>>8,r=f^f>>1,n=p^p>>1;let g=t^e,y=n|65535^(g|r);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|g)>>>0}const sl=(t,e=1e-7)=>{const r=new bo(t.length);t.forEach(s=>{const[u,c]=s.firstPoint;r.add(u-e,c-e,u+e,c+e)}),r.finish();const n=[],o=new Set;return t.forEach((s,u)=>{if(o.has(u))return;const c=[s];let f=u;o.add(u);let p=t.length;for(;;){if(p--<0)throw new Error("Infinite loop detected");const g=c[c.length-1].lastPoint,[y,m]=g,S=r.search(y-e,m-e,y+e,m+e),E=U=>Math.abs((f-U)%t.length),k=S.filter(U=>!o.has(U)).map(U=>[t[U],U,E(U)]).sort(([,,U],[,,O])=>E(U)-E(O));if(k.length===0){n.push(c);break}const[x,A]=k[0];c.push(x),o.add(A),f=A}}),n};function tt(t){return Math.round(t*1e5)/1e5}const _o=t=>`${nn(t.X())} ${nn(t.Y())}`,Tr=(t,e)=>{const r=N(),n=rn(t.GetType()),[o,s]=e,u=`${tt(o)} ${tt(s)}`;if(n==="LINE")return`L ${u}`;if(n==="BEZIER_CURVE"){const p=t.Bezier().get(),g=p.Degree();if(g===1)return`L ${u}`;if(g===2)return`Q ${_o(p.Pole(2))} ${u}`;if(g===3){const y=_o(p.Pole(2)),m=_o(p.Pole(3));return`C ${y} ${m} ${u}`}}if(n==="CIRCLE"){const p=t.Circle(),g=p.Radius(),y=t.FirstParameter(),S=(t.LastParameter()-y)*yr,E=S!==360?u:`${tt(o)} ${tt(s+1e-4)}`;return`A ${g} ${g} 0 ${Math.abs(S)>180?"1":"0"} ${p.IsDirect()?"1":"0"} ${E}`}if(n==="ELLIPSE"){const p=t.Ellipse(),g=p.MajorRadius(),y=p.MinorRadius(),m=t.FirstParameter(),E=(t.LastParameter()-m)*yr,k=E!==360?u:`${tt(o)} ${tt(s+1e-4)}`,x=new r.gp_Dir2d_1,A=180-p.XAxis().Direction().Angle(x)*yr;return x.delete(),`A ${tt(g)} ${tt(y)} ${tt(A)} ${Math.abs(E)>180?"1":"0"} ${p.IsDirect()?"1":"0"} ${k}`}if(n==="BSPLINE_CURVE"&&t.BSpline().get().Degree()<4)return Ms(t).map(y=>Tr(y.adaptor(),y.lastPoint)).join(" ");const c=Bs(t);return Ms(c.adaptor()).map(p=>Tr(p.adaptor(),p.lastPoint)).join(" ")},il={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},on={YZ:[1,0,0],XZ:[0,1,0],XY:[0,0,1]};class zs{constructor(){this.filters=[]}delete(){this.filters=[]}and(e){return e.forEach(r=>r(this)),this}not(e){const r=new this.constructor;e(r);const n=({element:o})=>!r.shouldKeep(o);return this.filters.push(n),this}either(e){const r=e.map(o=>{const s=new this.constructor;return o(s),s}),n=({element:o})=>r.some(s=>s.shouldKeep(o));return this.filters.push(n),this}find(e,{unique:r=!1}={}){const n=this.applyFilter(e);if(r){if(n.length!==1)throw console.error(n),new Error("Finder has not found a unique solution");return n[0]}return n}}class Ws extends zs{inList(e){const r=({element:n})=>!!e.find(o=>o.isSame(n));return this.filters.push(r),this}atAngleWith(e="Z",r=0){let n;typeof e=="string"?n=new re(il[e]):n=new re(e);const o=({normal:s})=>{if(!s)return!1;const u=Math.acos(Math.abs(s.dot(n)));return Math.abs(u-et*r)<1e-6};return this.filters.push(o),this}atDistance(e,r=[0,0,0]){const n=je(r),o=N(),s=new o.BRepBuilderAPI_MakeVertex(n),u=s.Vertex();s.delete();const c=new o.BRepExtrema_DistShapeShape_1;c.LoadS1(u);const f=({element:p})=>{const g=Ce();c.LoadS2(p.wrapped);const y=g(new o.Message_ProgressRange_1);return c.Perform(y),Math.abs(c.Value()-e)<1e-6};return this.filters.push(f),xs(f)(c),this}containsPoint(e){return this.atDistance(0,e)}inBox(e,r){const n=N(),o=new n.BRepPrimAPI_MakeBox_4(je(e),je(r)),s=o.Solid();o.delete();const u=new n.BRepExtrema_DistShapeShape_1;u.LoadS1(s);const c=({element:p})=>{const g=Ce();u.LoadS2(p.wrapped);const y=g(new n.Message_ProgressRange_1);return u.Perform(y),u.Value()<1e-6},f=xs(c);return f(s),f(u),this.filters.push(c),this}}class sn extends Ws{clone(){const e=new sn;return e.filters=[...this.filters],e}inDirection(e){return this.atAngleWith(e,0)}ofLength(e){const r=({element:n})=>typeof e=="number"?Math.abs(n.length-e)<1e-9:e(n.length);return this.filters.push(r),this}ofCurveType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}parallelTo(e){if(typeof e=="string"&&on[e])return this.atAngleWith(on[e],90);if(typeof e!="string"&&e instanceof Ze)return this.atAngleWith(e.zDir,90);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r,90),this}return this}inPlane(e,r){const n=e instanceof Ze?Xe(e):Xe(e,r);this.parallelTo(n);const o=({element:s})=>{const u=s.startPoint,c=u.projectToPlane(n);return u.equals(c)};return this.filters.push(o),this}shouldKeep(e){let r=null;try{r=e.tangentAt().normalized()}catch(n){console.error("failed to compute a normal",n)}return this.filters.every(n=>n({normal:r,element:e}))}applyFilter(e){return e.edges.filter(r=>this.shouldKeep(r))}}class Eo extends Ws{clone(){const e=new Eo;return e.filters=[...this.filters],e}parallelTo(e){if(typeof e=="string"&&on[e])return this.atAngleWith(on[e]);if(typeof e!="string"&&e instanceof Ze)return this.atAngleWith(e.zDir);if(typeof e!="string"&&e.normalAt){const r=e.normalAt();return this.atAngleWith(r),this}return this}ofSurfaceType(e){const r=({element:n})=>n.geomType===e;return this.filters.push(r),this}inPlane(e,r){const n=e instanceof Ze?Xe(e):Xe(e,r);this.parallelTo(n);const o=({element:s})=>{const u=s.center,c=u.projectToPlane(n);return u.equals(c)};return this.filters.push(o),this}shouldKeep(e){const r=e.normalAt();return this.filters.every(o=>o({normal:r,element:e}))}applyFilter(e){return e.faces.filter(r=>this.shouldKeep(r))}}const al=function(t){return t.curves.map((e,r)=>({firstCurve:e,secondCurve:t.curves[(r+1)%t.curves.length],point:e.lastPoint}))},To=2*Math.PI,Vs=t=>{const e=t%To,r=e<0?e+To:e;return r<Math.PI?r:r===Math.PI?0:Math.abs(r-To)};class an extends zs{clone(){const e=new an;return e.filters=[...this.filters],e}inList(e){const r=({element:n})=>!!e.find(o=>He(o,n.point));return this.filters.push(r),this}atDistance(e,r=[0,0]){function n({element:o}){return Math.abs(lt(r,o.point)-e)<1e-9}return this.filters.push(n),this}atPoint(e){function r({element:n}){return He(e,n.point)}return this.filters.push(r),this}inBox(e,r){const[n,o]=e,[s,u]=r,c=Math.min(n,s),f=Math.max(n,s),p=Math.min(o,u),g=Math.max(o,u);function y({element:m}){const[S,E]=m.point;return S>=c&&S<=f&&E>=p&&E<=g}return this.filters.push(y),this}ofAngle(e){function r({element:n}){const o=n.firstCurve.tangentAt(1),s=n.secondCurve.tangentAt(0);return Math.abs(Vs(Xu(o,s))-Vs(et*e))<1e-9}return this.filters.push(r),this}shouldKeep(e){return this.filters.every(n=>n({normal:null,element:e}))}applyFilter(e){return al(e).filter(r=>this.shouldKeep(r))}}const Ys=t=>{const e=N();return{vertex:e.TopAbs_ShapeEnum.TopAbs_VERTEX,wire:e.TopAbs_ShapeEnum.TopAbs_WIRE,face:e.TopAbs_ShapeEnum.TopAbs_FACE,shell:e.TopAbs_ShapeEnum.TopAbs_SHELL,solid:e.TopAbs_ShapeEnum.TopAbs_SOLID,solidCompound:e.TopAbs_ShapeEnum.TopAbs_COMPSOLID,compound:e.TopAbs_ShapeEnum.TopAbs_COMPOUND,edge:e.TopAbs_ShapeEnum.TopAbs_EDGE,shape:e.TopAbs_ShapeEnum.TopAbs_SHAPE}[t]},ul=function*(e,r){const n=N(),o=new n.TopExp_Explorer_2(e,Ys(r),Ys("shape")),s=new Map;for(;o.More();){const u=o.Current(),c=u.HashCode(ks);s.get(c)||(s.set(c,!0),yield u),o.Next()}o.delete()},Xs=t=>{if(t.IsNull())throw new Error("This shape has not type, it is null");return t.ShapeType()};class un extends pt{constructor(e){super(e)}clone(){return new this.constructor(Wt(this.wrapped))}get hashCode(){return this.wrapped.HashCode(ks)}get isNull(){return this.wrapped.IsNull()}isSame(e){return this.wrapped.IsSame(e.wrapped)}isEqual(e){return this.wrapped.IsEqual(e.wrapped)}simplify(){const e=N(),r=new e.ShapeUpgrade_UnifySameDomain_2(this.wrapped,!0,!0,!1);r.Build();const n=Ae(r.Shape());if(r.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}translate(e,r=0,n=0){const o=typeof e=="number"?[e,r,n]:e,s=Ae(Iu(this.wrapped,o));if(this.delete(),this.constructor!==s.constructor)throw new Error("unexpected types mismatch");return s}translateX(e){return this.translate([e,0,0])}translateY(e){return this.translate([0,e,0])}translateZ(e){return this.translate([0,0,e])}rotate(e,r=[0,0,0],n=[0,0,1]){const o=Ae(Lu(this.wrapped,e,r,n));if(this.delete(),this.constructor!==o.constructor)throw new Error("unexpected types mismatch");return o}mirror(e,r){const n=Ae(Gu(this.wrapped,e,r));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}scale(e,r=[0,0,0]){const n=Ae(Nu(this.wrapped,r,e));if(this.delete(),this.constructor!==n.constructor)throw new Error("unexpected types mismatch");return n}_iterTopo(e){return ul(this.wrapped,e)}_listTopo(e){return Array.from(this._iterTopo(e)).map(r=>Wt(r))}get edges(){return this._listTopo("edge").map(e=>new Pt(e))}get faces(){return this._listTopo("face").map(e=>new ar(e))}get wires(){return this._listTopo("wire").map(e=>new At(e))}get boundingBox(){const e=new Fu;return this.oc.BRepBndLib.Add(this.wrapped,e.wrapped,!0),e}_mesh({tolerance:e=.001,angularTolerance:r=.1}={}){new this.oc.BRepMesh_IncrementalMesh_2(this.wrapped,e,!1,r,!1)}mesh({tolerance:e=.001,angularTolerance:r=.1}={}){this._mesh({tolerance:e,angularTolerance:r});let n=[],o=[],s=[];const u=[];for(const c of this.faces){const f=c.triangulation(o.length/3);if(!f)continue;const{trianglesIndexes:p,vertices:g,verticesNormals:y}=f;u.push({start:n.length,count:p.length,faceId:c.hashCode}),n=n.concat(p),o=o.concat(g),s=s.concat(y)}return{triangles:n,vertices:o,normals:s,faceGroups:u}}meshEdges({tolerance:e=.001,angularTolerance:r=.1}={}){var n;const o=Ce(),s=new Set,u=[],c=[],f=()=>{const g=u.length;let y=null;return[m=>{y?(u.push(...y),y=[m.X(),m.Y(),m.Z()],u.push(...y)):y=[m.X(),m.Y(),m.Z()]},m=>{c.push({start:g/3,count:(u.length-g)/3,edgeId:m}),s.add(m)}]},p=o(new this.oc.TopLoc_Location_1);for(const g of this.faces){const y=o(this.oc.BRep_Tool.Triangulation(g.wrapped,p,0));if(y.IsNull())continue;const m=y.get();for(const S of g.edges){if(o(S),s.has(S.hashCode))continue;const E=o(new this.oc.TopLoc_Location_1),k=o(this.oc.BRep_Tool.PolygonOnTriangulation_1(S.wrapped,y,E)),x=(n=k==null?void 0:k.get())==null?void 0:n.Nodes();if(!x)continue;o(x);const[A,U]=f();for(let O=x.Lower();O<=x.Upper();O++){const V=o(o(m.Node(x.Value(O))).Transformed(E.Transformation()));A(V)}U(S.hashCode)}}for(const g of this.edges){o(g);const y=g.hashCode;if(s.has(y))continue;const m=o(new this.oc.BRepAdaptor_Curve_2(g.wrapped)),S=o(new this.oc.GCPnts_TangentialDeflection_2(m,e,r,2,1e-9,1e-7)),[E,k]=f();for(let x=0;x<S.NbPoints();x++){const A=o(S.Value(x+1).Transformed(p.Transformation()));E(A)}k(y)}return{lines:u,edgeGroups:c}}blobSTEP(){const e="blob.step",r=new this.oc.STEPControl_Writer_1;this.oc.Interface_Static.SetIVal("write.step.schema",5),r.Model(!0).delete();const n=new this.oc.Message_ProgressRange_1;r.Transfer(this.wrapped,this.oc.STEPControl_StepModelType.STEPControl_AsIs,!0,n);const o=r.Write(e);if(r.delete(),n.delete(),o===this.oc.IFSelect_ReturnStatus.IFSelect_RetDone){const s=this.oc.FS.readFile("/"+e);return this.oc.FS.unlink("/"+e),new Blob([s],{type:"application/STEP"})}else throw new Error("WRITE STEP FILE FAILED.")}blobSTL({tolerance:e=.001,angularTolerance:r=.1,binary:n=!1}={}){this._mesh({tolerance:e,angularTolerance:r});const o="blob.stl";if(this.oc.StlAPI.Write(this.wrapped,o,!n)){const u=this.oc.FS.readFile("/"+o);return this.oc.FS.unlink("/"+o),new Blob([u],{type:"application/sla"})}else throw new Error("WRITE STL FILE FAILED.")}}class $s extends un{}class qs extends un{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr})`;return e.delete(),r.delete(),n}get curve(){return new ll(this._geomAdaptor())}get startPoint(){const e=this.curve,r=e.startPoint;return e.delete(),r}get endPoint(){const e=this.curve,r=e.endPoint;return e.delete(),r}tangentAt(e=0){const r=this.curve,n=r.tangentAt(e);return r.delete(),n}get isClosed(){const e=this.curve,r=e.isClosed;return e.delete(),r}get isPeriodic(){const e=this.curve,r=e.isPeriodic;return e.delete(),r}get period(){const e=this.curve,r=e.period;return e.delete(),r}get geomType(){const e=this.curve,r=e.curveType;return e.delete(),r}get length(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.LinearProperties(this.wrapped,e,!0,!1);const r=e.Mass();return e.delete(),r}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}}class ll extends pt{get repr(){const{startPoint:e,endPoint:r}=this,n=`start: (${this.startPoint.repr}) end:(${this.endPoint.repr}}`;return e.delete(),r.delete(),n}get curveType(){const e=this.wrapped.GetType&&this.wrapped.GetType();return rn(e)}get startPoint(){const e=this.wrapped.Value(this.wrapped.FirstParameter());return new re(e)}get endPoint(){const e=this.wrapped.Value(this.wrapped.LastParameter());return new re(e)}tangentAt(e){let r=e;e||(r=(this.wrapped.LastParameter()-this.wrapped.FirstParameter())/2);const n=new this.oc.gp_Pnt_1,o=new this.oc.gp_Vec_1;this.wrapped.D1(r,n,o);const s=new re(o);return n.delete(),o.delete(),s}get isClosed(){return this.wrapped.IsClosed()}get isPeriodic(){return this.wrapped.IsPeriodic()}get period(){return this.wrapped.Period()}}class Pt extends qs{_geomAdaptor(){return new this.oc.BRepAdaptor_Curve_2(this.wrapped)}}class At extends qs{_geomAdaptor(){return new this.oc.BRepAdaptor_CompCurve_2(this.wrapped,!1)}offset2D(e,r="arc"){const n={arc:this.oc.GeomAbs_JoinType.GeomAbs_Arc,intersection:this.oc.GeomAbs_JoinType.GeomAbs_Intersection,tangent:this.oc.GeomAbs_JoinType.GeomAbs_Tangent},o=new this.oc.BRepOffsetAPI_MakeOffset_3(this.wrapped,n[r],!1);o.Perform(e,0);const s=Ae(o.Shape());if(o.delete(),this.delete(),!(s instanceof At))throw new Error("Could not offset with a wire");return s}}class cl extends pt{get surfaceType(){const e=this.oc.GeomAbs_SurfaceType,n=new Map([[e.GeomAbs_Plane,"PLANE"],[e.GeomAbs_Cylinder,"CYLINDRE"],[e.GeomAbs_Cone,"CONE"],[e.GeomAbs_Sphere,"SPHERE"],[e.GeomAbs_Torus,"TORUS"],[e.GeomAbs_BezierSurface,"BEZIER_SURFACE"],[e.GeomAbs_BSplineSurface,"BSPLINE_SURFACE"],[e.GeomAbs_SurfaceOfRevolution,"REVOLUTION_SURFACE"],[e.GeomAbs_SurfaceOfExtrusion,"EXTRUSION_SURFACE"],[e.GeomAbs_OffsetSurface,"OFFSET_SURFACE"],[e.GeomAbs_OtherSurface,"OTHER_SURFACE"]]).get(this.wrapped.GetType());if(!n)throw new Error("surface type not found");return n}}class ar extends un{_geomAdaptor(){return new this.oc.BRepAdaptor_Surface_2(this.wrapped,!1)}get surface(){return new cl(this._geomAdaptor())}get orientation(){return this.wrapped.Orientation_1()===this.oc.TopAbs_Orientation.TopAbs_FORWARD?"forward":"backward"}get geomType(){const e=this.surface,r=e.surfaceType;return e.delete(),r}get UVBounds(){const e={current:0},r={current:0},n={current:0},o={current:0};return this.oc.BRepTools.UVBounds_1(this.wrapped,e,r,n,o),{uMin:e.current,uMax:r.current,vMin:n.current,vMax:o.current}}pointOnSurface(e,r){const{uMin:n,uMax:o,vMin:s,vMax:u}=this.UVBounds,c=this._geomAdaptor(),f=new this.oc.gp_Pnt_1,p=e*(o-n)+n,g=r*(u-s)+s;c.D0(p,g,f);const y=new re(f);return c.delete(),f.delete(),y}normalAt(e){let r=0,n=0;const o=Ce();if(e){const p=o(this.oc.BRep_Tool.Surface_2(this.wrapped)),g=o(new this.oc.GeomAPI_ProjectPointOnSurf_2(o(je(e)),p,this.oc.Extrema_ExtAlgo.Extrema_ExtAlgo_Grad)),y={current:0},m={current:0};g.LowerDistanceParameters(y,m),r=y.current,n=m.current}else{const{uMin:p,uMax:g,vMin:y,vMax:m}=this.UVBounds;r=.5*(p+g),n=.5*(y+m)}const s=o(new this.oc.gp_Pnt_1),u=o(new this.oc.gp_Vec_1);return o(new this.oc.BRepGProp_Face_2(this.wrapped,!1)).Normal(r,n,s,u),new re(u)}get center(){const e=new this.oc.GProp_GProps_1;this.oc.BRepGProp.SurfaceProperties_2(this.wrapped,e,1e-7,!0);const r=new re(e.CentreOfMass());return e.delete(),r}outerWire(){const e=new At(this.oc.BRepTools.OuterWire(this.wrapped));return this.delete(),e}innerWires(){const e=this.clone().outerWire(),r=this.wires.filter(n=>!e.isSame(n));return e.delete(),this.delete(),r}triangulation(e=0){const r=Ce(),n=r(new this.oc.TopLoc_Location_1),o=r(this.oc.BRep_Tool.Triangulation(this.wrapped,n,0));if(o.IsNull())return null;const s=r(n.Transformation()),u={vertices:[],trianglesIndexes:[],verticesNormals:[]},c=o.get(),f=c.NbNodes();u.vertices=new Array(f*3);for(let E=1;E<=f;E++){const k=r(r(c.Node(E)).Transformed(s));u.vertices[(E-1)*3+0]=k.X(),u.vertices[(E-1)*3+1]=k.Y(),u.vertices[(E-1)*3+2]=k.Z()}const p=r(new this.oc.TColgp_Array1OfDir_2(1,f)),g=r(new this.oc.Poly_Connect_2(o));this.oc.StdPrs_ToolTriangulatedShape.Normal(this.wrapped,g,p),u.verticesNormals=new Array(p.Length()*3);for(let E=p.Lower();E<=p.Upper();E++){const k=r(r(p.Value(E)).Transformed(s));u.verticesNormals[(E-1)*3+0]=k.X(),u.verticesNormals[(E-1)*3+1]=k.Y(),u.verticesNormals[(E-1)*3+2]=k.Z()}const y=this.orientation,m=c.NbTriangles();u.trianglesIndexes=new Array(m*3);let S=0;for(let E=1;E<=m;E++){const k=r(c.Triangle(E));let x=k.Value(1),A=k.Value(2);const U=k.Value(3);if(y==="backward"){const O=x;x=A,A=O}u.trianglesIndexes[S*3+0]=x-1+e,u.trianglesIndexes[S*3+1]=A-1+e,u.trianglesIndexes[S*3+2]=U-1+e,S++}return u}}class ln extends un{fuse(e,{optimisation:r="none"}={}){const n=Ce(),o=n(new this.oc.Message_ProgressRange_1),s=n(new this.oc.BRepAlgoAPI_Fuse_3(this.wrapped,e.wrapped,o));r==="commonFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),s.Build(o),s.SimplifyResult(!0,!0,.001);const u=Ae(s.Shape());if(!dt(u))throw new Error("Could not fuse as a 3d shape");return u}cut(e,{optimisation:r="none"}={}){const n=Ce(),o=n(new this.oc.Message_ProgressRange_1),s=n(new this.oc.BRepAlgoAPI_Cut_3(this.wrapped,e.wrapped,o));r==="commonFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueShift),r==="sameFace"&&s.SetGlue(this.oc.BOPAlgo_GlueEnum.BOPAlgo_GlueFull),s.Build(o),s.SimplifyResult(!0,!0,.001);const u=Ae(s.Shape());if(!dt(u))throw new Error("Could not cut as a 3d shape");return u}intersect(e){const r=Ce(),n=r(new this.oc.Message_ProgressRange_1),o=r(new this.oc.BRepAlgoAPI_Common_3(this.wrapped,e.wrapped,n));o.Build(n),o.SimplifyResult(!0,!0,.001);const s=Ae(o.Shape());if(!dt(s))throw new Error("Could not intersect as a 3d shape");return s}shell(e,r=null,n=.001){const o=typeof r=="number"?r:n;let s,u;if(typeof e=="number"){u=e;const S=new Eo;s=typeof r=="function"?r(S):S}else u=e.thickness,s=e.filter;const c=Ce(),f=s.find(this),p=c(new this.oc.TopTools_ListOfShape_1);f.forEach(S=>{p.Append_1(S.wrapped)});const g=c(new this.oc.Message_ProgressRange_1),y=c(new this.oc.BRepOffsetAPI_MakeThickSolid);y.MakeThickSolidByJoin(this.wrapped,p,-Math.abs(u),o,this.oc.BRepOffset_Mode.BRepOffset_Skin,!1,!1,this.oc.GeomAbs_JoinType.GeomAbs_Arc,!1,g);const m=Ae(y.Shape());if(!dt(m))throw new Error("Could not shell as a 3d shape");return m}_builderIter(e,r){if(typeof e=="number"){let u=0;for(const c of this._iterTopo("edge"))r(e,Wt(c)),u+=1;return u}let n,o=null;typeof e=="function"?n=e:(n=u=>e.filter.shouldKeep(u)?e.radius||1:0,e.filter&&!e.keep&&(o=()=>e.filter.delete()));let s=0;for(const u of this._iterTopo("edge")){const c=Wt(u),f=new Pt(c),p=n(f);p&&(r(p,c),s+=1),f.delete()}return o&&o(),s}fillet(e,r){const o=Ce()(new this.oc.BRepFilletAPI_MakeFillet(this.wrapped,this.oc.ChFi3d_FilletShape.ChFi3d_Rational));let s=e;if(typeof e=="number"&&r&&(s={radius:e,filter:r(new sn)}),!this._builderIter(s,(f,p)=>o.Add_2(f,p)))throw new Error("Could not fillet, no edge was selected");const c=Ae(o.Shape());if(!dt(c))throw new Error("Could not fillet as a 3d shape");return c}chamfer(e,r){const o=Ce()(new this.oc.BRepFilletAPI_MakeChamfer(this.wrapped));let s=e;if(typeof e=="number"&&r&&(s={radius:e,filter:r(new sn)}),!this._builderIter(s,(f,p)=>o.Add_2(f,p)))throw new Error("Could not chamfer, no edge was selected");const c=Ae(o.Shape());if(!dt(c))throw new Error("Could not chamfer as a 3d shape");return c}}class js extends ln{}class cn extends ln{}class Zs extends ln{}class Ks extends ln{}function dt(t){return t instanceof js||t instanceof cn||t instanceof Zs||t instanceof Ks}function Qs(t){return t instanceof At}function Wt(t){const e=N(),r=e.TopAbs_ShapeEnum,n=new Map([[r.TopAbs_EDGE,e.TopoDS.Edge_1],[r.TopAbs_WIRE,e.TopoDS.Wire_1],[r.TopAbs_FACE,e.TopoDS.Face_1],[r.TopAbs_SHELL,e.TopoDS.Shell_1],[r.TopAbs_SOLID,e.TopoDS.Solid_1],[r.TopAbs_COMPSOLID,e.TopoDS.CompSolid_1],[r.TopAbs_COMPOUND,e.TopoDS.Compound_1]]),o=Xs(t),s=n.get(o);if(!s)throw new Error("Could not find a wrapper for this shape type");return s(t)}function Ae(t){const r=N().TopAbs_ShapeEnum,o=new Map([[r.TopAbs_VERTEX,$s],[r.TopAbs_EDGE,Pt],[r.TopAbs_WIRE,At],[r.TopAbs_FACE,ar],[r.TopAbs_SHELL,js],[r.TopAbs_SOLID,cn],[r.TopAbs_COMPSOLID,Zs],[r.TopAbs_COMPOUND,Ks]]).get(Xs(t));if(!o)throw new Error("Could not find a wrapper for this shape type");return new o(Wt(t))}const Js=(t,e)=>{const r=N();return new Pt(new r.BRepBuilderAPI_MakeEdge_3(je(t),je(e)).Edge())},fl=(t,e,r,n=[0,0,0],o=[0,0,1],s=!1)=>{const u=N(),[c,f]=Pe();let p=2*Math.PI;s&&(p=-2*Math.PI);const g=c(new u.Geom2d_Line_3(c(new u.gp_Pnt2d_3(0,0)),c(new u.gp_Dir2d_4(p,t)))),y=e/t,m=g.Value(0),S=g.Value(y*Math.sqrt((2*Math.PI)**2+t**2)),E=c(new u.GCE2d_MakeSegment_1(m,S)),k=new u.Geom_CylindricalSurface_1(c(wr(n,o)),r),x=c(new u.BRepBuilderAPI_MakeEdge_30(c(new u.Handle_Geom2d_Curve_2(E.Value().get())),c(new u.Handle_Geom_Surface_2(k)))).Edge(),A=c(new u.BRepBuilderAPI_MakeWire_2(x)).Wire();return u.BRepLib.BuildCurves3d_2(A),f(),new Pt(A)},fn=t=>{const e=N(),r=new e.BRepBuilderAPI_MakeWire_1;t.forEach(u=>{u instanceof Pt&&r.Add_1(u.wrapped),u instanceof At&&r.Add_2(u.wrapped)});const n=new e.Message_ProgressRange_1;r.Build(n);const o=r.Error();if(o!==e.BRepBuilderAPI_WireError.BRepBuilderAPI_WireDone){const u=new Map([[e.BRepBuilderAPI_WireError.BRepBuilderAPI_EmptyWire,"empty wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_NonManifoldWire,"non manifold wire"],[e.BRepBuilderAPI_WireError.BRepBuilderAPI_DisconnectedWire,"disconnected wire"]]);throw new Error(`Failed to build the wire, ${u.get(o)||"unknown error"}`)}const s=new At(r.Wire());return r.delete(),n.delete(),s},hn=(t,e)=>{const r=N(),n=new r.BRepBuilderAPI_MakeFace_15(t.wrapped,!1);if(e==null||e.forEach(s=>{n.Add(s.wrapped)}),!n.IsDone())throw n.delete(),new Error("Failed to build the face. Your wire might be non planar.");const o=n.Face();return n.delete(),new ar(o)},hl=(t,e)=>{const r=N(),[n,o]=Pe(),s=n(r.BRep_Tool.Surface_2(t.wrapped)),c=n(new r.BRepBuilderAPI_MakeFace_21(s,e.wrapped,!0)).Face();return o(),new ar(c)},ei=t=>{const e=N(),r=je(t),n=new e.BRepBuilderAPI_MakeVertex(r),o=n.Vertex();return n.delete(),new $s(o)},xr=t=>{const e=N(),r=new e.TopoDS_Builder,n=new e.TopoDS_Compound;return r.MakeCompound(n),t.forEach(s=>{r.Add(n,s.wrapped),s.delete()}),Ae(n)};function ti(t){const e=N(),[r,n]=Pe(),o=r(new e.BRepBuilderAPI_Sewing(1e-6,!0,!0,!0,!1));t.forEach(({wrapped:c})=>{o.Add(c)}),o.Perform(r(new e.Message_ProgressRange_1));const s=r(Wt(o.SewedShape())),u=Ae(r(new e.ShapeFix_Solid_1).SolidFromShell(s));if(n(),!(u instanceof cn))throw new Error("Could not make a solid of faces and shells");return u}const ri=(t,e)=>{const r=N(),[n,o]=Pe(),s=n(new r.BRepBuilderAPI_MakeFace_2(t.wrapped));e.forEach(p=>{s.Add(p.wrapped)});const u=n(s.Face()),c=n(new r.ShapeFix_Face_2(u));c.FixOrientation_1();const f=c.Face();return o(),new ar(f)},pl=t=>t==="symmetric"||typeof t=="number"||Array.isArray(t)&&t.length===2,dl=t=>{let e;t?pl(t)?e={endTangent:t}:e={endTangent:0,...t}:e={endTangent:[1,0]};const{endTangent:r,startFactor:n=1,endFactor:o=1,startTangent:s}=e;let u;typeof r=="number"?u=ir(1,r*et):u=r;let c;return typeof s=="number"?c=ir(1,s*et):c=s,{endTangent:u,startFactor:n,endFactor:o,startTangent:c}};function ni(t,e,r,n){const o=t*r+e*n,s=Math.sqrt((t*t+e*e)*(r*r+n*n));let u=Math.acos(o/s);return t*n-e*r<0&&(u=-u),u}function vl([t,e],[r,n],o,s,u,c,f){const p=Math.PI*2;if(o<0&&(o=-o),s<0&&(s=-s),o==0||s==0)throw Error("rx and ry can not be 0");const g=Math.sin(u),y=Math.cos(u),m=(t-r)/2,S=(e-n)/2,E=(t+r)/2,k=(e+n)/2,x=y*m+g*S,A=y*S-g*m,U=x*x/(o*o)+A*A/(s*s);U>1&&(o=o*Math.sqrt(U),s=s*Math.sqrt(U));const O=o*s,V=o*A,L=s*x,j=V*V+L*L;if(!j)throw Error("start point can not be same as end point");let $=Math.sqrt(Math.abs((O*O-j)/j));c==f&&($=-$);const X=$*V/s,te=-$*L/o,ne=y*X-g*te+E,K=g*X+y*te+k,Le=(x-X)/o,Re=(x+X)/o,oe=(A-te)/s,ye=(A+te)/s,Te=ni(1,0,Le,oe);let he=ni(Le,oe,-Re,-ye);for(;he>p;)he-=p;for(;he<0;)he+=p;f||(he-=p);let se=Te+he;for(;se>p;)se-=p;for(;se<0;)se+=p;return{cx:ne,cy:K,startAngle:Te,deltaAngle:he,endAngle:se,clockwise:!!f,rx:o,ry:s}}const oi=(t,e)=>{const r=N(),n=new r.BRepPrimAPI_MakePrism_1(t.wrapped,e.wrapped,!1,!0),o=new cn(Wt(n.Shape()));return n.delete(),o},si=(t,e=[0,0,0],r=[0,0,1],n=360)=>{const o=N(),s=Ps(e,r),u=new o.BRepPrimAPI_MakeRevol_1(t.wrapped,s,n*et,!1),c=Ae(u.Shape());if(s.delete(),u.delete(),!dt(c))throw new Error("Could not revolve to a 3d shape");return c};function kr(t,e,{frenet:r=!1,auxiliarySpine:n,law:o=null,transitionMode:s="right",withContact:u,support:c,forceProfileSpineOthogonality:f}={},p=!1){const g=N(),y=s==="round"?!0:!!f,m=new g.BRepOffsetAPI_MakePipeShell(e.wrapped);if(s){const k={transformed:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_Transformed,round:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RoundCorner,right:g.BRepBuilderAPI_TransitionMode.BRepBuilderAPI_RightCorner}[s];k&&m.SetTransitionMode(k)}c?m.SetMode_4(c):r&&m.SetMode_1(r),n&&m.SetMode_5(n.wrapped,!1,g.BRepFill_TypeOfContact.BRepFill_NoContact),o?m.SetLaw_1(t.wrapped,o,!!u,y):m.Add_1(t.wrapped,!!u,y);const S=new g.Message_ProgressRange_1;m.Build(S),p||m.MakeSolid();const E=Ae(m.Shape());if(!dt(E))throw new Error("Could not sweep to a 3d shape");if(p){const k=Ae(m.FirstShape()),x=Ae(m.LastShape());if(!Qs(k))throw new Error("Could not sweep with one start wire");if(!Qs(x))throw new Error("Could not sweep with one end wire");return m.delete(),[E,k,x]}return m.delete(),S.delete(),E}const ii=(t,{profile:e,endFactor:r=1})=>{let n;const o=N();if(e==="s-curve")n=new o.Law_S,n.Set_1(0,1,t,r);else if(e==="linear")n=new o.Law_Linear,n.Set(0,1,t,r);else throw new Error("Could not generate a law function");return n.Trim(0,t,1e-6)};function ai(t,e,r,n,o=!1){const s=new re(e),u=new re(r),c=Js(s,s.add(u)),f=fn([c]),p=n?ii(u.Length,n):null;return o?kr(t,f,{law:p},o):kr(t,f,{law:p},o)}function ui(t,e,r,n,o,s=!1){const u=new re(r),c=new re(n),f=Js(u,u.add(c)),p=fn([f]),g=360/e*c.Length,y=1,m=fl(g,c.Length,y,r,n),S=o?ii(c.Length,o):null;return s?kr(t,p,{auxiliarySpine:m,law:S},s):kr(t,p,{auxiliarySpine:m,law:S},s)}const gl=(t,{ruled:e=!0,startPoint:r,endPoint:n}={},o=!1)=>{const s=N(),[u,c]=Pe(),f=u(new s.BRepOffsetAPI_ThruSections(!o,e,1e-6));r&&f.AddVertex(u(ei(r)).wrapped),t.forEach(y=>f.AddWire(y.wrapped)),n&&f.AddVertex(u(ei(n)).wrapped);const p=u(new s.Message_ProgressRange_1);f.Build(p);const g=Ae(f.Shape());if(c(),!dt(g))throw new Error("Could not loft to a 3d shape");return g};class Cr{constructor(e,{defaultOrigin:r=[0,0,0],defaultDirection:n=[0,0,1]}={}){this.wire=e,this.defaultOrigin=r,this.defaultDirection=n,this.baseFace=null}get baseFace(){return this._baseFace}set baseFace(e){e?this._baseFace=e.clone():this._baseFace=e}delete(){this.wire.delete(),this._defaultOrigin.delete(),this._defaultDirection.delete(),this.baseFace&&this.baseFace.delete()}clone(){const e=new Cr(this.wire.clone(),{defaultOrigin:this.defaultOrigin,defaultDirection:this.defaultDirection});return this.baseFace&&(e.baseFace=this.baseFace.clone()),e}get defaultOrigin(){return this._defaultOrigin}set defaultOrigin(e){this._defaultOrigin=new re(e)}get defaultDirection(){return this._defaultDirection}set defaultDirection(e){this._defaultDirection=new re(e)}face(){let e;return this.baseFace?e=hl(this.baseFace,this.wire):e=hn(this.wire),e}wires(){return this.wire.clone()}faces(){return this.face()}revolve(e,{origin:r}={}){const n=hn(this.wire),o=si(n,r||this.defaultOrigin,e);return n.delete(),this.delete(),o}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:s}={}){const[u,c]=Pe(),f=u(new re(r||this.defaultDirection).normalized().multiply(e));if(n&&!o){const y=ai(this.wire,s||this.defaultOrigin,f,n);return c(),this.delete(),y}if(o){const y=ui(this.wire,o,s||this.defaultOrigin,f,n);return c(),this.delete(),y}const p=hn(this.wire),g=oi(p,f);return c(),this.delete(),g}sweepSketch(e,r={}){const n=this.wire.startPoint,o=this.wire.tangentAt(1e-9).multiply(-1).normalize(),s=o.cross(this.defaultDirection).multiply(-1),u=e(new Ze(n,s,o),n),c={forceProfileSpineOthogonality:!0,...r};this.baseFace&&(c.support=this.baseFace.wrapped);const f=kr(u.wire,this.wire,c);return this.delete(),f}loftWith(e,r={},n=!1){const o=Array.isArray(e)?[this,...e]:[this,e],s=gl(o.map(u=>u.wire),r,n);return o.forEach(u=>u.delete()),s}}const ml=t=>{const e=N(),r=new e.Bnd_Box2d;return t.forEach(n=>{e.BndLib_Add2dCurve.Add_3(n.wrapped,1e-6,r)}),new Sr(r)};function yl(t,e){const[r,n]=Pe(),o=r(Cs(e.origin,e.zDir,e.xDir)),s=N(),u=t.map(c=>{const f=s.GeomLib.To3d(o,c.wrapped);return new Pt(new s.BRepBuilderAPI_MakeEdge_24(f).Edge())});return n(),u}const wl=(t,e)=>{const[r,n]=Pe(),o=N(),s=t.map(u=>{const c=r(new o.BRepBuilderAPI_MakeEdge_30(u.wrapped,e));return new Pt(c.Edge())});return n(),s},li=(t,e)=>{const r=N();return t.map(o=>e?new _e(r.GeomLib.GTransform(o.wrapped,e)):o.clone())};class Pr extends pt{transformCurves(e){return li(e,this.wrapped)}}const ci=(t,e,r=[0,0])=>{const n=N(),o=or(r,e),s=new n.gp_GTrsf2d_1;return s.SetAffinity(o,t),o.delete(),new Pr(s)},bl=t=>{const e=N(),[r,n]=Pe(),o=new e.gp_Trsf2d_1;o.SetTranslation_1(r(Us(t)));const s=new e.gp_GTrsf2d_2(o);return n(),new Pr(s)},Sl=(t,e=[0,0],r="center")=>{const n=N(),[o,s]=Pe(),u=new n.gp_Trsf2d_1;r==="center"?u.SetMirror_1(o(Ge(t))):u.SetMirror_2(o(or(e,t)));const c=new n.gp_GTrsf2d_2(u);return s(),new Pr(c)},_l=(t,e=[0,0])=>{const r=N(),[n,o]=Pe(),s=new r.gp_Trsf2d_1;s.SetRotation(n(Ge(e)),t);const u=new r.gp_GTrsf2d_2(s);return o(),new Pr(u)},El=(t,e=[0,0])=>{const r=N(),[n,o]=Pe(),s=new r.gp_Trsf2d_1;s.SetScale(n(Ge(e)),t);const u=new r.gp_GTrsf2d_2(s);return o(),new Pr(u)};function Tl(t,e,r="original"){const[n,o]=Pe(),s=N();let u=n(s.BRep_Tool.Surface_2(e.wrapped));const c=e.UVBounds;let f=null;const p=n(or([0,0],[0,1])),g=n(or([0,0],[1,0]));if(r==="original"&&e.geomType!=="PLANE"){if(e.geomType!=="CYLINDRE")throw new Error("Only planar and cylidrical faces can be unwrapped for sketching");const S=n(u.get().Cylinder());S.Direct()||(u=u.get().UReversed());const E=S.Radius();f=ci(1/E,[0,1]).wrapped}if(r==="bounds"){if(f=n(new s.gp_GTrsf2d_1),f.SetAffinity(p,c.uMax-c.uMin),c.uMin!==0){const E=n(new s.gp_GTrsf2d_1);E.SetTranslationPart(new s.gp_XY_2(0,-c.uMin)),f.Multiply(E)}const S=n(new s.gp_GTrsf2d_1);if(S.SetAffinity(g,c.vMax-c.vMin),f.Multiply(S),c.vMin!==0){const E=n(new s.gp_GTrsf2d_1);E.SetTranslationPart(n(new s.gp_XY_2(0,-c.vMin))),f.Multiply(E)}}const y=li(t,f),m=wl(y,u);return o(),m}const pn=(t,e=1)=>{const r=t.bounds[0][0]-e,n=-t.bounds[1][1]-e;return`${r} ${n} ${t.width+2*e} ${t.height+2*e}`},xo=(t,e,r=1)=>`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="${pn(e,r)}" fill="none" stroke="black" stroke-width="0.6%" vector-effect="non-scaling-stroke">
    ${t}
</svg>`;class ae{constructor(e){this.curves=e,this._boundingBox=null,this._orientation=null,this._guessedOrientation=null}delete(){this.curves.forEach(e=>e.delete()),this._boundingBox&&this._boundingBox.delete()}clone(){return new ae(this.curves)}get repr(){return["Blueprint",...this.curves.map(e=>e.repr)].join(`
`)}get boundingBox(){return this._boundingBox||(this._boundingBox=ml(this.curves)),this._boundingBox}get orientation(){if(this._orientation)return this._orientation;if(this._guessedOrientation)return this._guessedOrientation;const e=this.curves.flatMap(n=>n.geomType!=="LINE"?[n.firstPoint,n.value(.5)]:[n.firstPoint]),r=e.map((n,o)=>{const s=e[(o+1)%e.length];return(s[0]-n[0])*(s[1]+n[1])}).reduce((n,o)=>n+o,0);return this._guessedOrientation=r>0?"clockwise":"counterClockwise",this._guessedOrientation}stretch(e,r,n=[0,0]){const o=ci(e,r,n).transformCurves(this.curves);return new ae(o)}scale(e,r){const n=r||this.boundingBox.center,o=El(e,n).transformCurves(this.curves);return new ae(o)}rotate(e,r){const n=_l(e*et,r).transformCurves(this.curves);return new ae(n)}translate(e,r=0){const n=en(e)?e:[e,r],o=bl(n).transformCurves(this.curves);return new ae(o)}mirror(e,r=[0,0],n="center"){const o=Sl(e,r,n).transformCurves(this.curves);return new ae(o)}sketchOnPlane(e,r){const n=e instanceof Ze?Xe(e):Xe(e,r),o=yl(this.curves,n),s=fn(o);return new Cr(s,{defaultOrigin:n.origin,defaultDirection:n.zDir})}sketchOnFace(e,r){const n=N(),o=Tl(this.curves,e,r),s=fn(o);n.BRepLib.BuildCurves3d_2(s.wrapped);const u=new n.ShapeFix_Wire_2(s.wrapped,e.wrapped,1e-9);u.FixEdgeCurves(),u.delete();const c=new Cr(s);if(s.isClosed){const f=c.clone().face();c.defaultOrigin=f.pointOnSurface(.5,.5),c.defaultDirection=f.normalAt(),f.orientation!==e.orientation&&(c.defaultDirection=c.defaultDirection.multiply(-1)),c.baseFace=e}else{const f=s.startPoint;c.defaultOrigin=f,c.defaultDirection=e.normalAt(f),c.baseFace=e}return c}toSVGPathD(){const e=Ce(),r=this.clone().mirror([1,0],[0,0],"plane"),n=r.curves.flatMap(u=>{if((u.geomType==="ELLIPSE"||u.geomType==="CIRCLE")&&He(u.firstPoint,u.lastPoint)){const[c,f]=u.splitAt([.5]);return[Tr(e(c.adaptor()),c.lastPoint),Tr(e(f.adaptor()),f.lastPoint)]}return Tr(e(u.adaptor()),u.lastPoint)}),[o,s]=r.curves[0].firstPoint;return`M ${tt(o)} ${tt(s)} ${n.join(" ")}${r.isClosed()?" Z":""}`}toSVGPath(){return`<path d="${this.toSVGPathD()}" />`}toSVGViewBox(e=1){return pn(this.boundingBox,e)}toSVGPaths(){return[this.toSVGPathD()]}toSVG(e=1){return xo(this.toSVGPath(),this.boundingBox,e)}get firstPoint(){return this.curves[0].firstPoint}get lastPoint(){return this.curves[this.curves.length-1].lastPoint}isInside(e){if(!this.boundingBox.containsPoint(e))return!1;const r=N(),n=new r.Geom2dAPI_InterCurveCurve_1,o=Er(e,this.boundingBox.outsidePoint());let s=0;return this.curves.find(c=>c.isOnCurve(e))?!1:(this.curves.forEach(c=>{c.boundingBox.isOut(o.boundingBox)||(n.Init_1(o.wrapped,c.wrapped,1e-9),s+=n.NbPoints())}),n.delete(),!!(s%2))}isClosed(){return He(this.firstPoint,this.lastPoint)}intersects(e){const r=N(),n=new r.Geom2dAPI_InterCurveCurve_1;if(this.boundingBox.isOut(e.boundingBox))return!1;for(const o of this.curves)for(const s of e.curves)if(!o.boundingBox.isOut(s.boundingBox)&&(n.Init_1(o.wrapped,s.wrapped,1e-9),n.NbPoints()||n.NbSegments()))return!0;return n.delete(),!1}}class xl{constructor(e=[0,0]){this.pointer=e,this.firstPoint=e,this._nextCorner=null,this.pendingCurves=[]}_convertToUV([e,r]){return[e,r]}_convertFromUV([e,r]){return[e,r]}movePointerTo(e){if(this.pendingCurves.length)throw new Error("You can only move the pointer if there is no curve defined");return this.pointer=e,this.firstPoint=e,this}saveCurve(e){if(!this._nextCorner){this.pendingCurves.push(e);return}const r=this.pendingCurves.pop();if(!r)throw new Error("bug in the custom corner algorithm");const n=this._nextCorner.mode==="chamfer"?yo:mo;this.pendingCurves.push(...n(r,e,this._nextCorner.radius)),this._nextCorner=null}lineTo(e){const r=Er(this._convertToUV(this.pointer),this._convertToUV(e));return this.pointer=e,this.saveCurve(r),this}line(e,r){return this.lineTo([this.pointer[0]+e,this.pointer[1]+r])}vLine(e){return this.line(0,e)}hLine(e){return this.line(e,0)}vLineTo(e){return this.lineTo([this.pointer[0],e])}hLineTo(e){return this.lineTo([e,this.pointer[1]])}polarLineTo([e,r]){const n=r*et,o=ir(e,n);return this.lineTo(o)}polarLine(e,r){const n=r*et,[o,s]=ir(e,n);return this.line(o,s)}tangentLine(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent line");const n=Ct(this._convertFromUV(r.tangentAt(1)));return this.line(n[0]*e,n[1]*e)}threePointsArcTo(e,r){return this.saveCurve(vo(this._convertToUV(this.pointer),this._convertToUV(r),this._convertToUV(e))),this.pointer=e,this}threePointsArc(e,r,n,o){const[s,u]=this.pointer;return this.threePointsArcTo([s+e,u+r],[s+n,u+o])}sagittaArcTo(e,r){const[n,o]=this.pointer,[s,u]=e,c=[(n+s)/2,(o+u)/2],f=[-(u-o),s-n],p=Math.sqrt(f[0]**2+f[1]**2),g=[c[0]+f[0]/p*r,c[1]+f[1]/p*r];return this.saveCurve(vo(this._convertToUV(this.pointer),this._convertToUV(g),this._convertToUV(e))),this.pointer=e,this}sagittaArc(e,r,n){return this.sagittaArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vSagittaArc(e,r){return this.sagittaArc(0,e,r)}hSagittaArc(e,r){return this.sagittaArc(e,0,r)}bulgeArcTo(e,r){if(!r)return this.lineTo(e);const n=lt(this.pointer,e)/2,o=-r*n;return this.sagittaArcTo(e,o)}bulgeArc(e,r,n){return this.bulgeArcTo([e+this.pointer[0],r+this.pointer[1]],n)}vBulgeArc(e,r){return this.bulgeArc(0,e,r)}hBulgeArc(e,r){return this.bulgeArc(e,0,r)}tangentArcTo(e){const r=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null;if(!r)throw new Error("You need a previous curve to sketch a tangent arc");return this.saveCurve(Qu(this._convertToUV(this.pointer),r.tangentAt(1),this._convertToUV(e))),this.pointer=e,this}tangentArc(e,r){const[n,o]=this.pointer;return this.tangentArcTo([e+n,r+o])}ellipseTo(e,r,n,o=0,s=!1,u=!1){let c=o,f=r,p=n;r<n&&(c=o+90,f=n,p=r);const g=c*et,y=X=>lt(this._convertToUV(X)),m=y(ir(f,g)),S=y(ir(p,g+Math.PI/2)),E=Ct(this._convertToUV(qu([1,0],g))),[,k]=ju(E),{cx:x,cy:A,startAngle:U,endAngle:O,clockwise:V,rx:L,ry:j}=vl(this._convertToUV(this.pointer),this._convertToUV(e),m,S,k,s,u),$=Ju(L,j,V?U:O,V?O:U,[x,A],E);return V||$.reverse(),this.saveCurve($),this.pointer=e,this}ellipse(e,r,n,o,s=0,u=!1,c=!1){const[f,p]=this.pointer;return this.ellipseTo([e+f,r+p],n,o,s,u,c)}halfEllipseTo(e,r,n=!1){const o=$u(e,this.pointer),s=lt(e,this.pointer);return this.ellipseTo(e,s/2,r,o*yr,!0,n)}halfEllipse(e,r,n,o=!1){const[s,u]=this.pointer;return this.halfEllipseTo([s+e,u+r],n,o)}bezierCurveTo(e,r){let n;return r.length===2&&!Array.isArray(r[0])?n=[r]:n=r,this.saveCurve(el(this._convertToUV(this.pointer),n.map(o=>this._convertToUV(o)),this._convertToUV(e))),this.pointer=e,this}quadraticBezierCurveTo(e,r){return this.bezierCurveTo(e,[r])}cubicBezierCurveTo(e,r,n){return this.bezierCurveTo(e,[r,n])}smoothSplineTo(e,r){const{endTangent:n,startTangent:o,startFactor:s,endFactor:u}=dl(r),c=this.pendingCurves.length?this.pendingCurves[this.pendingCurves.length-1]:null,f=lt(this.pointer,e)*.25;let p;o?p=o:c?p=this._convertFromUV(c.tangentAt(1)):p=[1,0],p=Ct(p);const g=[this.pointer[0]+p[0]*s*f,this.pointer[1]+p[1]*s*f];let y;n==="symmetric"?y=[-p[0],-p[1]]:y=n,y=Ct(y);const m=[e[0]-y[0]*u*f,e[1]-y[1]*u*f];return this.cubicBezierCurveTo(e,g,m)}smoothSpline(e,r,n){return this.smoothSplineTo([e+this.pointer[0],r+this.pointer[1]],n)}customCorner(e,r="fillet"){if(!this.pendingCurves.length)throw new Error("You need a curve defined to fillet the angle");return this._nextCorner={mode:r,radius:e},this}_customCornerLastWithFirst(e,r="fillet"){if(!e)return;const n=this.pendingCurves.pop(),o=this.pendingCurves.shift();if(!n||!o)throw new Error("Not enough curves to close and fillet");const s=r==="chamfer"?yo:mo;this.pendingCurves.push(...s(n,o,e))}_closeSketch(){He(this.pointer,this.firstPoint)||this.lineTo(this.firstPoint)}_closeWithMirror(){if(He(this.pointer,this.firstPoint))throw new Error("Cannot close with a mirror when the sketch is already closed");const e=[this.pointer[0]-this.firstPoint[0],this.pointer[1]-this.firstPoint[1]],r=or(this._convertToUV(this.pointer),this._convertToUV(e)),n=this.pendingCurves.map(o=>new _e(o.innerCurve.Mirrored_2(r)));n.reverse(),n.map(o=>o.reverse()),this.pendingCurves.push(...n),this.pointer=this.firstPoint}}const kl=t=>{const e=N(),r=new e.BRepOffsetAPI_MakeFilling(3,15,2,!1,1e-5,1e-4,.01,.1,8,9);t.forEach((s,u)=>{s.edges.forEach(c=>{r.Add_1(c.wrapped,e.GeomAbs_Shape.GeomAbs_C0,u===0)})});const n=new e.Message_ProgressRange_1;r.Build(n),n.delete();const o=Ae(r.Shape());if(r.delete(),!(o instanceof ar))throw new Error("Failed to create a face");return o},Cl=(t,e)=>{const r=N(),n=new r.ShapeFix_Wire_2(t.wrapped,e.wrapped,1e-9);return n.FixEdgeCurves(),n.delete(),t},fi=t=>{let e,r;try{e=hn(t[0]),r=t.slice(1)}catch{e=kl(t),r=t.slice(1).map(o=>Cl(o,e))}return ri(e,r)},hi=(t,e)=>{const r=[],n=[],o=[];t.forEach(f=>{const[p,g,y]=e(f);r.push(p),n.push(g),o.push(y)});const s=fi(n),u=fi(o);return ti([s,...r,u])};class pi{constructor(e){this.sketches=e}delete(){this.sketches.forEach(e=>e.delete())}get outerSketch(){return this.sketches[0]}get innerSketches(){return this.sketches.slice(1)}get wires(){const e=this.sketches.map(r=>r.wire);return xr(e)}face(){const e=this.outerSketch.face();return ri(e,this.innerSketches.map(n=>n.wire))}extrude(e,{extrusionDirection:r,extrusionProfile:n,twistAngle:o,origin:s}={}){const u=new re(r||this.outerSketch.defaultDirection).normalized().multiply(e);return n&&!o?hi(this.sketches,p=>ai(p.wire,s||this.outerSketch.defaultOrigin,u,n,!0)):o?hi(this.sketches,p=>ui(p.wire,o,s||this.outerSketch.defaultOrigin,u,n,!0)):oi(this.face(),u)}revolve(e,{origin:r}={}){return si(this.face(),r||this.outerSketch.defaultOrigin,e)}loftWith(e,r){if(this.sketches.length!==e.sketches.length)throw new Error("You need to loft with another compound with the same number of sketches");const n=this.sketches.map((s,u)=>{const c=e.sketches[u];return s.clone().loftWith(c.clone(),{ruled:r.ruled},!0)}),o=this.face().clone();return n.push(o,e.face()),ti(n)}}class ve{constructor(e){this.blueprints=e,this._boundingBox=null}clone(){return new ve(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Sr;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}get repr(){return["Compound Blueprints","-- Outline",this.blueprints[0].repr,"-- Holes",...this.blueprints.slice(1).map(e=>e.repr)].join(`
`)}stretch(e,r,n){return new ve(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new ve(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new ve(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new ve(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new ve(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){const n=this.blueprints.map(o=>o.sketchOnPlane(e,r));return new pi(n)}sketchOnFace(e,r){const n=this.blueprints.map(o=>o.sketchOnFace(e,r));return new pi(n)}toSVGViewBox(e=1){return pn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.flatMap(e=>e.toSVGPaths())}toSVGGroup(){return`<g>${this.blueprints.map(e=>e.toSVGPath()).join("")}</g>`}toSVG(e=1){return xo(this.toSVGGroup(),this.boundingBox,e)}}class di{constructor(e){this.sketches=e}wires(){const e=this.sketches.map(r=>r instanceof Cr?r.wire:r.wires);return xr(e)}faces(){const e=this.sketches.map(r=>r.face());return xr(e)}extrude(e,r={}){const n=this.sketches.map(o=>o.extrude(e,r));return xr(n)}revolve(e,r){return xr(this.sketches.map(n=>n.revolve(e,r)))}}class ee{constructor(e){this.blueprints=e,this._boundingBox=null}get repr(){return["Blueprints",...this.blueprints.map(e=>e.repr)].join(`
`)}clone(){return new ee(this.blueprints)}get boundingBox(){if(!this._boundingBox){const e=new Sr;this.blueprints.forEach(r=>e.add(r.boundingBox)),this._boundingBox=e}return this._boundingBox}stretch(e,r,n){return new ee(this.blueprints.map(o=>o.stretch(e,r,n)))}rotate(e,r){return new ee(this.blueprints.map(n=>n.rotate(e,r)))}scale(e,r){const n=r||this.boundingBox.center;return new ee(this.blueprints.map(o=>o.scale(e,n)))}translate(e,r=0){return new ee(this.blueprints.map(n=>n.translate(e,r)))}mirror(e,r,n){return new ee(this.blueprints.map(o=>o.mirror(e,r,n)))}sketchOnPlane(e,r){return new di(this.blueprints.map(n=>n.sketchOnPlane(e,r)))}sketchOnFace(e,r){return new di(this.blueprints.map(n=>n.sketchOnFace(e,r)))}toSVGViewBox(e=1){return pn(this.boundingBox,e)}toSVGPaths(){return this.blueprints.map(e=>e.toSVGPaths())}toSVG(e=1){const r=this.blueprints.map(n=>n instanceof ae?n.toSVGPath():n.toSVGGroup());return xo(r.join(`
    `),this.boundingBox,e)}}const Pl=t=>{const e=t.map((o,s)=>t.slice(s+1).map((u,c)=>[c+s+1,u]).filter(([,u])=>!o.boundingBox.isOut(u.boundingBox)).map(([u])=>u)),r=[],n=Array(e.length);return e.forEach((o,s)=>{let u=n[s];u||(u=[],r.push(u)),u.push(t[s]),o.length&&o.forEach(c=>{n[c]=u})}),r},vi=t=>t.map((e,r)=>{const n=e.curves[0],o=n.value((n.lastParameter+n.firstParameter)/2),s=t.filter((u,c)=>r===c?!1:u.isInside(o));return{blueprint:e,isIn:s}}),Al=(t,e)=>t.flatMap(({blueprint:r})=>ko(e.filter(({blueprint:n,isIn:o})=>n===r||o.indexOf(r)!==-1))),Ol=(t,e)=>{const r=e.filter(({isIn:o})=>o.length<=1),n=ko(vi(t.map(({blueprint:o})=>o)));return[r,...n]},ko=t=>{if(!t.length)return[];const e=t.filter(({isIn:n})=>!n.length),r=t.filter(({isIn:n})=>n.length>1);return e.length===1&&r.length===0?[t]:e.length>1?Al(e,t):Ol(r,t)},Ar=t=>{const e=Pl(t).map(vi);return new ee(e.flatMap(ko).map(r=>r.length===1?r[0].blueprint:(r.sort((n,o)=>n.isIn.length-o.isIn.length),new ve(r.map(({blueprint:n})=>n)))))},dn=1e-9,ze=(t,e)=>He(t,e,dn),Or=t=>{const e=(t.lastParameter+t.firstParameter)/2;return t.value(e)},gi=(t,e)=>{const r=t.findIndex(s=>ze(e,s.firstPoint)),n=t.slice(0,r);return t.slice(r).concat(n)},mi=(t,e)=>{const r=u=>ze(e.firstPoint,u.firstPoint)&&ze(e.lastPoint,u.lastPoint);let n=t.findIndex(r);if(n===-1&&(t=Po(t),n=t.findIndex(r),n===-1))throw console.error(t.map(u=>u.repr),e.repr),new Error("Failed to rotate to segment start");const o=t.slice(0,n);return t.slice(n).concat(o)};function*yi(t,e,r){const n=u=>!!e.find(c=>ze(c,u.lastPoint)),o=u=>!!r.find(c=>ze(c.firstPoint,u.firstPoint)&&ze(c.lastPoint,u.lastPoint)||ze(c.firstPoint,u.lastPoint)&&ze(c.lastPoint,u.firstPoint));let s=[];for(const u of t)n(u)?(s.push(u),yield s,s=[]):o(u)?(s.length&&(yield s,s=[]),yield[u]):s.push(u);s.length&&(yield s)}const Rl=t=>t[0].firstPoint,Co=t=>t[t.length-1].lastPoint,Po=t=>(t.reverse(),t.map(e=>{const r=e.clone();return r.reverse(),r})),Dl=t=>(t.reverse(),t.map(Po));function Ul(t,e,r){return t.filter(n=>{const o=e.filter(c=>ze(c.firstPoint,n)||ze(c.lastPoint,n));if(o.length%2)throw console.error(o,n),new Error("Bug in the intersection algo on non crossing point");const s=o.map(c=>r.isInside(Or(c)));return!(s.every(c=>c)||!s.some(c=>c))})}function Bl(t,e){let r=[];const n=[],o=new Array(t.curves.length).fill(0).map(()=>[]),s=new Array(e.curves.length).fill(0).map(()=>[]);if(t.curves.forEach((m,S)=>{e.curves.forEach((E,k)=>{const{intersections:x,commonSegments:A,commonSegmentsPoints:U}=_r(m,E,dn/100);r.push(...x),o[S].push(...x),s[k].push(...x),n.push(...A),r.push(...U),o[S].push(...U),s[k].push(...U)})}),r=Ds(r,dn),!r.length||r.length===1)return null;const u=([m,S])=>S.length?m.splitAt(S,dn/100):[m];let c=nr([t.curves,o]).flatMap(u),f=nr([e.curves,s]).flatMap(u);const p=n.map(m=>[m.firstPoint,m.lastPoint]);if(r=Ul(r,c,e),!r.length&&!n.length)return null;if(n.length){const m=n[0];c=mi(c,m),f=mi(f,m)}else{const m=r[0];c=gi(c,m),f=gi(f,m)}const g=Array.from(yi(c,r,n));let y=Array.from(yi(f,r,n));return(!ze(Co(y[0]),Co(g[0]))||n.length>0&&y[0].length!==1)&&(y=Dl(y)),nr([g,y]).map(([m,S])=>{const E=Rl(m),k=Co(m);return p.find(([x,A])=>ze(x,E)&&ze(A,k)||ze(x,k)&&ze(x,E))?[m,"same"]:[m,S]})}const Ml=t=>{const e=t.map(u=>u.firstPoint);let r=t.map(u=>u.lastPoint);r=r.slice(-1).concat(r.slice(0,-1));const n=nr([e,r]).map(([u,c],f)=>ze(u,c)?null:f).filter(u=>u!==null);if(!n.length)return[t];const o=nr([n.slice(0,-1),n.slice(1)]).map(([u,c])=>t.slice(u,c));let s=t.slice(n[n.length-1]);return n[0]!==0&&(s=s.concat(t.slice(0,n[0]))),o.push(s),o};function Ao(t,e,{firstInside:r,secondInside:n}){const o=Bl(t,e);if(!o){const p=Or(t.curves[0]),g=e.isInside(p),y=Or(e.curves[0]),m=t.isInside(y);return{identical:!1,firstCurveInSecond:g,secondCurveInFirst:m}}if(o.every(([,p])=>p==="same"))return{identical:!0};let s=null,u=null;const c=o.flatMap(([p,g])=>{let y=[],m=0;if(g==="same")return u===1?(u=1,[...p]):u===2||u===0?(u=null,[]):u===null?(s?s=[...s,...p]:s=p,[]):(console.error("weird situation"),[]);const S=Or(p[0]),E=e.isInside(S);(r==="keep"&&E||r==="remove"&&!E)&&(m+=1,y.push(...p));const k=Or(g[0]),x=t.isInside(k);if(n==="keep"&&x||n==="remove"&&!x){let A=g;m===1&&(A=Po(g)),m+=1,y.push(...A)}return u===null&&m===1&&s&&(y=[...s,...y]),m===1&&(u=m,s=null),y}),f=Ml(c).filter(p=>p.length).map(p=>new ae(p));return f.length===0?null:f.length===1?f[0]:Ar(f)}const vn=(t,e)=>{const r=Ao(t,e,{firstInside:"remove",secondInside:"remove"});return r===null||r instanceof ae||r instanceof ee?r:r.identical?t.clone():r.firstCurveInSecond?e.clone():r.secondCurveInFirst?t.clone():new ee([t,e])},Rr=(t,e)=>{const r=Ao(t,e,{firstInside:"remove",secondInside:"keep"});return r===null||r instanceof ae||r instanceof ee?r:r.identical||r.firstCurveInSecond?null:r.secondCurveInFirst?new ee([new ve([t,e])]):t.clone()},Oo=(t,e)=>{const r=Ao(t,e,{firstInside:"keep",secondInside:"keep"});return r===null||r instanceof ae||r instanceof ee?r:r.identical||r.firstCurveInSecond?t.clone():r.secondCurveInFirst?e.clone():null},Ro=(t,e)=>{if(t instanceof ae&&e instanceof ae){let r=[];return t.curves.forEach(n=>{e.curves.forEach(o=>{const{intersections:s,commonSegmentsPoints:u}=_r(n,o);r.push(...s),r.push(...u)})}),r=Ds(r),r.length>1}if(t instanceof ve||t instanceof ee)return t.blueprints.some(r=>Ro(r,e));if(e instanceof ve||e instanceof ee)return e.blueprints.some(r=>Ro(t,r));throw new Error("Bug in the generic intersects algorithm")},Fl=(t,e)=>{if(t instanceof ve){if(e instanceof ae)return gn(e,t);if(e instanceof ve)return mn(t,e)}if(e instanceof ve){if(t instanceof ae)return gn(t,e);if(t instanceof ve)return mn(t,e)}if(t instanceof ae&&e instanceof ae)return vn(t,e);throw new Error("Bug in the generic fuse algorithm")},wi=t=>{const e=new Map,r=[];return t.forEach((n,o)=>{let s;e.has(o)?s=e.get(o):(s={current:n,fusedWith:new Set([o])},r.push(s)),t.slice(o+1).forEach((u,c)=>{const f=s.current,p=o+c+1;if(s.fusedWith.has(p))return;let g=u,y=!1;if(e.has(p)&&(g=e.get(p).current,y=!0),f.boundingBox.isOut(g.boundingBox)||!Ro(f,g))return;let m;if(f instanceof ee||g instanceof ee?m=gt(f,g):m=Fl(f,g),!(m instanceof ae||m instanceof ve)){if(m instanceof ee&&m.blueprints.length===2)return;if(m instanceof ee&&m.blueprints.length===1)m=m.blueprints[0];else if(!(m instanceof ee))throw console.error(m),new Error("Bug in blueprint fusing algorigthm")}s.fusedWith.add(p),s.current=m,y||e.set(p,s)})}),Ar(r.map(({current:n})=>n).filter(n=>n).flatMap(n=>vt(n)))},vt=t=>t instanceof ae?[t]:t instanceof ve?t.blueprints:t instanceof ee?t.blueprints.flatMap(e=>vt(e)):[],gn=(t,e)=>{const r=vn(t,e.blueprints[0]),n=e.blueprints.slice(1).map(o=>Rr(o,t));return Ar([...vt(r),...n.flatMap(o=>vt(o))])};function Ll(t,e){const r=[];for(const n of t)for(const o of e)r.push([n,o]);return r}const mn=(t,e)=>{const r=vn(t.blueprints[0],e.blueprints[0]),n=e.blueprints.slice(1).map(u=>Rr(u,t.blueprints[0])),o=t.blueprints.slice(1).map(u=>Rr(u,e.blueprints[0])),s=Ll(t.blueprints.slice(1),e.blueprints.slice(1)).flatMap(([u,c])=>vt(Oo(u,c)));return Ar([...vt(r),...n.flatMap(u=>vt(u)),...o.flatMap(u=>vt(u)),...s])},gt=(t,e)=>{if(t===null)return e&&e.clone();if(e===null)return t&&t.clone();if(!(t instanceof ee)&&e instanceof ee)return wi([t,...e.blueprints]);if(!(e instanceof ee)&&t instanceof ee)return wi([e,...t.blueprints]);if(t instanceof ee&&e instanceof ee){let r=gt(t.blueprints[0],e);return t.blueprints.slice(1).forEach(n=>{r=gt(n,r)}),r}if(t instanceof ve){if(e instanceof ee)return gt(e,t);if(e instanceof ae)return gn(e,t);if(e instanceof ve)return mn(t,e)}if(e instanceof ve){if(t instanceof ee)return gt(t,e);if(t instanceof ae)return gn(t,e);if(t instanceof ve)return mn(t,e)}return t instanceof ae&&e instanceof ae?vn(t,e):null},yn=t=>{const e=t.flatMap(r=>r===null?[]:r instanceof ee?r.blueprints:r);return e.length===1?e[0]:new ee(e)},Ot=(t,e)=>{if(t===null)return null;if(e===null)return t.clone();if(t instanceof ee)return yn(t.blueprints.map(n=>Ot(n,e)));if(t instanceof ve){const n=t.blueprints[0];if(e instanceof ae&&!e.intersects(n)){if(!n.isInside(e.firstPoint))return null;const o=gt(e,new ee(t.blueprints.slice(1)));return Ar([n,...vt(o)])}else{let o=Ot(t.blueprints[0],e);return t.blueprints.slice(1).forEach(s=>{o=Ot(o,s)}),o}}if(e instanceof ee)return yn(e.blueprints.map(n=>Ot(t,n)));if(e instanceof ve){let n=Rr(t,e.blueprints[0]);return e.blueprints.slice(1).forEach(o=>{n=gt(n,Oo(o,t))}),n}return Rr(t,e)};function Dr(t,e){if(t===null||e===null)return null;if(t instanceof ae&&e instanceof ae)return Oo(t,e);if(t instanceof ee)return yn(t.blueprints.map(r=>Dr(r,e)));if(t instanceof ve){const r=t.blueprints[0],n=t.blueprints[1];return Ot(Dr(r,e),n)}if(e instanceof ee)return yn(e.blueprints.map(r=>Dr(t,r)));if(e instanceof ve){const r=e.blueprints[0],n=e.blueprints[1];return Ot(Dr(r,t),n)}throw new Error("intersct 2D algorithm error")}/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var t=function(){try{var r={},n=Object.defineProperty,o=n(r,r,r)&&n}catch{}return o}(),e=function(r){if(this==null)throw TypeError();var n=String(this),o=n.length,s=r?Number(r):0;if(s!=s&&(s=0),!(s<0||s>=o)){var u=n.charCodeAt(s),c;return u>=55296&&u<=56319&&o>s+1&&(c=n.charCodeAt(s+1),c>=56320&&c<=57343)?(u-55296)*1024+c-56320+65536:u}};t?t(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}();function bi(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}var Il=new bi,Gl=new bi,Si=new Uint8Array(30),_i=new Uint16Array(30),Nl=new Uint8Array(30),Hl=new Uint16Array(30);function Ei(t,e,r,n){var o,s;for(o=0;o<r;++o)t[o]=0;for(o=0;o<30-r;++o)t[o+r]=o/r|0;for(s=n,o=0;o<30;++o)e[o]=s,s+=1<<t[o]}function zl(t,e){var r;for(r=0;r<7;++r)t.table[r]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,r=0;r<24;++r)t.trans[r]=256+r;for(r=0;r<144;++r)t.trans[24+r]=r;for(r=0;r<8;++r)t.trans[24+144+r]=280+r;for(r=0;r<112;++r)t.trans[24+144+8+r]=144+r;for(r=0;r<5;++r)e.table[r]=0;for(e.table[5]=32,r=0;r<32;++r)e.trans[r]=r}zl(Il,Gl),Ei(Si,_i,4,3),Ei(Nl,Hl,2,1),Si[28]=0,_i[28]=258;function ur(t,e,r,n,o){return Math.pow(1-o,3)*t+3*Math.pow(1-o,2)*o*e+3*(1-o)*Math.pow(o,2)*r+Math.pow(o,3)*n}function Rt(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}Rt.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},Rt.prototype.addPoint=function(t,e){typeof t=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},Rt.prototype.addX=function(t){this.addPoint(t,null)},Rt.prototype.addY=function(t){this.addPoint(null,t)},Rt.prototype.addBezier=function(t,e,r,n,o,s,u,c){var f=[t,e],p=[r,n],g=[o,s],y=[u,c];this.addPoint(t,e),this.addPoint(u,c);for(var m=0;m<=1;m++){var S=6*f[m]-12*p[m]+6*g[m],E=-3*f[m]+9*p[m]-9*g[m]+3*y[m],k=3*p[m]-3*f[m];if(E===0){if(S===0)continue;var x=-k/S;0<x&&x<1&&(m===0&&this.addX(ur(f[m],p[m],g[m],y[m],x)),m===1&&this.addY(ur(f[m],p[m],g[m],y[m],x)));continue}var A=Math.pow(S,2)-4*k*E;if(!(A<0)){var U=(-S+Math.sqrt(A))/(2*E);0<U&&U<1&&(m===0&&this.addX(ur(f[m],p[m],g[m],y[m],U)),m===1&&this.addY(ur(f[m],p[m],g[m],y[m],U)));var O=(-S-Math.sqrt(A))/(2*E);0<O&&O<1&&(m===0&&this.addX(ur(f[m],p[m],g[m],y[m],O)),m===1&&this.addY(ur(f[m],p[m],g[m],y[m],O)))}}},Rt.prototype.addQuad=function(t,e,r,n,o,s){var u=t+.6666666666666666*(r-t),c=e+2/3*(n-e),f=u+1/3*(o-t),p=c+1/3*(s-e);this.addBezier(t,e,u,c,f,p,o,s)};function Be(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Be.prototype.moveTo=function(t,e){this.commands.push({type:"M",x:t,y:e})},Be.prototype.lineTo=function(t,e){this.commands.push({type:"L",x:t,y:e})},Be.prototype.curveTo=Be.prototype.bezierCurveTo=function(t,e,r,n,o,s){this.commands.push({type:"C",x1:t,y1:e,x2:r,y2:n,x:o,y:s})},Be.prototype.quadTo=Be.prototype.quadraticCurveTo=function(t,e,r,n){this.commands.push({type:"Q",x1:t,y1:e,x:r,y:n})},Be.prototype.close=Be.prototype.closePath=function(){this.commands.push({type:"Z"})},Be.prototype.extend=function(t){if(t.commands)t=t.commands;else if(t instanceof Rt){var e=t;this.moveTo(e.x1,e.y1),this.lineTo(e.x2,e.y1),this.lineTo(e.x2,e.y2),this.lineTo(e.x1,e.y2),this.close();return}Array.prototype.push.apply(this.commands,t)},Be.prototype.getBoundingBox=function(){for(var t=new Rt,e=0,r=0,n=0,o=0,s=0;s<this.commands.length;s++){var u=this.commands[s];switch(u.type){case"M":t.addPoint(u.x,u.y),e=n=u.x,r=o=u.y;break;case"L":t.addPoint(u.x,u.y),n=u.x,o=u.y;break;case"Q":t.addQuad(n,o,u.x1,u.y1,u.x,u.y),n=u.x,o=u.y;break;case"C":t.addBezier(n,o,u.x1,u.y1,u.x2,u.y2,u.x,u.y),n=u.x,o=u.y;break;case"Z":n=e,o=r;break;default:throw new Error("Unexpected path command "+u.type)}}return t.isEmpty()&&t.addPoint(0,0),t},Be.prototype.draw=function(t){t.beginPath();for(var e=0;e<this.commands.length;e+=1){var r=this.commands[e];r.type==="M"?t.moveTo(r.x,r.y):r.type==="L"?t.lineTo(r.x,r.y):r.type==="C"?t.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):r.type==="Q"?t.quadraticCurveTo(r.x1,r.y1,r.x,r.y):r.type==="Z"&&t.closePath()}this.fill&&(t.fillStyle=this.fill,t.fill()),this.stroke&&(t.strokeStyle=this.stroke,t.lineWidth=this.strokeWidth,t.stroke())},Be.prototype.toPathData=function(t){t=t!==void 0?t:2;function e(u){return Math.round(u)===u?""+Math.round(u):u.toFixed(t)}function r(){for(var u=arguments,c="",f=0;f<arguments.length;f+=1){var p=u[f];p>=0&&f>0&&(c+=" "),c+=e(p)}return c}for(var n="",o=0;o<this.commands.length;o+=1){var s=this.commands[o];s.type==="M"?n+="M"+r(s.x,s.y):s.type==="L"?n+="L"+r(s.x,s.y):s.type==="C"?n+="C"+r(s.x1,s.y1,s.x2,s.y2,s.x,s.y):s.type==="Q"?n+="Q"+r(s.x1,s.y1,s.x,s.y):s.type==="Z"&&(n+="Z")}return n},Be.prototype.toSVG=function(t){var e='<path d="';return e+=this.toPathData(t),e+='"',this.fill&&this.fill!=="black"&&(this.fill===null?e+=' fill="none"':e+=' fill="'+this.fill+'"'),this.stroke&&(e+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),e+="/>",e},Be.prototype.toDOMElement=function(t){var e=this.toPathData(t),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r};function Ti(t){throw new Error(t)}function xi(t,e){t||Ti(e)}var Z={fail:Ti,argument:xi,assert:xi},ki=32768,Ci=2147483648,lr={},G={},q={};function rt(t){return function(){return t}}G.BYTE=function(t){return Z.argument(t>=0&&t<=255,"Byte value should be between 0 and 255."),[t]},q.BYTE=rt(1),G.CHAR=function(t){return[t.charCodeAt(0)]},q.CHAR=rt(1),G.CHARARRAY=function(t){typeof t>"u"&&(t="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var e=[],r=0;r<t.length;r+=1)e[r]=t.charCodeAt(r);return e},q.CHARARRAY=function(t){return typeof t>"u"?0:t.length},G.USHORT=function(t){return[t>>8&255,t&255]},q.USHORT=rt(2),G.SHORT=function(t){return t>=ki&&(t=-(2*ki-t)),[t>>8&255,t&255]},q.SHORT=rt(2),G.UINT24=function(t){return[t>>16&255,t>>8&255,t&255]},q.UINT24=rt(3),G.ULONG=function(t){return[t>>24&255,t>>16&255,t>>8&255,t&255]},q.ULONG=rt(4),G.LONG=function(t){return t>=Ci&&(t=-(2*Ci-t)),[t>>24&255,t>>16&255,t>>8&255,t&255]},q.LONG=rt(4),G.FIXED=G.ULONG,q.FIXED=q.ULONG,G.FWORD=G.SHORT,q.FWORD=q.SHORT,G.UFWORD=G.USHORT,q.UFWORD=q.USHORT,G.LONGDATETIME=function(t){return[0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]},q.LONGDATETIME=rt(8),G.TAG=function(t){return Z.argument(t.length===4,"Tag should be exactly 4 ASCII characters."),[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},q.TAG=rt(4),G.Card8=G.BYTE,q.Card8=q.BYTE,G.Card16=G.USHORT,q.Card16=q.USHORT,G.OffSize=G.BYTE,q.OffSize=q.BYTE,G.SID=G.USHORT,q.SID=q.USHORT,G.NUMBER=function(t){return t>=-107&&t<=107?[t+139]:t>=108&&t<=1131?(t=t-108,[(t>>8)+247,t&255]):t>=-1131&&t<=-108?(t=-t-108,[(t>>8)+251,t&255]):t>=-32768&&t<=32767?G.NUMBER16(t):G.NUMBER32(t)},q.NUMBER=function(t){return G.NUMBER(t).length},G.NUMBER16=function(t){return[28,t>>8&255,t&255]},q.NUMBER16=rt(3),G.NUMBER32=function(t){return[29,t>>24&255,t>>16&255,t>>8&255,t&255]},q.NUMBER32=rt(5),G.REAL=function(t){var e=t.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(e);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));e=(Math.round(t*n)/n).toString()}for(var o="",s=0,u=e.length;s<u;s+=1){var c=e[s];c==="e"?o+=e[++s]==="-"?"c":"b":c==="."?o+="a":c==="-"?o+="e":o+=c}o+=o.length&1?"f":"ff";for(var f=[30],p=0,g=o.length;p<g;p+=2)f.push(parseInt(o.substr(p,2),16));return f},q.REAL=function(t){return G.REAL(t).length},G.NAME=G.CHARARRAY,q.NAME=q.CHARARRAY,G.STRING=G.CHARARRAY,q.STRING=q.CHARARRAY,lr.UTF8=function(t,e,r){for(var n=[],o=r,s=0;s<o;s++,e+=1)n[s]=t.getUint8(e);return String.fromCharCode.apply(null,n)},lr.UTF16=function(t,e,r){for(var n=[],o=r/2,s=0;s<o;s++,e+=2)n[s]=t.getUint16(e);return String.fromCharCode.apply(null,n)},G.UTF16=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t.charCodeAt(r);e[e.length]=n>>8&255,e[e.length]=n&255}return e},q.UTF16=function(t){return t.length*2};var Do={"x-mac-croatian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®Š™´¨≠ŽØ∞±≤≥∆µ∂∑∏š∫ªºΩžø¿¡¬√ƒ≈Ć«Č… ÀÃÕŒœĐ—“”‘’÷◊©⁄€‹›Æ»–·‚„‰ÂćÁčÈÍÎÏÌÓÔđÒÚÛÙıˆ˜¯πË˚¸Êæˇ","x-mac-cyrillic":"АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ†°Ґ£§•¶І®©™Ђђ≠Ѓѓ∞±≤≥іµґЈЄєЇїЉљЊњјЅ¬√ƒ≈∆«»… ЋћЌќѕ–—“”‘’÷„ЎўЏџ№Ёёяабвгдежзийклмнопрстуфхцчшщъыьэю","x-mac-gaelic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØḂ±≤≥ḃĊċḊḋḞḟĠġṀæøṁṖṗɼƒſṠ«»… ÀÃÕŒœ–—“”‘’ṡẛÿŸṪ€‹›Ŷŷṫ·Ỳỳ⁊ÂÊÁËÈÍÎÏÌÓÔ♣ÒÚÛÙıÝýŴŵẄẅẀẁẂẃ","x-mac-greek":"Ä¹²É³ÖÜ΅àâä΄¨çéèêë£™îï•½‰ôö¦€ùûü†ΓΔΘΛΞΠß®©ΣΪ§≠°·Α±≤≥¥ΒΕΖΗΙΚΜΦΫΨΩάΝ¬ΟΡ≈Τ«»… ΥΧΆΈœ–―“”‘’÷ΉΊΌΎέήίόΏύαβψδεφγηιξκλμνοπώρστθωςχυζϊϋΐΰ­","x-mac-icelandic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûüÝ°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€ÐðÞþý·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-inuit":"ᐃᐄᐅᐆᐊᐋᐱᐲᐳᐴᐸᐹᑉᑎᑏᑐᑑᑕᑖᑦᑭᑮᑯᑰᑲᑳᒃᒋᒌᒍᒎᒐᒑ°ᒡᒥᒦ•¶ᒧ®©™ᒨᒪᒫᒻᓂᓃᓄᓅᓇᓈᓐᓯᓰᓱᓲᓴᓵᔅᓕᓖᓗᓘᓚᓛᓪᔨᔩᔪᔫᔭ… ᔮᔾᕕᕖᕗ–—“”‘’ᕘᕙᕚᕝᕆᕇᕈᕉᕋᕌᕐᕿᖀᖁᖂᖃᖄᖅᖏᖐᖑᖒᖓᖔᖕᙱᙲᙳᙴᙵᙶᖖᖠᖡᖢᖣᖤᖥᖦᕼŁł","x-mac-ce":"ÄĀāÉĄÖÜáąČäčĆćéŹźĎíďĒēĖóėôöõúĚěü†°Ę£§•¶ß®©™ę¨≠ģĮįĪ≤≥īĶ∂∑łĻļĽľĹĺŅņŃ¬√ńŇ∆«»… ňŐÕőŌ–—“”‘’÷◊ōŔŕŘ‹›řŖŗŠ‚„šŚśÁŤťÍŽžŪÓÔūŮÚůŰűŲųÝýķŻŁżĢˇ",macintosh:"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-romanian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ĂȘ∞±≤≥¥µ∂∑∏π∫ªºΩăș¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›Țț‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-turkish":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸĞğİıŞş‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙˆ˜¯˘˙˚¸˝˛ˇ"};lr.MACSTRING=function(t,e,r,n){var o=Do[n];if(o!==void 0){for(var s="",u=0;u<r;u++){var c=t.getUint8(e+u);c<=127?s+=String.fromCharCode(c):s+=o[c&127]}return s}};var wn=typeof WeakMap=="function"&&new WeakMap,bn,Wl=function(t){if(!bn){bn={};for(var e in Do)bn[e]=new String(e)}var r=bn[t];if(r!==void 0){if(wn){var n=wn.get(r);if(n!==void 0)return n}var o=Do[t];if(o!==void 0){for(var s={},u=0;u<o.length;u++)s[o.charCodeAt(u)]=u+128;return wn&&wn.set(r,s),s}}};G.MACSTRING=function(t,e){var r=Wl(e);if(r!==void 0){for(var n=[],o=0;o<t.length;o++){var s=t.charCodeAt(o);if(s>=128&&(s=r[s],s===void 0))return;n[o]=s}return n}},q.MACSTRING=function(t,e){var r=G.MACSTRING(t,e);return r!==void 0?r.length:0};function Uo(t){return t>=-128&&t<=127}function Vl(t,e,r){for(var n=0,o=t.length;e<o&&n<64&&t[e]===0;)++e,++n;return r.push(128|n-1),e}function Yl(t,e,r){for(var n=0,o=t.length,s=e;s<o&&n<64;){var u=t[s];if(!Uo(u)||u===0&&s+1<o&&t[s+1]===0)break;++s,++n}r.push(n-1);for(var c=e;c<s;++c)r.push(t[c]+256&255);return s}function Xl(t,e,r){for(var n=0,o=t.length,s=e;s<o&&n<64;){var u=t[s];if(u===0||Uo(u)&&s+1<o&&Uo(t[s+1]))break;++s,++n}r.push(64|n-1);for(var c=e;c<s;++c){var f=t[c];r.push(f+65536>>8&255,f+256&255)}return s}G.VARDELTAS=function(t){for(var e=0,r=[];e<t.length;){var n=t[e];n===0?e=Vl(t,e,r):n>=-128&&n<=127?e=Yl(t,e,r):e=Xl(t,e,r)}return r},G.INDEX=function(t){for(var e=1,r=[e],n=[],o=0;o<t.length;o+=1){var s=G.OBJECT(t[o]);Array.prototype.push.apply(n,s),e+=s.length,r.push(e)}if(n.length===0)return[0,0];for(var u=[],c=1+Math.floor(Math.log(e)/Math.log(2))/8|0,f=[void 0,G.BYTE,G.USHORT,G.UINT24,G.ULONG][c],p=0;p<r.length;p+=1){var g=f(r[p]);Array.prototype.push.apply(u,g)}return Array.prototype.concat(G.Card16(t.length),G.OffSize(c),u,n)},q.INDEX=function(t){return G.INDEX(t).length},G.DICT=function(t){for(var e=[],r=Object.keys(t),n=r.length,o=0;o<n;o+=1){var s=parseInt(r[o],0),u=t[s];e=e.concat(G.OPERAND(u.value,u.type)),e=e.concat(G.OPERATOR(s))}return e},q.DICT=function(t){return G.DICT(t).length},G.OPERATOR=function(t){return t<1200?[t]:[12,t-1200]},G.OPERAND=function(t,e){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n+=1)Z.argument(t.length===e.length,"Not enough arguments given for type"+e),r=r.concat(G.OPERAND(t[n],e[n]));else if(e==="SID")r=r.concat(G.NUMBER(t));else if(e==="offset")r=r.concat(G.NUMBER32(t));else if(e==="number")r=r.concat(G.NUMBER(t));else if(e==="real")r=r.concat(G.REAL(t));else throw new Error("Unknown operand type "+e);return r},G.OP=G.BYTE,q.OP=q.BYTE;var Sn=typeof WeakMap=="function"&&new WeakMap;G.CHARSTRING=function(t){if(Sn){var e=Sn.get(t);if(e!==void 0)return e}for(var r=[],n=t.length,o=0;o<n;o+=1){var s=t[o];r=r.concat(G[s.type](s.value))}return Sn&&Sn.set(t,r),r},q.CHARSTRING=function(t){return G.CHARSTRING(t).length},G.OBJECT=function(t){var e=G[t.type];return Z.argument(e!==void 0,"No encoding function for type "+t.type),e(t.value)},q.OBJECT=function(t){var e=q[t.type];return Z.argument(e!==void 0,"No sizeOf function for type "+t.type),e(t.value)},G.TABLE=function(t){for(var e=[],r=t.fields.length,n=[],o=[],s=0;s<r;s+=1){var u=t.fields[s],c=G[u.type];Z.argument(c!==void 0,"No encoding function for field type "+u.type+" ("+u.name+")");var f=t[u.name];f===void 0&&(f=u.value);var p=c(f);u.type==="TABLE"?(o.push(e.length),e=e.concat([0,0]),n.push(p)):e=e.concat(p)}for(var g=0;g<n.length;g+=1){var y=o[g],m=e.length;Z.argument(m<65536,"Table "+t.tableName+" too big."),e[y]=m>>8,e[y+1]=m&255,e=e.concat(n[g])}return e},q.TABLE=function(t){for(var e=0,r=t.fields.length,n=0;n<r;n+=1){var o=t.fields[n],s=q[o.type];Z.argument(s!==void 0,"No sizeOf function for field type "+o.type+" ("+o.name+")");var u=t[o.name];u===void 0&&(u=o.value),e+=s(u),o.type==="TABLE"&&(e+=2)}return e},G.RECORD=G.TABLE,q.RECORD=q.TABLE,G.LITERAL=function(t){return t},q.LITERAL=function(t){return t.length};function Fe(t,e,r){if(e.length&&(e[0].name!=="coverageFormat"||e[0].value===1))for(var n=0;n<e.length;n+=1){var o=e[n];this[o.name]=o.value}if(this.tableName=t,this.fields=e,r)for(var s=Object.keys(r),u=0;u<s.length;u+=1){var c=s[u],f=r[c];this[c]!==void 0&&(this[c]=f)}}Fe.prototype.encode=function(){return G.TABLE(this)},Fe.prototype.sizeOf=function(){return q.TABLE(this)};function Ur(t,e,r){r===void 0&&(r=e.length);var n=new Array(e.length+1);n[0]={name:t+"Count",type:"USHORT",value:r};for(var o=0;o<e.length;o++)n[o+1]={name:t+o,type:"USHORT",value:e[o]};return n}function Bo(t,e,r){var n=e.length,o=new Array(n+1);o[0]={name:t+"Count",type:"USHORT",value:n};for(var s=0;s<n;s++)o[s+1]={name:t+s,type:"TABLE",value:r(e[s],s)};return o}function Br(t,e,r){var n=e.length,o=[];o[0]={name:t+"Count",type:"USHORT",value:n};for(var s=0;s<n;s++)o=o.concat(r(e[s],s));return o}function _n(t){t.format===1?Fe.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Ur("glyph",t.glyphs))):t.format===2?Fe.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(Br("rangeRecord",t.ranges,function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]}))):Z.assert(!1,"Coverage format must be 1 or 2.")}_n.prototype=Object.create(Fe.prototype),_n.prototype.constructor=_n;function En(t){Fe.call(this,"scriptListTable",Br("scriptRecord",t,function(e,r){var n=e.script,o=n.defaultLangSys;return Z.assert(!!o,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+r,type:"TAG",value:e.tag},{name:"script"+r,type:"TABLE",value:new Fe("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Fe("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(Ur("featureIndex",o.featureIndexes)))}].concat(Br("langSys",n.langSysRecords,function(s,u){var c=s.langSys;return[{name:"langSysTag"+u,type:"TAG",value:s.tag},{name:"langSys"+u,type:"TABLE",value:new Fe("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:c.reqFeatureIndex}].concat(Ur("featureIndex",c.featureIndexes)))}]})))}]}))}En.prototype=Object.create(Fe.prototype),En.prototype.constructor=En;function Tn(t){Fe.call(this,"featureListTable",Br("featureRecord",t,function(e,r){var n=e.feature;return[{name:"featureTag"+r,type:"TAG",value:e.tag},{name:"feature"+r,type:"TABLE",value:new Fe("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(Ur("lookupListIndex",n.lookupListIndexes)))}]}))}Tn.prototype=Object.create(Fe.prototype),Tn.prototype.constructor=Tn;function xn(t,e){Fe.call(this,"lookupListTable",Bo("lookup",t,function(r){var n=e[r.lookupType];return Z.assert(!!n,"Unable to write GSUB lookup type "+r.lookupType+" tables."),new Fe("lookupTable",[{name:"lookupType",type:"USHORT",value:r.lookupType},{name:"lookupFlag",type:"USHORT",value:r.lookupFlag}].concat(Bo("subtable",r.subtables,n)))}))}xn.prototype=Object.create(Fe.prototype),xn.prototype.constructor=xn;var z={Table:Fe,Record:Fe,Coverage:_n,ScriptList:En,FeatureList:Tn,LookupList:xn,ushortList:Ur,tableList:Bo,recordList:Br};function Pi(t,e){return t.getUint8(e)}function kn(t,e){return t.getUint16(e,!1)}function $l(t,e){return t.getInt16(e,!1)}function Mo(t,e){return t.getUint32(e,!1)}function Ai(t,e){var r=t.getInt16(e,!1),n=t.getUint16(e+2,!1);return r+n/65535}function ql(t,e){for(var r="",n=e;n<e+4;n+=1)r+=String.fromCharCode(t.getInt8(n));return r}function jl(t,e,r){for(var n=0,o=0;o<r;o+=1)n<<=8,n+=t.getUint8(e+o);return n}function Zl(t,e,r){for(var n=[],o=e;o<r;o+=1)n.push(t.getUint8(o));return n}function Kl(t){for(var e="",r=0;r<t.length;r+=1)e+=String.fromCharCode(t[r]);return e}var Ql={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function C(t,e){this.data=t,this.offset=e,this.relativeOffset=0}C.prototype.parseByte=function(){var t=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},C.prototype.parseChar=function(){var t=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,t},C.prototype.parseCard8=C.prototype.parseByte,C.prototype.parseUShort=function(){var t=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},C.prototype.parseCard16=C.prototype.parseUShort,C.prototype.parseSID=C.prototype.parseUShort,C.prototype.parseOffset16=C.prototype.parseUShort,C.prototype.parseShort=function(){var t=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,t},C.prototype.parseF2Dot14=function(){var t=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,t},C.prototype.parseULong=function(){var t=Mo(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},C.prototype.parseOffset32=C.prototype.parseULong,C.prototype.parseFixed=function(){var t=Ai(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,t},C.prototype.parseString=function(t){var e=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=t;for(var o=0;o<t;o++)n+=String.fromCharCode(e.getUint8(r+o));return n},C.prototype.parseTag=function(){return this.parseString(4)},C.prototype.parseLongDateTime=function(){var t=Mo(this.data,this.offset+this.relativeOffset+4);return t-=2082844800,this.relativeOffset+=8,t},C.prototype.parseVersion=function(t){var e=kn(this.data,this.offset+this.relativeOffset),r=kn(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,t===void 0&&(t=4096),e+r/t/10},C.prototype.skip=function(t,e){e===void 0&&(e=1),this.relativeOffset+=Ql[t]*e},C.prototype.parseULongList=function(t){t===void 0&&(t=this.parseULong());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint32(n),n+=4;return this.relativeOffset+=t*4,e},C.prototype.parseOffset16List=C.prototype.parseUShortList=function(t){t===void 0&&(t=this.parseUShort());for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint16(n),n+=2;return this.relativeOffset+=t*2,e},C.prototype.parseShortList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getInt16(n),n+=2;return this.relativeOffset+=t*2,e},C.prototype.parseByteList=function(t){for(var e=new Array(t),r=this.data,n=this.offset+this.relativeOffset,o=0;o<t;o++)e[o]=r.getUint8(n++);return this.relativeOffset+=t,e},C.prototype.parseList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},C.prototype.parseList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=0;n<t;n++)r[n]=e.call(this);return r},C.prototype.parseRecordList=function(t,e){e||(e=t,t=this.parseUShort());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var s={},u=0;u<n.length;u++){var c=n[u],f=e[c];s[c]=f.call(this)}r[o]=s}return r},C.prototype.parseRecordList32=function(t,e){e||(e=t,t=this.parseULong());for(var r=new Array(t),n=Object.keys(e),o=0;o<t;o++){for(var s={},u=0;u<n.length;u++){var c=n[u],f=e[c];s[c]=f.call(this)}r[o]=s}return r},C.prototype.parseStruct=function(t){if(typeof t=="function")return t.call(this);for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n],s=t[o];r[o]=s.call(this)}return r},C.prototype.parseValueRecord=function(t){if(t===void 0&&(t=this.parseUShort()),t!==0){var e={};return t&1&&(e.xPlacement=this.parseShort()),t&2&&(e.yPlacement=this.parseShort()),t&4&&(e.xAdvance=this.parseShort()),t&8&&(e.yAdvance=this.parseShort()),t&16&&(e.xPlaDevice=void 0,this.parseShort()),t&32&&(e.yPlaDevice=void 0,this.parseShort()),t&64&&(e.xAdvDevice=void 0,this.parseShort()),t&128&&(e.yAdvDevice=void 0,this.parseShort()),e}},C.prototype.parseValueRecordList=function(){for(var t=this.parseUShort(),e=this.parseUShort(),r=new Array(e),n=0;n<e;n++)r[n]=this.parseValueRecord(t);return r},C.prototype.parsePointer=function(t){var e=this.parseOffset16();if(e>0)return new C(this.data,this.offset+e).parseStruct(t)},C.prototype.parsePointer32=function(t){var e=this.parseOffset32();if(e>0)return new C(this.data,this.offset+e).parseStruct(t)},C.prototype.parseListOfLists=function(t){for(var e=this.parseOffset16List(),r=e.length,n=this.relativeOffset,o=new Array(r),s=0;s<r;s++){var u=e[s];if(u===0){o[s]=void 0;continue}if(this.relativeOffset=u,t){for(var c=this.parseOffset16List(),f=new Array(c.length),p=0;p<c.length;p++)this.relativeOffset=u+c[p],f[p]=t.call(this);o[s]=f}else o[s]=this.parseUShortList()}return this.relativeOffset=n,o},C.prototype.parseCoverage=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort(),r=this.parseUShort();if(e===1)return{format:1,glyphs:this.parseUShortList(r)};if(e===2){for(var n=new Array(r),o=0;o<r;o++)n[o]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+t.toString(16)+": Coverage format must be 1 or 2.")},C.prototype.parseClassDef=function(){var t=this.offset+this.relativeOffset,e=this.parseUShort();if(e===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(e===2)return{format:2,ranges:this.parseRecordList({start:C.uShort,end:C.uShort,classId:C.uShort})};throw new Error("0x"+t.toString(16)+": ClassDef format must be 1 or 2.")},C.list=function(t,e){return function(){return this.parseList(t,e)}},C.list32=function(t,e){return function(){return this.parseList32(t,e)}},C.recordList=function(t,e){return function(){return this.parseRecordList(t,e)}},C.recordList32=function(t,e){return function(){return this.parseRecordList32(t,e)}},C.pointer=function(t){return function(){return this.parsePointer(t)}},C.pointer32=function(t){return function(){return this.parsePointer32(t)}},C.tag=C.prototype.parseTag,C.byte=C.prototype.parseByte,C.uShort=C.offset16=C.prototype.parseUShort,C.uShortList=C.prototype.parseUShortList,C.uLong=C.offset32=C.prototype.parseULong,C.uLongList=C.prototype.parseULongList,C.struct=C.prototype.parseStruct,C.coverage=C.prototype.parseCoverage,C.classDef=C.prototype.parseClassDef;var Oi={reserved:C.uShort,reqFeatureIndex:C.uShort,featureIndexes:C.uShortList};C.prototype.parseScriptList=function(){return this.parsePointer(C.recordList({tag:C.tag,script:C.pointer({defaultLangSys:C.pointer(Oi),langSysRecords:C.recordList({tag:C.tag,langSys:C.pointer(Oi)})})}))||[]},C.prototype.parseFeatureList=function(){return this.parsePointer(C.recordList({tag:C.tag,feature:C.pointer({featureParams:C.offset16,lookupListIndexes:C.uShortList})}))||[]},C.prototype.parseLookupList=function(t){return this.parsePointer(C.list(C.pointer(function(){var e=this.parseUShort();Z.argument(1<=e&&e<=9,"GPOS/GSUB lookup type "+e+" unknown.");var r=this.parseUShort(),n=r&16;return{lookupType:e,lookupFlag:r,subtables:this.parseList(C.pointer(t[e])),markFilteringSet:n?this.parseUShort():void 0}})))||[]},C.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var t=this.parseUShort(),e=this.parseUShort();Z.argument(t===1&&e<1,"GPOS/GSUB feature variations table unknown.");var r=this.parseRecordList32({conditionSetOffset:C.offset32,featureTableSubstitutionOffset:C.offset32});return r})||[]};var Q={getByte:Pi,getCard8:Pi,getUShort:kn,getCard16:kn,getShort:$l,getULong:Mo,getFixed:Ai,getTag:ql,getOffset:jl,getBytes:Zl,bytesToString:Kl,Parser:C};function Jl(t,e){e.parseUShort(),t.length=e.parseULong(),t.language=e.parseULong();var r;t.groupCount=r=e.parseULong(),t.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var o=e.parseULong(),s=e.parseULong(),u=e.parseULong(),c=o;c<=s;c+=1)t.glyphIndexMap[c]=u,u++}function ec(t,e,r,n,o){t.length=e.parseUShort(),t.language=e.parseUShort();var s;t.segCount=s=e.parseUShort()>>1,e.skip("uShort",3),t.glyphIndexMap={};for(var u=new Q.Parser(r,n+o+14),c=new Q.Parser(r,n+o+16+s*2),f=new Q.Parser(r,n+o+16+s*4),p=new Q.Parser(r,n+o+16+s*6),g=n+o+16+s*8,y=0;y<s-1;y+=1)for(var m=void 0,S=u.parseUShort(),E=c.parseUShort(),k=f.parseShort(),x=p.parseUShort(),A=E;A<=S;A+=1)x!==0?(g=p.offset+p.relativeOffset-2,g+=x,g+=(A-E)*2,m=Q.getUShort(r,g),m!==0&&(m=m+k&65535)):m=A+k&65535,t.glyphIndexMap[A]=m}function tc(t,e){var r={};r.version=Q.getUShort(t,e),Z.argument(r.version===0,"cmap table version should be 0."),r.numTables=Q.getUShort(t,e+2);for(var n=-1,o=r.numTables-1;o>=0;o-=1){var s=Q.getUShort(t,e+4+o*8),u=Q.getUShort(t,e+4+o*8+2);if(s===3&&(u===0||u===1||u===10)||s===0&&(u===0||u===1||u===2||u===3||u===4)){n=Q.getULong(t,e+4+o*8+4);break}}if(n===-1)throw new Error("No valid cmap sub-tables found.");var c=new Q.Parser(t,e+n);if(r.format=c.parseUShort(),r.format===12)Jl(r,c);else if(r.format===4)ec(r,c,t,e,n);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");return r}function rc(t,e,r){t.segments.push({end:e,start:e,delta:-(e-r),offset:0,glyphIndex:r})}function nc(t){t.segments.push({end:65535,start:65535,delta:1,offset:0})}function oc(t){var e=!0,r;for(r=t.length-1;r>0;r-=1){var n=t.get(r);if(n.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),e=!1;break}}var o=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:e?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:e?12:12+8}];e||(o=o.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),o=o.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var s=new z.Table("cmap",o);for(s.segments=[],r=0;r<t.length;r+=1){for(var u=t.get(r),c=0;c<u.unicodes.length;c+=1)rc(s,u.unicodes[c],r);s.segments=s.segments.sort(function(U,O){return U.start-O.start})}nc(s);var f=s.segments.length,p=0,g=[],y=[],m=[],S=[],E=[],k=[];for(r=0;r<f;r+=1){var x=s.segments[r];x.end<=65535&&x.start<=65535?(g=g.concat({name:"end_"+r,type:"USHORT",value:x.end}),y=y.concat({name:"start_"+r,type:"USHORT",value:x.start}),m=m.concat({name:"idDelta_"+r,type:"SHORT",value:x.delta}),S=S.concat({name:"idRangeOffset_"+r,type:"USHORT",value:x.offset}),x.glyphId!==void 0&&(E=E.concat({name:"glyph_"+r,type:"USHORT",value:x.glyphId}))):p+=1,!e&&x.glyphIndex!==void 0&&(k=k.concat({name:"cmap12Start_"+r,type:"ULONG",value:x.start}),k=k.concat({name:"cmap12End_"+r,type:"ULONG",value:x.end}),k=k.concat({name:"cmap12Glyph_"+r,type:"ULONG",value:x.glyphIndex}))}if(s.segCountX2=(f-p)*2,s.searchRange=Math.pow(2,Math.floor(Math.log(f-p)/Math.log(2)))*2,s.entrySelector=Math.log(s.searchRange/2)/Math.log(2),s.rangeShift=s.segCountX2-s.searchRange,s.fields=s.fields.concat(g),s.fields.push({name:"reservedPad",type:"USHORT",value:0}),s.fields=s.fields.concat(y),s.fields=s.fields.concat(m),s.fields=s.fields.concat(S),s.fields=s.fields.concat(E),s.cmap4Length=14+g.length*2+2+y.length*2+m.length*2+S.length*2+E.length*2,!e){var A=16+k.length*4;s.cmap12Offset=12+2*2+4+s.cmap4Length,s.fields=s.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:A},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:k.length/3}]),s.fields=s.fields.concat(k)}return s}var sc={parse:tc,make:oc},Cn=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],ic=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],ac=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Ri=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Di(t){this.font=t}Di.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.font.glyphs;if(r){for(var n=0;n<r.length;n+=1)for(var o=r.get(n),s=0;s<o.unicodes.length;s+=1)if(o.unicodes[s]===e)return n}return null};function Pn(t,e){this.encoding=t,this.charset=e}Pn.prototype.charToGlyphIndex=function(t){var e=t.codePointAt(0),r=this.encoding[e];return this.charset.indexOf(r)};function uc(t,e,r,n,o){t.beginPath(),t.moveTo(e,r),t.lineTo(n,o),t.stroke()}var Vt={line:uc};function lc(t,e){var r=e||new Be;return{configurable:!0,get:function(){return typeof r=="function"&&(r=r()),r},set:function(n){r=n}}}function Je(t){this.bindConstructorValues(t)}Je.prototype.bindConstructorValues=function(t){this.index=t.index||0,this.name=t.name||null,this.unicode=t.unicode||void 0,this.unicodes=t.unicodes||t.unicode!==void 0?[t.unicode]:[],"xMin"in t&&(this.xMin=t.xMin),"yMin"in t&&(this.yMin=t.yMin),"xMax"in t&&(this.xMax=t.xMax),"yMax"in t&&(this.yMax=t.yMax),"advanceWidth"in t&&(this.advanceWidth=t.advanceWidth),Object.defineProperty(this,"path",lc(this,t.path))},Je.prototype.addUnicode=function(t){this.unicodes.length===0&&(this.unicode=t),this.unicodes.push(t)},Je.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},Je.prototype.getPath=function(t,e,r,n,o){t=t!==void 0?t:0,e=e!==void 0?e:0,r=r!==void 0?r:72;var s,u;n||(n={});var c=n.xScale,f=n.yScale;if(n.hinting&&o&&o.hinting&&(u=this.path&&o.hinting.exec(this,r)),u)s=o.hinting.getCommands(u),t=Math.round(t),e=Math.round(e),c=f=1;else{s=this.path.commands;var p=1/(this.path.unitsPerEm||1e3)*r;c===void 0&&(c=p),f===void 0&&(f=p)}for(var g=new Be,y=0;y<s.length;y+=1){var m=s[y];m.type==="M"?g.moveTo(t+m.x*c,e+-m.y*f):m.type==="L"?g.lineTo(t+m.x*c,e+-m.y*f):m.type==="Q"?g.quadraticCurveTo(t+m.x1*c,e+-m.y1*f,t+m.x*c,e+-m.y*f):m.type==="C"?g.curveTo(t+m.x1*c,e+-m.y1*f,t+m.x2*c,e+-m.y2*f,t+m.x*c,e+-m.y*f):m.type==="Z"&&g.closePath()}return g},Je.prototype.getContours=function(){if(this.points===void 0)return[];for(var t=[],e=[],r=0;r<this.points.length;r+=1){var n=this.points[r];e.push(n),n.lastPointOfContour&&(t.push(e),e=[])}return Z.argument(e.length===0,"There are still points left in the current contour."),t},Je.prototype.getMetrics=function(){for(var t=this.path.commands,e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];o.type!=="Z"&&(e.push(o.x),r.push(o.y)),(o.type==="Q"||o.type==="C")&&(e.push(o.x1),r.push(o.y1)),o.type==="C"&&(e.push(o.x2),r.push(o.y2))}var s={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,e),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s},Je.prototype.draw=function(t,e,r,n,o){this.getPath(e,r,n,o).draw(t)},Je.prototype.drawPoints=function(t,e,r,n){function o(y,m,S,E){t.beginPath();for(var k=0;k<y.length;k+=1)t.moveTo(m+y[k].x*E,S+y[k].y*E),t.arc(m+y[k].x*E,S+y[k].y*E,2,0,Math.PI*2,!1);t.closePath(),t.fill()}e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24;for(var s=1/this.path.unitsPerEm*n,u=[],c=[],f=this.path,p=0;p<f.commands.length;p+=1){var g=f.commands[p];g.x!==void 0&&u.push({x:g.x,y:-g.y}),g.x1!==void 0&&c.push({x:g.x1,y:-g.y1}),g.x2!==void 0&&c.push({x:g.x2,y:-g.y2})}t.fillStyle="blue",o(u,e,r,s),t.fillStyle="red",o(c,e,r,s)},Je.prototype.drawMetrics=function(t,e,r,n){var o;e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:24,o=1/this.path.unitsPerEm*n,t.lineWidth=1,t.strokeStyle="black",Vt.line(t,e,-1e4,e,1e4),Vt.line(t,-1e4,r,1e4,r);var s=this.xMin||0,u=this.yMin||0,c=this.xMax||0,f=this.yMax||0,p=this.advanceWidth||0;t.strokeStyle="blue",Vt.line(t,e+s*o,-1e4,e+s*o,1e4),Vt.line(t,e+c*o,-1e4,e+c*o,1e4),Vt.line(t,-1e4,r+-u*o,1e4,r+-u*o),Vt.line(t,-1e4,r+-f*o,1e4,r+-f*o),t.strokeStyle="green",Vt.line(t,e+p*o,-1e4,e+p*o,1e4)};function An(t,e,r){Object.defineProperty(t,e,{get:function(){return t.path,t[r]},set:function(n){t[r]=n},enumerable:!0,configurable:!0})}function Fo(t,e){if(this.font=t,this.glyphs={},Array.isArray(e))for(var r=0;r<e.length;r++){var n=e[r];n.path.unitsPerEm=t.unitsPerEm,this.glyphs[r]=n}this.length=e&&e.length||0}Fo.prototype.get=function(t){if(this.glyphs[t]===void 0){this.font._push(t),typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());var e=this.glyphs[t],r=this.font._IndexToUnicodeMap[t];if(r)for(var n=0;n<r.unicodes.length;n++)e.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?e.name="gid"+t:e.name=this.font.cffEncoding.charset[t]:this.font.glyphNames.names&&(e.name=this.font.glyphNames.glyphIndexToName(t)),this.glyphs[t].advanceWidth=this.font._hmtxTableData[t].advanceWidth,this.glyphs[t].leftSideBearing=this.font._hmtxTableData[t].leftSideBearing}else typeof this.glyphs[t]=="function"&&(this.glyphs[t]=this.glyphs[t]());return this.glyphs[t]},Fo.prototype.push=function(t,e){this.glyphs[t]=e,this.length++};function cc(t,e){return new Je({index:e,font:t})}function fc(t,e,r,n,o,s){return function(){var u=new Je({index:e,font:t});return u.path=function(){r(u,n,o);var c=s(t.glyphs,u);return c.unitsPerEm=t.unitsPerEm,c},An(u,"xMin","_xMin"),An(u,"xMax","_xMax"),An(u,"yMin","_yMin"),An(u,"yMax","_yMax"),u}}function hc(t,e,r,n){return function(){var o=new Je({index:e,font:t});return o.path=function(){var s=r(t,o,n);return s.unitsPerEm=t.unitsPerEm,s},o}}var ct={GlyphSet:Fo,glyphLoader:cc,ttfGlyphLoader:fc,cffGlyphLoader:hc};function Ui(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r+=1)if(!Ui(t[r],e[r]))return!1;return!0}else return!1}function Lo(t){var e;return t.length<1240?e=107:t.length<33900?e=1131:e=32768,e}function Dt(t,e,r){var n=[],o=[],s=Q.getCard16(t,e),u,c;if(s!==0){var f=Q.getByte(t,e+2);u=e+(s+1)*f+2;for(var p=e+3,g=0;g<s+1;g+=1)n.push(Q.getOffset(t,p,f)),p+=f;c=u+n[s]}else c=e+2;for(var y=0;y<n.length-1;y+=1){var m=Q.getBytes(t,u+n[y],u+n[y+1]);r&&(m=r(m)),o.push(m)}return{objects:o,startOffset:e,endOffset:c}}function pc(t,e){var r=[],n=Q.getCard16(t,e),o,s;if(n!==0){var u=Q.getByte(t,e+2);o=e+(n+1)*u+2;for(var c=e+3,f=0;f<n+1;f+=1)r.push(Q.getOffset(t,c,u)),c+=u;s=o+r[n]}else s=e+2;return{offsets:r,startOffset:e,endOffset:s}}function dc(t,e,r,n,o){var s=Q.getCard16(r,n),u=0;if(s!==0){var c=Q.getByte(r,n+2);u=n+(s+1)*c+2}var f=Q.getBytes(r,u+e[t],u+e[t+1]);return o&&(f=o(f)),f}function vc(t){for(var e="",r=15,n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var o=t.parseByte(),s=o>>4,u=o&15;if(s===r||(e+=n[s],u===r))break;e+=n[u]}return parseFloat(e)}function gc(t,e){var r,n,o,s;if(e===28)return r=t.parseByte(),n=t.parseByte(),r<<8|n;if(e===29)return r=t.parseByte(),n=t.parseByte(),o=t.parseByte(),s=t.parseByte(),r<<24|n<<16|o<<8|s;if(e===30)return vc(t);if(e>=32&&e<=246)return e-139;if(e>=247&&e<=250)return r=t.parseByte(),(e-247)*256+r+108;if(e>=251&&e<=254)return r=t.parseByte(),-(e-251)*256-r-108;throw new Error("Invalid b0 "+e)}function mc(t){for(var e={},r=0;r<t.length;r+=1){var n=t[r][0],o=t[r][1],s=void 0;if(o.length===1?s=o[0]:s=o,e.hasOwnProperty(n)&&!isNaN(e[n]))throw new Error("Object "+e+" already has key "+n);e[n]=s}return e}function Bi(t,e,r){e=e!==void 0?e:0;var n=new Q.Parser(t,e),o=[],s=[];for(r=r!==void 0?r:t.length;n.relativeOffset<r;){var u=n.parseByte();u<=21?(u===12&&(u=1200+n.parseByte()),o.push([u,s]),s=[]):s.push(gc(n,u))}return mc(o)}function Mr(t,e){return e<=390?e=Cn[e]:e=t[e-391],e}function Mi(t,e,r){for(var n={},o,s=0;s<e.length;s+=1){var u=e[s];if(Array.isArray(u.type)){var c=[];c.length=u.type.length;for(var f=0;f<u.type.length;f++)o=t[u.op]!==void 0?t[u.op][f]:void 0,o===void 0&&(o=u.value!==void 0&&u.value[f]!==void 0?u.value[f]:null),u.type[f]==="SID"&&(o=Mr(r,o)),c[f]=o;n[u.name]=c}else o=t[u.op],o===void 0&&(o=u.value!==void 0?u.value:null),u.type==="SID"&&(o=Mr(r,o)),n[u.name]=o}return n}function yc(t,e){var r={};return r.formatMajor=Q.getCard8(t,e),r.formatMinor=Q.getCard8(t,e+1),r.size=Q.getCard8(t,e+2),r.offsetSize=Q.getCard8(t,e+3),r.startOffset=e,r.endOffset=e+4,r}var Fi=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Li=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function wc(t,e){var r=Bi(t,0,t.byteLength);return Mi(r,Fi,e)}function Ii(t,e,r,n){var o=Bi(t,e,r);return Mi(o,Li,n)}function Gi(t,e,r,n){for(var o=[],s=0;s<r.length;s+=1){var u=new DataView(new Uint8Array(r[s]).buffer),c=wc(u,n);c._subrs=[],c._subrsBias=0,c._defaultWidthX=0,c._nominalWidthX=0;var f=c.private[0],p=c.private[1];if(f!==0&&p!==0){var g=Ii(t,p+e,f,n);if(c._defaultWidthX=g.defaultWidthX,c._nominalWidthX=g.nominalWidthX,g.subrs!==0){var y=p+g.subrs,m=Dt(t,y+e);c._subrs=m.objects,c._subrsBias=Lo(c._subrs)}c._privateDict=g}o.push(c)}return o}function bc(t,e,r,n){var o,s,u=new Q.Parser(t,e);r-=1;var c=[".notdef"],f=u.parseCard8();if(f===0)for(var p=0;p<r;p+=1)o=u.parseSID(),c.push(Mr(n,o));else if(f===1)for(;c.length<=r;){o=u.parseSID(),s=u.parseCard8();for(var g=0;g<=s;g+=1)c.push(Mr(n,o)),o+=1}else if(f===2)for(;c.length<=r;){o=u.parseSID(),s=u.parseCard16();for(var y=0;y<=s;y+=1)c.push(Mr(n,o)),o+=1}else throw new Error("Unknown charset format "+f);return c}function Sc(t,e,r){var n,o={},s=new Q.Parser(t,e),u=s.parseCard8();if(u===0)for(var c=s.parseCard8(),f=0;f<c;f+=1)n=s.parseCard8(),o[n]=f;else if(u===1){var p=s.parseCard8();n=1;for(var g=0;g<p;g+=1)for(var y=s.parseCard8(),m=s.parseCard8(),S=y;S<=y+m;S+=1)o[S]=n,n+=1}else throw new Error("Unknown encoding format "+u);return new Pn(o,r)}function Ni(t,e,r){var n,o,s,u,c=new Be,f=[],p=0,g=!1,y=!1,m=0,S=0,E,k,x,A;if(t.isCIDFont){var U=t.tables.cff.topDict._fdSelect[e.index],O=t.tables.cff.topDict._fdArray[U];E=O._subrs,k=O._subrsBias,x=O._defaultWidthX,A=O._nominalWidthX}else E=t.tables.cff.topDict._subrs,k=t.tables.cff.topDict._subrsBias,x=t.tables.cff.topDict._defaultWidthX,A=t.tables.cff.topDict._nominalWidthX;var V=x;function L(X,te){y&&c.closePath(),c.moveTo(X,te),y=!0}function j(){var X;X=f.length%2!==0,X&&!g&&(V=f.shift()+A),p+=f.length>>1,f.length=0,g=!0}function $(X){for(var te,ne,K,Le,Re,oe,ye,Te,he,se,de,we,pe=0;pe<X.length;){var Me=X[pe];switch(pe+=1,Me){case 1:j();break;case 3:j();break;case 4:f.length>1&&!g&&(V=f.shift()+A,g=!0),S+=f.pop(),L(m,S);break;case 5:for(;f.length>0;)m+=f.shift(),S+=f.shift(),c.lineTo(m,S);break;case 6:for(;f.length>0&&(m+=f.shift(),c.lineTo(m,S),f.length!==0);)S+=f.shift(),c.lineTo(m,S);break;case 7:for(;f.length>0&&(S+=f.shift(),c.lineTo(m,S),f.length!==0);)m+=f.shift(),c.lineTo(m,S);break;case 8:for(;f.length>0;)n=m+f.shift(),o=S+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),S=u+f.shift(),c.curveTo(n,o,s,u,m,S);break;case 10:Re=f.pop()+k,oe=E[Re],oe&&$(oe);break;case 11:return;case 12:switch(Me=X[pe],pe+=1,Me){case 35:n=m+f.shift(),o=S+f.shift(),s=n+f.shift(),u=o+f.shift(),ye=s+f.shift(),Te=u+f.shift(),he=ye+f.shift(),se=Te+f.shift(),de=he+f.shift(),we=se+f.shift(),m=de+f.shift(),S=we+f.shift(),f.shift(),c.curveTo(n,o,s,u,ye,Te),c.curveTo(he,se,de,we,m,S);break;case 34:n=m+f.shift(),o=S,s=n+f.shift(),u=o+f.shift(),ye=s+f.shift(),Te=u,he=ye+f.shift(),se=u,de=he+f.shift(),we=S,m=de+f.shift(),c.curveTo(n,o,s,u,ye,Te),c.curveTo(he,se,de,we,m,S);break;case 36:n=m+f.shift(),o=S+f.shift(),s=n+f.shift(),u=o+f.shift(),ye=s+f.shift(),Te=u,he=ye+f.shift(),se=u,de=he+f.shift(),we=se+f.shift(),m=de+f.shift(),c.curveTo(n,o,s,u,ye,Te),c.curveTo(he,se,de,we,m,S);break;case 37:n=m+f.shift(),o=S+f.shift(),s=n+f.shift(),u=o+f.shift(),ye=s+f.shift(),Te=u+f.shift(),he=ye+f.shift(),se=Te+f.shift(),de=he+f.shift(),we=se+f.shift(),Math.abs(de-m)>Math.abs(we-S)?m=de+f.shift():S=we+f.shift(),c.curveTo(n,o,s,u,ye,Te),c.curveTo(he,se,de,we,m,S);break;default:console.log("Glyph "+e.index+": unknown operator 1200"+Me),f.length=0}break;case 14:f.length>0&&!g&&(V=f.shift()+A,g=!0),y&&(c.closePath(),y=!1);break;case 18:j();break;case 19:case 20:j(),pe+=p+7>>3;break;case 21:f.length>2&&!g&&(V=f.shift()+A,g=!0),S+=f.pop(),m+=f.pop(),L(m,S);break;case 22:f.length>1&&!g&&(V=f.shift()+A,g=!0),m+=f.pop(),L(m,S);break;case 23:j();break;case 24:for(;f.length>2;)n=m+f.shift(),o=S+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),S=u+f.shift(),c.curveTo(n,o,s,u,m,S);m+=f.shift(),S+=f.shift(),c.lineTo(m,S);break;case 25:for(;f.length>6;)m+=f.shift(),S+=f.shift(),c.lineTo(m,S);n=m+f.shift(),o=S+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),S=u+f.shift(),c.curveTo(n,o,s,u,m,S);break;case 26:for(f.length%2&&(m+=f.shift());f.length>0;)n=m,o=S+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s,S=u+f.shift(),c.curveTo(n,o,s,u,m,S);break;case 27:for(f.length%2&&(S+=f.shift());f.length>0;)n=m+f.shift(),o=S,s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),S=u,c.curveTo(n,o,s,u,m,S);break;case 28:te=X[pe],ne=X[pe+1],f.push((te<<24|ne<<16)>>16),pe+=2;break;case 29:Re=f.pop()+t.gsubrsBias,oe=t.gsubrs[Re],oe&&$(oe);break;case 30:for(;f.length>0&&(n=m,o=S+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),S=u+(f.length===1?f.shift():0),c.curveTo(n,o,s,u,m,S),f.length!==0);)n=m+f.shift(),o=S,s=n+f.shift(),u=o+f.shift(),S=u+f.shift(),m=s+(f.length===1?f.shift():0),c.curveTo(n,o,s,u,m,S);break;case 31:for(;f.length>0&&(n=m+f.shift(),o=S,s=n+f.shift(),u=o+f.shift(),S=u+f.shift(),m=s+(f.length===1?f.shift():0),c.curveTo(n,o,s,u,m,S),f.length!==0);)n=m,o=S+f.shift(),s=n+f.shift(),u=o+f.shift(),m=s+f.shift(),S=u+(f.length===1?f.shift():0),c.curveTo(n,o,s,u,m,S);break;default:Me<32?console.log("Glyph "+e.index+": unknown operator "+Me):Me<247?f.push(Me-139):Me<251?(te=X[pe],pe+=1,f.push((Me-247)*256+te+108)):Me<255?(te=X[pe],pe+=1,f.push(-(Me-251)*256-te-108)):(te=X[pe],ne=X[pe+1],K=X[pe+2],Le=X[pe+3],pe+=4,f.push((te<<24|ne<<16|K<<8|Le)/65536))}}}return $(r),e.advanceWidth=V,c}function _c(t,e,r,n){var o=[],s,u=new Q.Parser(t,e),c=u.parseCard8();if(c===0)for(var f=0;f<r;f++){if(s=u.parseCard8(),s>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+n+")");o.push(s)}else if(c===3){var p=u.parseCard16(),g=u.parseCard16();if(g!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+g);for(var y,m=0;m<p;m++){if(s=u.parseCard8(),y=u.parseCard16(),s>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+n+")");if(y>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+y);for(;g<y;g++)o.push(s);g=y}if(y!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+y)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+c);return o}function Ec(t,e,r,n){r.tables.cff={};var o=yc(t,e),s=Dt(t,o.endOffset,Q.bytesToString),u=Dt(t,s.endOffset),c=Dt(t,u.endOffset,Q.bytesToString),f=Dt(t,c.endOffset);r.gsubrs=f.objects,r.gsubrsBias=Lo(r.gsubrs);var p=Gi(t,e,u.objects,c.objects);if(p.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+p.length);var g=p[0];if(r.tables.cff.topDict=g,g._privateDict&&(r.defaultWidthX=g._privateDict.defaultWidthX,r.nominalWidthX=g._privateDict.nominalWidthX),g.ros[0]!==void 0&&g.ros[1]!==void 0&&(r.isCIDFont=!0),r.isCIDFont){var y=g.fdArray,m=g.fdSelect;if(y===0||m===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");y+=e;var S=Dt(t,y),E=Gi(t,e,S.objects,c.objects);g._fdArray=E,m+=e,g._fdSelect=_c(t,m,r.numGlyphs,E.length)}var k=e+g.private[1],x=Ii(t,k,g.private[0],c.objects);if(r.defaultWidthX=x.defaultWidthX,r.nominalWidthX=x.nominalWidthX,x.subrs!==0){var A=k+x.subrs,U=Dt(t,A);r.subrs=U.objects,r.subrsBias=Lo(r.subrs)}else r.subrs=[],r.subrsBias=0;var O;n.lowMemory?(O=pc(t,e+g.charStrings),r.nGlyphs=O.offsets.length):(O=Dt(t,e+g.charStrings),r.nGlyphs=O.objects.length);var V=bc(t,e+g.charset,r.nGlyphs,c.objects);if(g.encoding===0?r.cffEncoding=new Pn(ic,V):g.encoding===1?r.cffEncoding=new Pn(ac,V):r.cffEncoding=Sc(t,e+g.encoding,V),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new ct.GlyphSet(r),n.lowMemory)r._push=function($){var X=dc($,O.offsets,t,e+g.charStrings);r.glyphs.push($,ct.cffGlyphLoader(r,$,Ni,X))};else for(var L=0;L<r.nGlyphs;L+=1){var j=O.objects[L];r.glyphs.push(L,ct.cffGlyphLoader(r,L,Ni,j))}}function Hi(t,e){var r,n=Cn.indexOf(t);return n>=0&&(r=n),n=e.indexOf(t),n>=0?r=n+Cn.length:(r=Cn.length+e.length,e.push(t)),r}function Tc(){return new z.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function xc(t){var e=new z.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);e.names=[];for(var r=0;r<t.length;r+=1)e.names.push({name:"name_"+r,type:"NAME",value:t[r]});return e}function zi(t,e,r){for(var n={},o=0;o<t.length;o+=1){var s=t[o],u=e[s.name];u!==void 0&&!Ui(u,s.value)&&(s.type==="SID"&&(u=Hi(u,r)),n[s.op]={name:s.name,type:s.type,value:u})}return n}function Wi(t,e){var r=new z.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=zi(Fi,t,e),r}function Vi(t){var e=new z.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return e.topDicts=[{name:"topDict_0",type:"TABLE",value:t}],e}function kc(t){var e=new z.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);e.strings=[];for(var r=0;r<t.length;r+=1)e.strings.push({name:"string_"+r,type:"STRING",value:t[r]});return e}function Cc(){return new z.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function Pc(t,e){for(var r=new z.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<t.length;n+=1){var o=t[n],s=Hi(o,e);r.fields.push({name:"glyph_"+n,type:"SID",value:s})}return r}function Ac(t){var e=[],r=t.path;e.push({name:"width",type:"NUMBER",value:t.advanceWidth});for(var n=0,o=0,s=0;s<r.commands.length;s+=1){var u=void 0,c=void 0,f=r.commands[s];if(f.type==="Q"){var p=.3333333333333333,g=2/3;f={type:"C",x:f.x,y:f.y,x1:Math.round(p*n+g*f.x1),y1:Math.round(p*o+g*f.y1),x2:Math.round(p*f.x+g*f.x1),y2:Math.round(p*f.y+g*f.y1)}}if(f.type==="M")u=Math.round(f.x-n),c=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="L")u=Math.round(f.x-n),c=Math.round(f.y-o),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rlineto",type:"OP",value:5}),n=Math.round(f.x),o=Math.round(f.y);else if(f.type==="C"){var y=Math.round(f.x1-n),m=Math.round(f.y1-o),S=Math.round(f.x2-f.x1),E=Math.round(f.y2-f.y1);u=Math.round(f.x-f.x2),c=Math.round(f.y-f.y2),e.push({name:"dx1",type:"NUMBER",value:y}),e.push({name:"dy1",type:"NUMBER",value:m}),e.push({name:"dx2",type:"NUMBER",value:S}),e.push({name:"dy2",type:"NUMBER",value:E}),e.push({name:"dx",type:"NUMBER",value:u}),e.push({name:"dy",type:"NUMBER",value:c}),e.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(f.x),o=Math.round(f.y)}}return e.push({name:"endchar",type:"OP",value:14}),e}function Oc(t){for(var e=new z.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<t.length;r+=1){var n=t.get(r),o=Ac(n);e.charStrings.push({name:n.name,type:"CHARSTRING",value:o})}return e}function Rc(t,e){var r=new z.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=zi(Li,t,e),r}function Dc(t,e){for(var r=new z.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/e.unitsPerEm,o={version:e.version,fullName:e.fullName,familyName:e.familyName,weight:e.weightName,fontBBox:e.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},s={},u=[],c,f=1;f<t.length;f+=1)c=t.get(f),u.push(c.name);var p=[];r.header=Tc(),r.nameIndex=xc([e.postScriptName]);var g=Wi(o,p);r.topDictIndex=Vi(g),r.globalSubrIndex=Cc(),r.charsets=Pc(u,p),r.charStringsIndex=Oc(t),r.privateDict=Rc(s,p),r.stringIndex=kc(p);var y=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return o.charset=y,o.encoding=0,o.charStrings=o.charset+r.charsets.sizeOf(),o.private[1]=o.charStrings+r.charStringsIndex.sizeOf(),g=Wi(o,p),r.topDictIndex=Vi(g),r}var Uc={parse:Ec,make:Dc};function Bc(t,e){var r={},n=new Q.Parser(t,e);return r.version=n.parseVersion(),r.fontRevision=Math.round(n.parseFixed()*1e3)/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),Z.argument(r.magicNumber===1594834165,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r}function Mc(t){var e=Math.round(new Date().getTime()/1e3)+2082844800,r=e;return t.createdTimestamp&&(r=t.createdTimestamp+2082844800),new z.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:e},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],t)}var Fc={parse:Bc,make:Mc};function Lc(t,e){var r={},n=new Q.Parser(t,e);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r}function Ic(t){return new z.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],t)}var Gc={parse:Lc,make:Ic};function Nc(t,e,r,n,o){for(var s,u,c=new Q.Parser(t,e),f=0;f<n;f+=1){f<r&&(s=c.parseUShort(),u=c.parseShort());var p=o.get(f);p.advanceWidth=s,p.leftSideBearing=u}}function Hc(t,e,r,n,o){t._hmtxTableData={};for(var s,u,c=new Q.Parser(e,r),f=0;f<o;f+=1)f<n&&(s=c.parseUShort(),u=c.parseShort()),t._hmtxTableData[f]={advanceWidth:s,leftSideBearing:u}}function zc(t,e,r,n,o,s,u){u.lowMemory?Hc(t,e,r,n,o):Nc(e,r,n,o,s)}function Wc(t){for(var e=new z.Table("hmtx",[]),r=0;r<t.length;r+=1){var n=t.get(r),o=n.advanceWidth||0,s=n.leftSideBearing||0;e.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:o}),e.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:s})}return e}var Vc={parse:zc,make:Wc};function Yc(t){for(var e=new z.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:t.length}]),r="",n=12+t.length*4,o=0;o<t.length;++o){var s=r.indexOf(t[o]);s<0&&(s=r.length,r+=t[o]),e.fields.push({name:"offset "+o,type:"USHORT",value:n+s}),e.fields.push({name:"length "+o,type:"USHORT",value:t[o].length})}return e.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),e}function Xc(t,e){var r=new Q.Parser(t,e),n=r.parseULong();Z.argument(n===1,"Unsupported ltag table version."),r.skip("uLong",1);for(var o=r.parseULong(),s=[],u=0;u<o;u++){for(var c="",f=e+r.parseUShort(),p=r.parseUShort(),g=f;g<f+p;++g)c+=String.fromCharCode(t.getInt8(g));s.push(c)}return s}var $c={make:Yc,parse:Xc};function qc(t,e){var r={},n=new Q.Parser(t,e);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),r.version===1&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r}function jc(t){return new z.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:t}])}var Zc={parse:qc,make:jc},Yi=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Xi={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Kc={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},$i={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Qc(t,e,r){switch(t){case 0:if(e===65535)return"und";if(r)return r[e];break;case 1:return Xi[e];case 3:return $i[e]}}var Io="utf-16",Jc={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},ef={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function qi(t,e,r){switch(t){case 0:return Io;case 1:return ef[r]||Jc[e];case 3:if(e===1||e===10)return Io;break}}function tf(t,e,r){for(var n={},o=new Q.Parser(t,e),s=o.parseUShort(),u=o.parseUShort(),c=o.offset+o.parseUShort(),f=0;f<u;f++){var p=o.parseUShort(),g=o.parseUShort(),y=o.parseUShort(),m=o.parseUShort(),S=Yi[m]||m,E=o.parseUShort(),k=o.parseUShort(),x=Qc(p,y,r),A=qi(p,g,y);if(A!==void 0&&x!==void 0){var U=void 0;if(A===Io?U=lr.UTF16(t,c+k,E):U=lr.MACSTRING(t,c+k,E,A),U){var O=n[S];O===void 0&&(O=n[S]={}),O[x]=U}}}return s===1&&o.parseUShort(),n}function Go(t){var e={};for(var r in t)e[t[r]]=parseInt(r);return e}function ji(t,e,r,n,o,s){return new z.Record("NameRecord",[{name:"platformID",type:"USHORT",value:t},{name:"encodingID",type:"USHORT",value:e},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:o},{name:"offset",type:"USHORT",value:s}])}function rf(t,e){var r=t.length,n=e.length-r+1;e:for(var o=0;o<n;o++)for(;o<n;o++){for(var s=0;s<r;s++)if(e[o+s]!==t[s])continue e;return o}return-1}function Zi(t,e){var r=rf(t,e);if(r<0){r=e.length;for(var n=0,o=t.length;n<o;++n)e.push(t[n])}return r}function nf(t,e){var r,n=[],o={},s=Go(Yi);for(var u in t){var c=s[u];if(c===void 0&&(c=u),r=parseInt(c),isNaN(r))throw new Error('Name table entry "'+u+'" does not exist, see nameTableNames for complete list.');o[r]=t[u],n.push(r)}for(var f=Go(Xi),p=Go($i),g=[],y=[],m=0;m<n.length;m++){r=n[m];var S=o[r];for(var E in S){var k=S[E],x=1,A=f[E],U=Kc[A],O=qi(x,U,A),V=G.MACSTRING(k,O);V===void 0&&(x=0,A=e.indexOf(E),A<0&&(A=e.length,e.push(E)),U=4,V=G.UTF16(k));var L=Zi(V,y);g.push(ji(x,U,A,r,V.length,L));var j=p[E];if(j!==void 0){var $=G.UTF16(k),X=Zi($,y);g.push(ji(3,1,j,r,$.length,X))}}}g.sort(function(K,Le){return K.platformID-Le.platformID||K.encodingID-Le.encodingID||K.languageID-Le.languageID||K.nameID-Le.nameID});for(var te=new z.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:g.length},{name:"stringOffset",type:"USHORT",value:6+g.length*12}]),ne=0;ne<g.length;ne++)te.fields.push({name:"record_"+ne,type:"RECORD",value:g[ne]});return te.fields.push({name:"strings",type:"LITERAL",value:y}),te}var of={parse:tf,make:nf},No=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function sf(t){for(var e=0;e<No.length;e+=1){var r=No[e];if(t>=r.begin&&t<r.end)return e}return-1}function af(t,e){var r={},n=new Q.Parser(t,e);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var o=0;o<10;o++)r.panose[o]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r}function uf(t){return new z.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],t)}var Ki={parse:af,make:uf,unicodeRanges:No,getUnicodeRange:sf};function lf(t,e){var r={},n=new Q.Parser(t,e);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=Ri.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.glyphNameIndex[o]=n.parseUShort();r.names=[];for(var s=0;s<r.numberOfGlyphs;s++)if(r.glyphNameIndex[s]>=Ri.length){var u=n.parseChar();r.names.push(n.parseString(u))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var c=0;c<r.numberOfGlyphs;c++)r.offset[c]=n.parseChar();break}return r}function cf(){return new z.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var ff={parse:lf,make:cf},nt=new Array(9);nt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(C.coverage),deltaGlyphId:this.parseUShort()};if(r===2)return{substFormat:2,coverage:this.parsePointer(C.coverage),substitute:this.parseOffset16List()};Z.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},nt[2]=function(){var e=this.parseUShort();return Z.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),sequences:this.parseListOfLists()}},nt[3]=function(){var e=this.parseUShort();return Z.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),alternateSets:this.parseListOfLists()}},nt[4]=function(){var e=this.parseUShort();return Z.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var cr={sequenceIndex:C.uShort,lookupListIndex:C.uShort};nt[5]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:r,coverage:this.parsePointer(C.coverage),ruleSets:this.parseListOfLists(function(){var s=this.parseUShort(),u=this.parseUShort();return{input:this.parseUShortList(s-1),lookupRecords:this.parseRecordList(u,cr)}})};if(r===2)return{substFormat:r,coverage:this.parsePointer(C.coverage),classDef:this.parsePointer(C.classDef),classSets:this.parseListOfLists(function(){var s=this.parseUShort(),u=this.parseUShort();return{classes:this.parseUShortList(s-1),lookupRecords:this.parseRecordList(u,cr)}})};if(r===3){var n=this.parseUShort(),o=this.parseUShort();return{substFormat:r,coverages:this.parseList(n,C.pointer(C.coverage)),lookupRecords:this.parseRecordList(o,cr)}}Z.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},nt[6]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{substFormat:1,coverage:this.parsePointer(C.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(cr)}})};if(r===2)return{substFormat:2,coverage:this.parsePointer(C.coverage),backtrackClassDef:this.parsePointer(C.classDef),inputClassDef:this.parsePointer(C.classDef),lookaheadClassDef:this.parsePointer(C.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(cr)}})};if(r===3)return{substFormat:3,backtrackCoverage:this.parseList(C.pointer(C.coverage)),inputCoverage:this.parseList(C.pointer(C.coverage)),lookaheadCoverage:this.parseList(C.pointer(C.coverage)),lookupRecords:this.parseRecordList(cr)};Z.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},nt[7]=function(){var e=this.parseUShort();Z.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var r=this.parseUShort(),n=new C(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:r,extension:nt[r].call(n)}},nt[8]=function(){var e=this.parseUShort();return Z.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(C.coverage),backtrackCoverage:this.parseList(C.pointer(C.coverage)),lookaheadCoverage:this.parseList(C.pointer(C.coverage)),substitutes:this.parseUShortList()}};function hf(t,e){e=e||0;var r=new C(t,e),n=r.parseVersion(1);return Z.argument(n===1||n===1.1,"Unsupported GSUB table version."),n===1?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(nt)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(nt),variations:r.parseFeatureVariationsList()}}var fr=new Array(9);fr[1]=function(e){return e.substFormat===1?new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.ushortList("substitute",e.substitute)))},fr[2]=function(e){return Z.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("seqSet",e.sequences,function(r){return new z.Table("sequenceSetTable",z.ushortList("sequence",r))})))},fr[3]=function(e){return Z.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("altSet",e.alternateSets,function(r){return new z.Table("alternateSetTable",z.ushortList("alternate",r))})))},fr[4]=function(e){return Z.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new z.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("ligSet",e.ligatureSets,function(r){return new z.Table("ligatureSetTable",z.tableList("ligature",r,function(n){return new z.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:n.ligGlyph}].concat(z.ushortList("component",n.components,n.components.length+1)))}))})))},fr[6]=function(e){if(e.substFormat===1){var r=new z.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new z.Coverage(e.coverage)}].concat(z.tableList("chainRuleSet",e.chainRuleSets,function(s){return new z.Table("chainRuleSetTable",z.tableList("chainRule",s,function(u){var c=z.ushortList("backtrackGlyph",u.backtrack,u.backtrack.length).concat(z.ushortList("inputGlyph",u.input,u.input.length+1)).concat(z.ushortList("lookaheadGlyph",u.lookahead,u.lookahead.length)).concat(z.ushortList("substitution",[],u.lookupRecords.length));return u.lookupRecords.forEach(function(f,p){c=c.concat({name:"sequenceIndex"+p,type:"USHORT",value:f.sequenceIndex}).concat({name:"lookupListIndex"+p,type:"USHORT",value:f.lookupListIndex})}),new z.Table("chainRuleTable",c)}))})));return r}else if(e.substFormat===2)Z.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var n=[{name:"substFormat",type:"USHORT",value:e.substFormat}];n.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(s,u){n.push({name:"backtrackCoverage"+u,type:"TABLE",value:new z.Coverage(s)})}),n.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(s,u){n.push({name:"inputCoverage"+u,type:"TABLE",value:new z.Coverage(s)})}),n.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(s,u){n.push({name:"lookaheadCoverage"+u,type:"TABLE",value:new z.Coverage(s)})}),n.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(s,u){n=n.concat({name:"sequenceIndex"+u,type:"USHORT",value:s.sequenceIndex}).concat({name:"lookupListIndex"+u,type:"USHORT",value:s.lookupListIndex})});var o=new z.Table("chainContextTable",n);return o}Z.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function pf(t){return new z.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new z.ScriptList(t.scripts)},{name:"features",type:"TABLE",value:new z.FeatureList(t.features)},{name:"lookups",type:"TABLE",value:new z.LookupList(t.lookups,fr)}])}var df={parse:hf,make:pf};function vf(t,e){var r=new Q.Parser(t,e),n=r.parseULong();Z.argument(n===1,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var o=r.parseULong(),s={},u=0;u<o;u++){var c=r.parseTag(),f=r.parseULong(),p=r.parseULong(),g=lr.UTF8(t,e+f,p);s[c]=g}return s}function gf(t){var e=Object.keys(t).length,r="",n=16+e*12,o=new z.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:e}]);for(var s in t){var u=r.length;r+=t[s],o.fields.push({name:"tag "+s,type:"TAG",value:s}),o.fields.push({name:"offset "+s,type:"ULONG",value:n+u}),o.fields.push({name:"length "+s,type:"ULONG",value:t[s].length})}return o.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),o}var mf={parse:vf,make:gf};function Qi(t){return Math.log(t)/Math.log(2)|0}function Ho(t){for(;t.length%4!==0;)t.push(0);for(var e=0,r=0;r<t.length;r+=4)e+=(t[r]<<24)+(t[r+1]<<16)+(t[r+2]<<8)+t[r+3];return e%=Math.pow(2,32),e}function Ji(t,e,r,n){return new z.Record("Table Record",[{name:"tag",type:"TAG",value:t!==void 0?t:""},{name:"checkSum",type:"ULONG",value:e!==void 0?e:0},{name:"offset",type:"ULONG",value:r!==void 0?r:0},{name:"length",type:"ULONG",value:n!==void 0?n:0}])}function ea(t){var e=new z.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);e.tables=t,e.numTables=t.length;var r=Math.pow(2,Qi(e.numTables));e.searchRange=16*r,e.entrySelector=Qi(r),e.rangeShift=e.numTables*16-e.searchRange;for(var n=[],o=[],s=e.sizeOf()+Ji().sizeOf()*e.numTables;s%4!==0;)s+=1,o.push({name:"padding",type:"BYTE",value:0});for(var u=0;u<t.length;u+=1){var c=t[u];Z.argument(c.tableName.length===4,"Table name"+c.tableName+" is invalid.");var f=c.sizeOf(),p=Ji(c.tableName,Ho(c.encode()),s,f);for(n.push({name:p.tag+" Table Record",type:"RECORD",value:p}),o.push({name:c.tableName+" table",type:"RECORD",value:c}),s+=f,Z.argument(!isNaN(s),"Something went wrong calculating the offset.");s%4!==0;)s+=1,o.push({name:"padding",type:"BYTE",value:0})}return n.sort(function(g,y){return g.value.tag>y.value.tag?1:-1}),e.fields=e.fields.concat(n),e.fields=e.fields.concat(o),e}function ta(t,e,r){for(var n=0;n<e.length;n+=1){var o=t.charToGlyphIndex(e[n]);if(o>0){var s=t.glyphs.get(o);return s.getMetrics()}}return r}function yf(t){for(var e=0,r=0;r<t.length;r+=1)e+=t[r];return e/t.length}function wf(t){for(var e=[],r=[],n=[],o=[],s=[],u=[],c=[],f,p=0,g=0,y=0,m=0,S=0,E=0;E<t.glyphs.length;E+=1){var k=t.glyphs.get(E),x=k.unicode|0;if(isNaN(k.advanceWidth))throw new Error("Glyph "+k.name+" ("+E+"): advanceWidth is not a number.");(f>x||f===void 0)&&x>0&&(f=x),p<x&&(p=x);var A=Ki.getUnicodeRange(x);if(A<32)g|=1<<A;else if(A<64)y|=1<<A-32;else if(A<96)m|=1<<A-64;else if(A<123)S|=1<<A-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(k.name!==".notdef"){var U=k.getMetrics();e.push(U.xMin),r.push(U.yMin),n.push(U.xMax),o.push(U.yMax),u.push(U.leftSideBearing),c.push(U.rightSideBearing),s.push(k.advanceWidth)}}var O={xMin:Math.min.apply(null,e),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,o),advanceWidthMax:Math.max.apply(null,s),advanceWidthAvg:yf(s),minLeftSideBearing:Math.min.apply(null,u),maxLeftSideBearing:Math.max.apply(null,u),minRightSideBearing:Math.min.apply(null,c)};O.ascender=t.ascender,O.descender=t.descender;var V=Fc.make({flags:3,unitsPerEm:t.unitsPerEm,xMin:O.xMin,yMin:O.yMin,xMax:O.xMax,yMax:O.yMax,lowestRecPPEM:3,createdTimestamp:t.createdTimestamp}),L=Gc.make({ascender:O.ascender,descender:O.descender,advanceWidthMax:O.advanceWidthMax,minLeftSideBearing:O.minLeftSideBearing,minRightSideBearing:O.minRightSideBearing,xMaxExtent:O.maxLeftSideBearing+(O.xMax-O.xMin),numberOfHMetrics:t.glyphs.length}),j=Zc.make(t.glyphs.length),$=Ki.make(Object.assign({xAvgCharWidth:Math.round(O.advanceWidthAvg),usFirstCharIndex:f,usLastCharIndex:p,ulUnicodeRange1:g,ulUnicodeRange2:y,ulUnicodeRange3:m,ulUnicodeRange4:S,sTypoAscender:O.ascender,sTypoDescender:O.descender,sTypoLineGap:0,usWinAscent:O.yMax,usWinDescent:Math.abs(O.yMin),ulCodePageRange1:1,sxHeight:ta(t,"xyvw",{yMax:Math.round(O.ascender/2)}).yMax,sCapHeight:ta(t,"HIKLEFJMNTZBDPRAGOQSUVWXY",O).yMax,usDefaultChar:t.hasChar(" ")?32:0,usBreakChar:t.hasChar(" ")?32:0},t.tables.os2)),X=Vc.make(t.glyphs),te=sc.make(t.glyphs),ne=t.getEnglishName("fontFamily"),K=t.getEnglishName("fontSubfamily"),Le=ne+" "+K,Re=t.getEnglishName("postScriptName");Re||(Re=ne.replace(/\s/g,"")+"-"+K);var oe={};for(var ye in t.names)oe[ye]=t.names[ye];oe.uniqueID||(oe.uniqueID={en:t.getEnglishName("manufacturer")+":"+Le}),oe.postScriptName||(oe.postScriptName={en:Re}),oe.preferredFamily||(oe.preferredFamily=t.names.fontFamily),oe.preferredSubfamily||(oe.preferredSubfamily=t.names.fontSubfamily);var Te=[],he=of.make(oe,Te),se=Te.length>0?$c.make(Te):void 0,de=ff.make(),we=Uc.make(t.glyphs,{version:t.getEnglishName("version"),fullName:Le,familyName:ne,weightName:K,postScriptName:Re,unitsPerEm:t.unitsPerEm,fontBBox:[0,O.yMin,O.ascender,O.advanceWidthMax]}),pe=t.metas&&Object.keys(t.metas).length>0?mf.make(t.metas):void 0,Me=[V,L,j,$,he,te,de,we,X];se&&Me.push(se),t.tables.gsub&&Me.push(df.make(t.tables.gsub)),pe&&Me.push(pe);for(var Vr=ea(Me),ss=Vr.encode(),Wn=Ho(ss),Yr=Vr.fields,Vn=!1,bt=0;bt<Yr.length;bt+=1)if(Yr[bt].name==="head table"){Yr[bt].value.checkSumAdjustment=2981146554-Wn,Vn=!0;break}if(!Vn)throw new Error("Could not find head table with checkSum to adjust.");return Vr}var bf={make:ea,fontToTable:wf,computeCheckSum:Ho};function zo(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,s=t[o].tag;if(s===e)return o;s<e?r=o+1:n=o-1}return-r-1}function ra(t,e){for(var r=0,n=t.length-1;r<=n;){var o=r+n>>>1,s=t[o];if(s===e)return o;s<e?r=o+1:n=o-1}return-r-1}function na(t,e){for(var r,n=0,o=t.length-1;n<=o;){var s=n+o>>>1;r=t[s];var u=r.start;if(u===e)return r;u<e?n=s+1:o=s-1}if(n>0)return r=t[n-1],e>r.end?0:r}function Fr(t,e){this.font=t,this.tableName=e}Fr.prototype={searchTag:zo,binSearch:ra,getTable:function(t){var e=this.font.tables[this.tableName];return!e&&t&&(e=this.font.tables[this.tableName]=this.createDefaultTable()),e},getScriptNames:function(){var t=this.getTable();return t?t.scripts.map(function(e){return e.tag}):[]},getDefaultScriptName:function(){var t=this.getTable();if(t){for(var e=!1,r=0;r<t.scripts.length;r++){var n=t.scripts[r].tag;if(n==="DFLT")return n;n==="latn"&&(e=!0)}if(e)return"latn"}},getScriptTable:function(t,e){var r=this.getTable(e);if(r){t=t||"DFLT";var n=r.scripts,o=zo(r.scripts,t);if(o>=0)return n[o].script;if(e){var s={tag:t,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-o,0,s),s.script}}},getLangSysTable:function(t,e,r){var n=this.getScriptTable(t,r);if(n){if(!e||e==="dflt"||e==="DFLT")return n.defaultLangSys;var o=zo(n.langSysRecords,e);if(o>=0)return n.langSysRecords[o].langSys;if(r){var s={tag:e,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-o,0,s),s.langSys}}},getFeatureTable:function(t,e,r,n){var o=this.getLangSysTable(t,e,n);if(o){for(var s,u=o.featureIndexes,c=this.font.tables[this.tableName].features,f=0;f<u.length;f++)if(s=c[u[f]],s.tag===r)return s.feature;if(n){var p=c.length;return Z.assert(p===0||r>=c[p-1].tag,"Features must be added in alphabetical order."),s={tag:r,feature:{params:0,lookupListIndexes:[]}},c.push(s),u.push(p),s.feature}}},getLookupTables:function(t,e,r,n,o){var s=this.getFeatureTable(t,e,r,o),u=[];if(s){for(var c,f=s.lookupListIndexes,p=this.font.tables[this.tableName].lookups,g=0;g<f.length;g++)c=p[f[g]],c.lookupType===n&&u.push(c);if(u.length===0&&o){c={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var y=p.length;return p.push(c),f.push(y),[c]}}return u},getGlyphClass:function(t,e){switch(t.format){case 1:return t.startGlyph<=e&&e<t.startGlyph+t.classes.length?t.classes[e-t.startGlyph]:0;case 2:var r=na(t.ranges,e);return r?r.classId:0}},getCoverageIndex:function(t,e){switch(t.format){case 1:var r=ra(t.glyphs,e);return r>=0?r:-1;case 2:var n=na(t.ranges,e);return n?n.index+e-n.start:-1}},expandCoverage:function(t){if(t.format===1)return t.glyphs;for(var e=[],r=t.ranges,n=0;n<r.length;n++)for(var o=r[n],s=o.start,u=o.end,c=s;c<=u;c++)e.push(c);return e}};function Lr(t){Fr.call(this,t,"gpos")}Lr.prototype=Fr.prototype,Lr.prototype.init=function(){var t=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(t)},Lr.prototype.getKerningValue=function(t,e,r){for(var n=0;n<t.length;n++)for(var o=t[n].subtables,s=0;s<o.length;s++){var u=o[s],c=this.getCoverageIndex(u.coverage,e);if(!(c<0))switch(u.posFormat){case 1:for(var f=u.pairSets[c],p=0;p<f.length;p++){var g=f[p];if(g.secondGlyph===r)return g.value1&&g.value1.xAdvance||0}break;case 2:var y=this.getGlyphClass(u.classDef1,e),m=this.getGlyphClass(u.classDef2,r),S=u.classRecords[y][m];return S.value1&&S.value1.xAdvance||0}}return 0},Lr.prototype.getKerningTables=function(t,e){if(this.font.tables.gpos)return this.getLookupTables(t,e,"kern",2)};function Ke(t){Fr.call(this,t,"gsub")}function Sf(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Wo(t,e,r){for(var n=t.subtables,o=0;o<n.length;o++){var s=n[o];if(s.substFormat===e)return s}if(r)return n.push(r),r}Ke.prototype=Fr.prototype,Ke.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Ke.prototype.getSingle=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,1),s=0;s<o.length;s++)for(var u=o[s].subtables,c=0;c<u.length;c++){var f=u[c],p=this.expandCoverage(f.coverage),g=void 0;if(f.substFormat===1){var y=f.deltaGlyphId;for(g=0;g<p.length;g++){var m=p[g];n.push({sub:m,by:m+y})}}else{var S=f.substitute;for(g=0;g<p.length;g++)n.push({sub:p[g],by:S[g]})}}return n},Ke.prototype.getMultiple=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,2),s=0;s<o.length;s++)for(var u=o[s].subtables,c=0;c<u.length;c++){var f=u[c],p=this.expandCoverage(f.coverage),g=void 0;for(g=0;g<p.length;g++){var y=p[g],m=f.sequences[g];n.push({sub:y,by:m})}}return n},Ke.prototype.getAlternates=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,3),s=0;s<o.length;s++)for(var u=o[s].subtables,c=0;c<u.length;c++)for(var f=u[c],p=this.expandCoverage(f.coverage),g=f.alternateSets,y=0;y<p.length;y++)n.push({sub:p[y],by:g[y]});return n},Ke.prototype.getLigatures=function(t,e,r){for(var n=[],o=this.getLookupTables(e,r,t,4),s=0;s<o.length;s++)for(var u=o[s].subtables,c=0;c<u.length;c++)for(var f=u[c],p=this.expandCoverage(f.coverage),g=f.ligatureSets,y=0;y<p.length;y++)for(var m=p[y],S=g[y],E=0;E<S.length;E++){var k=S[E];n.push({sub:[m].concat(k.components),by:k.ligGlyph})}return n},Ke.prototype.addSingle=function(t,e,r,n){var o=this.getLookupTables(r,n,t,1,!0)[0],s=Wo(o,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});Z.assert(s.coverage.format===1,"Single: unable to modify coverage table format "+s.coverage.format);var u=e.sub,c=this.binSearch(s.coverage.glyphs,u);c<0&&(c=-1-c,s.coverage.glyphs.splice(c,0,u),s.substitute.splice(c,0,0)),s.substitute[c]=e.by},Ke.prototype.addMultiple=function(t,e,r,n){Z.assert(e.by instanceof Array&&e.by.length>1,'Multiple: "by" must be an array of two or more ids');var o=this.getLookupTables(r,n,t,2,!0)[0],s=Wo(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});Z.assert(s.coverage.format===1,"Multiple: unable to modify coverage table format "+s.coverage.format);var u=e.sub,c=this.binSearch(s.coverage.glyphs,u);c<0&&(c=-1-c,s.coverage.glyphs.splice(c,0,u),s.sequences.splice(c,0,0)),s.sequences[c]=e.by},Ke.prototype.addAlternate=function(t,e,r,n){var o=this.getLookupTables(r,n,t,3,!0)[0],s=Wo(o,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});Z.assert(s.coverage.format===1,"Alternate: unable to modify coverage table format "+s.coverage.format);var u=e.sub,c=this.binSearch(s.coverage.glyphs,u);c<0&&(c=-1-c,s.coverage.glyphs.splice(c,0,u),s.alternateSets.splice(c,0,0)),s.alternateSets[c]=e.by},Ke.prototype.addLigature=function(t,e,r,n){var o=this.getLookupTables(r,n,t,4,!0)[0],s=o.subtables[0];s||(s={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},o.subtables[0]=s),Z.assert(s.coverage.format===1,"Ligature: unable to modify coverage table format "+s.coverage.format);var u=e.sub[0],c=e.sub.slice(1),f={ligGlyph:e.by,components:c},p=this.binSearch(s.coverage.glyphs,u);if(p>=0){for(var g=s.ligatureSets[p],y=0;y<g.length;y++)if(Sf(g[y].components,c))return;g.push(f)}else p=-1-p,s.coverage.glyphs.splice(p,0,u),s.ligatureSets.splice(p,0,[f])},Ke.prototype.getFeature=function(t,e,r){if(/ss\d\d/.test(t))return this.getSingle(t,e,r);switch(t){case"aalt":case"salt":return this.getSingle(t,e,r).concat(this.getAlternates(t,e,r));case"dlig":case"liga":case"rlig":return this.getLigatures(t,e,r);case"ccmp":return this.getMultiple(t,e,r).concat(this.getLigatures(t,e,r));case"stch":return this.getMultiple(t,e,r)}},Ke.prototype.add=function(t,e,r,n){if(/ss\d\d/.test(t))return this.addSingle(t,e,r,n);switch(t){case"aalt":case"salt":return typeof e.by=="number"?this.addSingle(t,e,r,n):this.addAlternate(t,e,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(t,e,r,n);case"ccmp":return e.by instanceof Array?this.addMultiple(t,e,r,n):this.addLigature(t,e,r,n)}};function _f(){return typeof window<"u"}function Ef(t){for(var e=new Buffer(t.byteLength),r=new Uint8Array(t),n=0;n<e.length;++n)e[n]=r[n];return e}function Ir(t,e){if(!t)throw e}function oa(t,e,r,n,o){var s;return(e&n)>0?(s=t.parseByte(),e&o||(s=-s),s=r+s):(e&o)>0?s=r:s=r+t.parseShort(),s}function sa(t,e,r){var n=new Q.Parser(e,r);t.numberOfContours=n.parseShort(),t._xMin=n.parseShort(),t._yMin=n.parseShort(),t._xMax=n.parseShort(),t._yMax=n.parseShort();var o,s;if(t.numberOfContours>0){for(var u=t.endPointIndices=[],c=0;c<t.numberOfContours;c+=1)u.push(n.parseUShort());t.instructionLength=n.parseUShort(),t.instructions=[];for(var f=0;f<t.instructionLength;f+=1)t.instructions.push(n.parseByte());var p=u[u.length-1]+1;o=[];for(var g=0;g<p;g+=1)if(s=n.parseByte(),o.push(s),(s&8)>0)for(var y=n.parseByte(),m=0;m<y;m+=1)o.push(s),g+=1;if(Z.argument(o.length===p,"Bad flags."),u.length>0){var S=[],E;if(p>0){for(var k=0;k<p;k+=1)s=o[k],E={},E.onCurve=!!(s&1),E.lastPointOfContour=u.indexOf(k)>=0,S.push(E);for(var x=0,A=0;A<p;A+=1)s=o[A],E=S[A],E.x=oa(n,s,x,2,16),x=E.x;for(var U=0,O=0;O<p;O+=1)s=o[O],E=S[O],E.y=oa(n,s,U,4,32),U=E.y}t.points=S}else t.points=[]}else if(t.numberOfContours===0)t.points=[];else{t.isComposite=!0,t.points=[],t.components=[];for(var V=!0;V;){o=n.parseUShort();var L={glyphIndex:n.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(o&1)>0?(o&2)>0?(L.dx=n.parseShort(),L.dy=n.parseShort()):L.matchedPoints=[n.parseUShort(),n.parseUShort()]:(o&2)>0?(L.dx=n.parseChar(),L.dy=n.parseChar()):L.matchedPoints=[n.parseByte(),n.parseByte()],(o&8)>0?L.xScale=L.yScale=n.parseF2Dot14():(o&64)>0?(L.xScale=n.parseF2Dot14(),L.yScale=n.parseF2Dot14()):(o&128)>0&&(L.xScale=n.parseF2Dot14(),L.scale01=n.parseF2Dot14(),L.scale10=n.parseF2Dot14(),L.yScale=n.parseF2Dot14()),t.components.push(L),V=!!(o&32)}if(o&256){t.instructionLength=n.parseUShort(),t.instructions=[];for(var j=0;j<t.instructionLength;j+=1)t.instructions.push(n.parseByte())}}}function Vo(t,e){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],s={x:e.xScale*o.x+e.scale01*o.y+e.dx,y:e.scale10*o.x+e.yScale*o.y+e.dy,onCurve:o.onCurve,lastPointOfContour:o.lastPointOfContour};r.push(s)}return r}function Tf(t){for(var e=[],r=[],n=0;n<t.length;n+=1){var o=t[n];r.push(o),o.lastPointOfContour&&(e.push(r),r=[])}return Z.argument(r.length===0,"There are still points left in the current contour."),e}function ia(t){var e=new Be;if(!t)return e;for(var r=Tf(t),n=0;n<r.length;++n){var o=r[n],s=null,u=o[o.length-1],c=o[0];if(u.onCurve)e.moveTo(u.x,u.y);else if(c.onCurve)e.moveTo(c.x,c.y);else{var f={x:(u.x+c.x)*.5,y:(u.y+c.y)*.5};e.moveTo(f.x,f.y)}for(var p=0;p<o.length;++p)if(s=u,u=c,c=o[(p+1)%o.length],u.onCurve)e.lineTo(u.x,u.y);else{var g=c;s.onCurve||((u.x+s.x)*.5,(u.y+s.y)*.5),c.onCurve||(g={x:(u.x+c.x)*.5,y:(u.y+c.y)*.5}),e.quadraticCurveTo(u.x,u.y,g.x,g.y)}e.closePath()}return e}function aa(t,e){if(e.isComposite)for(var r=0;r<e.components.length;r+=1){var n=e.components[r],o=t.get(n.glyphIndex);if(o.getPath(),o.points){var s=void 0;if(n.matchedPoints===void 0)s=Vo(o.points,n);else{if(n.matchedPoints[0]>e.points.length-1||n.matchedPoints[1]>o.points.length-1)throw Error("Matched points out of range in "+e.name);var u=e.points[n.matchedPoints[0]],c=o.points[n.matchedPoints[1]],f={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};c=Vo([c],f)[0],f.dx=u.x-c.x,f.dy=u.y-c.y,s=Vo(o.points,f)}e.points=e.points.concat(s)}}return ia(e.points)}function xf(t,e,r,n){for(var o=new ct.GlyphSet(n),s=0;s<r.length-1;s+=1){var u=r[s],c=r[s+1];u!==c?o.push(s,ct.ttfGlyphLoader(n,s,sa,t,e+u,aa)):o.push(s,ct.glyphLoader(n,s))}return o}function kf(t,e,r,n){var o=new ct.GlyphSet(n);return n._push=function(s){var u=r[s],c=r[s+1];u!==c?o.push(s,ct.ttfGlyphLoader(n,s,sa,t,e+u,aa)):o.push(s,ct.glyphLoader(n,s))},o}function Cf(t,e,r,n,o){return o.lowMemory?kf(t,e,r,n):xf(t,e,r,n)}var Pf={getPath:ia,parse:Cf},ua,Yt,la,Yo;function ca(t){this.font=t,this.getCommands=function(e){return Pf.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Af(t){return t}function fa(t){return Math.sign(t)*Math.round(Math.abs(t))}function Of(t){return Math.sign(t)*Math.round(Math.abs(t*2))/2}function Rf(t){return Math.sign(t)*(Math.round(Math.abs(t)+.5)-.5)}function Df(t){return Math.sign(t)*Math.ceil(Math.abs(t))}function Uf(t){return Math.sign(t)*Math.floor(Math.abs(t))}var ha=function(t){var e=this.srPeriod,r=this.srPhase,n=this.srThreshold,o=1;return t<0&&(t=-t,o=-1),t+=n-r,t=Math.trunc(t/e)*e,t+=r,t<0?r*o:t*o},ft={x:1,y:0,axis:"x",distance:function(t,e,r,n){return(r?t.xo:t.x)-(n?e.xo:e.x)},interpolate:function(t,e,r,n){var o,s,u,c,f,p,g;if(!n||n===this){if(o=t.xo-e.xo,s=t.xo-r.xo,f=e.x-e.xo,p=r.x-r.xo,u=Math.abs(o),c=Math.abs(s),g=u+c,g===0){t.x=t.xo+(f+p)/2;return}t.x=t.xo+(f*c+p*u)/g;return}if(o=n.distance(t,e,!0,!0),s=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),c=Math.abs(s),g=u+c,g===0){ft.setRelative(t,t,(f+p)/2,n,!0);return}ft.setRelative(t,t,(f*c+p*u)/g,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(t,e,r,n,o){if(!n||n===this){t.x=(o?e.xo:e.x)+r;return}var s=o?e.xo:e.x,u=o?e.yo:e.y,c=s+r*n.x,f=u+r*n.y;t.x=c+(t.y-f)/n.normalSlope},slope:0,touch:function(t){t.xTouched=!0},touched:function(t){return t.xTouched},untouch:function(t){t.xTouched=!1}},mt={x:0,y:1,axis:"y",distance:function(t,e,r,n){return(r?t.yo:t.y)-(n?e.yo:e.y)},interpolate:function(t,e,r,n){var o,s,u,c,f,p,g;if(!n||n===this){if(o=t.yo-e.yo,s=t.yo-r.yo,f=e.y-e.yo,p=r.y-r.yo,u=Math.abs(o),c=Math.abs(s),g=u+c,g===0){t.y=t.yo+(f+p)/2;return}t.y=t.yo+(f*c+p*u)/g;return}if(o=n.distance(t,e,!0,!0),s=n.distance(t,r,!0,!0),f=n.distance(e,e,!1,!0),p=n.distance(r,r,!1,!0),u=Math.abs(o),c=Math.abs(s),g=u+c,g===0){mt.setRelative(t,t,(f+p)/2,n,!0);return}mt.setRelative(t,t,(f*c+p*u)/g,n,!0)},normalSlope:0,setRelative:function(t,e,r,n,o){if(!n||n===this){t.y=(o?e.yo:e.y)+r;return}var s=o?e.xo:e.x,u=o?e.yo:e.y,c=s+r*n.x,f=u+r*n.y;t.y=f+n.normalSlope*(t.x-c)},slope:Number.POSITIVE_INFINITY,touch:function(t){t.yTouched=!0},touched:function(t){return t.yTouched},untouch:function(t){t.yTouched=!1}};Object.freeze(ft),Object.freeze(mt);function Gr(t,e){this.x=t,this.y=e,this.axis=void 0,this.slope=e/t,this.normalSlope=-t/e,Object.freeze(this)}Gr.prototype.distance=function(t,e,r,n){return this.x*ft.distance(t,e,r,n)+this.y*mt.distance(t,e,r,n)},Gr.prototype.interpolate=function(t,e,r,n){var o,s,u,c,f,p,g;if(u=n.distance(t,e,!0,!0),c=n.distance(t,r,!0,!0),o=n.distance(e,e,!1,!0),s=n.distance(r,r,!1,!0),f=Math.abs(u),p=Math.abs(c),g=f+p,g===0){this.setRelative(t,t,(o+s)/2,n,!0);return}this.setRelative(t,t,(o*p+s*f)/g,n,!0)},Gr.prototype.setRelative=function(t,e,r,n,o){n=n||this;var s=o?e.xo:e.x,u=o?e.yo:e.y,c=s+r*n.x,f=u+r*n.y,p=n.normalSlope,g=this.slope,y=t.x,m=t.y;t.x=(g*y-p*c+f-m)/(g-p),t.y=g*(t.x-y)+m},Gr.prototype.touch=function(t){t.xTouched=!0,t.yTouched=!0};function Nr(t,e){var r=Math.sqrt(t*t+e*e);return t/=r,e/=r,t===1&&e===0?ft:t===0&&e===1?mt:new Gr(t,e)}function yt(t,e,r,n){this.x=this.xo=Math.round(t*64)/64,this.y=this.yo=Math.round(e*64)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}yt.prototype.nextTouched=function(t){for(var e=this.nextPointOnContour;!t.touched(e)&&e!==this;)e=e.nextPointOnContour;return e},yt.prototype.prevTouched=function(t){for(var e=this.prevPointOnContour;!t.touched(e)&&e!==this;)e=e.prevPointOnContour;return e};var Hr=Object.freeze(new yt(0,0)),Bf={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Ut(t,e){switch(this.env=t,this.stack=[],this.prog=e,t){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=ft,this.round=fa}}ca.prototype.exec=function(t,e){if(typeof e!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==e){var o=this._fpgmState;if(!o){Ut.prototype=Bf,o=this._fpgmState=new Ut("fpgm",r.tables.fpgm),o.funcs=[],o.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),o.step=-1);try{Yt(o)}catch(p){console.log("Hinting error in FPGM:"+p),this._errorState=3;return}}Ut.prototype=o,n=this._prepState=new Ut("prep",r.tables.prep),n.ppem=e;var s=r.tables.cvt;if(s)for(var u=n.cvt=new Array(s.length),c=e/r.unitsPerEm,f=0;f<s.length;f++)u[f]=s[f]*c;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{Yt(n)}catch(p){this._errorState<2&&console.log("Hinting error in PREP:"+p),this._errorState=2}}if(!(this._errorState>1))try{return la(t,n)}catch(p){this._errorState<1&&(console.log("Hinting error:"+p),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}},la=function(t,e){var r=e.ppem/e.font.unitsPerEm,n=r,o=t.components,s,u,c;if(Ut.prototype=e,!o)c=new Ut("glyf",t.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),c.step=-1),Yo(t,c,r,n),u=c.gZone;else{var f=e.font;u=[],s=[];for(var p=0;p<o.length;p++){var g=o[p],y=f.glyphs.get(g.glyphIndex);c=new Ut("glyf",y.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+p+"---"),c.step=-1),Yo(y,c,r,n);for(var m=Math.round(g.dx*r),S=Math.round(g.dy*n),E=c.gZone,k=c.contours,x=0;x<E.length;x++){var A=E[x];A.xTouched=A.yTouched=!1,A.xo=A.x=A.x+m,A.yo=A.y=A.y+S}var U=u.length;u.push.apply(u,E);for(var O=0;O<k.length;O++)s.push(k[O]+U)}t.instructions&&!c.inhibitGridFit&&(c=new Ut("glyf",t.instructions),c.gZone=c.z0=c.z1=c.z2=u,c.contours=s,u.push(new yt(0,0),new yt(Math.round(t.advanceWidth*r),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),c.step=-1),Yt(c),u.length-=2)}return u},Yo=function(t,e,r,n){for(var o=t.points||[],s=o.length,u=e.gZone=e.z0=e.z1=e.z2=[],c=e.contours=[],f,p=0;p<s;p++)f=o[p],u[p]=new yt(f.x*r,f.y*n,f.lastPointOfContour,f.onCurve);for(var g,y,m=0;m<s;m++)f=u[m],g||(g=f,c.push(m)),f.lastPointOfContour?(f.nextPointOnContour=g,g.prevPointOnContour=f,g=void 0):(y=u[m+1],f.nextPointOnContour=y,y.prevPointOnContour=f);if(!e.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",e.stack);for(var S=0;S<s;S++)console.log(S,u[S].x,u[S].y)}if(u.push(new yt(0,0),new yt(Math.round(t.advanceWidth*r),0)),Yt(e),u.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",e.stack);for(var E=0;E<s;E++)console.log(E,u[E].x,u[E].y)}}},Yt=function(t){var e=t.prog;if(e){var r=e.length,n;for(t.ip=0;t.ip<r;t.ip++){if(exports.DEBUG&&t.step++,n=ua[e[t.ip]],!n)throw new Error("unknown instruction: 0x"+Number(e[t.ip]).toString(16));n(t)}}};function On(t){for(var e=t.tZone=new Array(t.gZone.length),r=0;r<e.length;r++)e[r]=new yt(0,0)}function pa(t,e){var r=t.prog,n=t.ip,o=1,s;do if(s=r[++n],s===88)o++;else if(s===89)o--;else if(s===64)n+=r[n+1]+1;else if(s===65)n+=2*r[n+1]+1;else if(s>=176&&s<=183)n+=s-176+1;else if(s>=184&&s<=191)n+=(s-184+1)*2;else if(e&&o===1&&s===27)break;while(o>0);t.ip=n}function da(t,e){exports.DEBUG&&console.log(e.step,"SVTCA["+t.axis+"]"),e.fv=e.pv=e.dpv=t}function va(t,e){exports.DEBUG&&console.log(e.step,"SPVTCA["+t.axis+"]"),e.pv=e.dpv=t}function ga(t,e){exports.DEBUG&&console.log(e.step,"SFVTCA["+t.axis+"]"),e.fv=t}function ma(t,e){var r=e.stack,n=r.pop(),o=r.pop(),s=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log("SPVTL["+t+"]",n,o);var c,f;t?(c=s.y-u.y,f=u.x-s.x):(c=u.x-s.x,f=u.y-s.y),e.pv=e.dpv=Nr(c,f)}function ya(t,e){var r=e.stack,n=r.pop(),o=r.pop(),s=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log("SFVTL["+t+"]",n,o);var c,f;t?(c=s.y-u.y,f=u.x-s.x):(c=u.x-s.x,f=u.y-s.y),e.fv=Nr(c,f)}function Mf(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.pv=t.dpv=Nr(n,r)}function Ff(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SPVFS[]",r,n),t.fv=Nr(n,r)}function Lf(t){var e=t.stack,r=t.pv;exports.DEBUG&&console.log(t.step,"GPV[]"),e.push(r.x*16384),e.push(r.y*16384)}function If(t){var e=t.stack,r=t.fv;exports.DEBUG&&console.log(t.step,"GFV[]"),e.push(r.x*16384),e.push(r.y*16384)}function Gf(t){t.fv=t.pv,exports.DEBUG&&console.log(t.step,"SFVTPV[]")}function Nf(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop(),s=e.pop(),u=e.pop(),c=t.z0,f=t.z1,p=c[r],g=c[n],y=f[o],m=f[s],S=t.z2[u];exports.DEBUG&&console.log("ISECT[], ",r,n,o,s,u);var E=p.x,k=p.y,x=g.x,A=g.y,U=y.x,O=y.y,V=m.x,L=m.y,j=(E-x)*(O-L)-(k-A)*(U-V),$=E*A-k*x,X=U*L-O*V;S.x=($*(U-V)-X*(E-x))/j,S.y=($*(O-L)-X*(k-A))/j}function Hf(t){t.rp0=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP0[]",t.rp0)}function zf(t){t.rp1=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP1[]",t.rp1)}function Wf(t){t.rp2=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SRP2[]",t.rp2)}function Vf(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP0[]",e),t.zp0=e,e){case 0:t.tZone||On(t),t.z0=t.tZone;break;case 1:t.z0=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Yf(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP1[]",e),t.zp1=e,e){case 0:t.tZone||On(t),t.z1=t.tZone;break;case 1:t.z1=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function Xf(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZP2[]",e),t.zp2=e,e){case 0:t.tZone||On(t),t.z2=t.tZone;break;case 1:t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function $f(t){var e=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"SZPS[]",e),t.zp0=t.zp1=t.zp2=e,e){case 0:t.tZone||On(t),t.z0=t.z1=t.z2=t.tZone;break;case 1:t.z0=t.z1=t.z2=t.gZone;break;default:throw new Error("Invalid zone pointer")}}function qf(t){t.loop=t.stack.pop(),exports.DEBUG&&console.log(t.step,"SLOOP[]",t.loop)}function jf(t){exports.DEBUG&&console.log(t.step,"RTG[]"),t.round=fa}function Zf(t){exports.DEBUG&&console.log(t.step,"RTHG[]"),t.round=Rf}function Kf(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SMD[]",e),t.minDis=e/64}function Qf(t){exports.DEBUG&&console.log(t.step,"ELSE[]"),pa(t,!1)}function Jf(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"JMPR[]",e),t.ip+=e-1}function eh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCVTCI[]",e),t.cvCutIn=e/64}function th(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DUP[]"),e.push(e[e.length-1])}function Xo(t){exports.DEBUG&&console.log(t.step,"POP[]"),t.stack.pop()}function rh(t){exports.DEBUG&&console.log(t.step,"CLEAR[]"),t.stack.length=0}function nh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SWAP[]"),e.push(r),e.push(n)}function oh(t){var e=t.stack;exports.DEBUG&&console.log(t.step,"DEPTH[]"),e.push(e.length)}function sh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LOOPCALL[]",r,n);var o=t.ip,s=t.prog;t.prog=t.funcs[r];for(var u=0;u<n;u++)Yt(t),exports.DEBUG&&console.log(++t.step,u+1<n?"next loopcall":"done loopcall",u);t.ip=o,t.prog=s}function ih(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"CALL[]",e);var r=t.ip,n=t.prog;t.prog=t.funcs[e],Yt(t),t.ip=r,t.prog=n,exports.DEBUG&&console.log(++t.step,"returning from",e)}function ah(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CINDEX[]",r),e.push(e[e.length-r])}function uh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"MINDEX[]",r),e.push(e.splice(e.length-r,1)[0])}function lh(t){if(t.env!=="fpgm")throw new Error("FDEF not allowed here");var e=t.stack,r=t.prog,n=t.ip,o=e.pop(),s=n;for(exports.DEBUG&&console.log(t.step,"FDEF[]",o);r[++n]!==45;);t.ip=n,t.funcs[o]=r.slice(s+1,n)}function wa(t,e){var r=e.stack.pop(),n=e.z0[r],o=e.fv,s=e.pv;exports.DEBUG&&console.log(e.step,"MDAP["+t+"]",r);var u=s.distance(n,Hr);t&&(u=e.round(u)),o.setRelative(n,Hr,u,s),o.touch(n),e.rp0=e.rp1=r}function ba(t,e){var r=e.z2,n=r.length-2,o,s,u;exports.DEBUG&&console.log(e.step,"IUP["+t.axis+"]");for(var c=0;c<n;c++)o=r[c],!t.touched(o)&&(s=o.prevTouched(t),s!==o&&(u=o.nextTouched(t),s===u&&t.setRelative(o,o,t.distance(s,s,!1,!0),t,!0),t.interpolate(o,s,u,t)))}function Sa(t,e){for(var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],s=e.fv,u=e.pv,c=e.loop,f=e.z2;c--;){var p=r.pop(),g=f[p],y=u.distance(o,o,!1,!0);s.setRelative(g,g,y,u),s.touch(g),exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-c)+": ":"")+"SHP["+(t?"rp1":"rp2")+"]",p)}e.loop=1}function _a(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],s=e.fv,u=e.pv,c=r.pop(),f=e.z2[e.contours[c]],p=f;exports.DEBUG&&console.log(e.step,"SHC["+t+"]",c);var g=u.distance(o,o,!1,!0);do p!==o&&s.setRelative(p,p,g,u),p=p.nextPointOnContour;while(p!==f)}function Ea(t,e){var r=e.stack,n=t?e.rp1:e.rp2,o=(t?e.z0:e.z1)[n],s=e.fv,u=e.pv,c=r.pop();exports.DEBUG&&console.log(e.step,"SHZ["+t+"]",c);var f;switch(c){case 0:f=e.tZone;break;case 1:f=e.gZone;break;default:throw new Error("Invalid zone")}for(var p,g=u.distance(o,o,!1,!0),y=f.length-2,m=0;m<y;m++)p=f[m],s.setRelative(p,p,g,u)}function ch(t){for(var e=t.stack,r=t.loop,n=t.fv,o=e.pop()/64,s=t.z2;r--;){var u=e.pop(),c=s[u];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-r)+": ":"")+"SHPIX[]",u,o),n.setRelative(c,c,o),n.touch(c)}t.loop=1}function fh(t){for(var e=t.stack,r=t.rp1,n=t.rp2,o=t.loop,s=t.z0[r],u=t.z1[n],c=t.fv,f=t.dpv,p=t.z2;o--;){var g=e.pop(),y=p[g];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"IP[]",g,r,"<->",n),c.interpolate(y,s,u,f),c.touch(y)}t.loop=1}function Ta(t,e){var r=e.stack,n=r.pop()/64,o=r.pop(),s=e.z1[o],u=e.z0[e.rp0],c=e.fv,f=e.pv;c.setRelative(s,u,n,f),c.touch(s),exports.DEBUG&&console.log(e.step,"MSIRP["+t+"]",n,o),e.rp1=e.rp0,e.rp2=o,t&&(e.rp0=o)}function hh(t){for(var e=t.stack,r=t.rp0,n=t.z0[r],o=t.loop,s=t.fv,u=t.pv,c=t.z1;o--;){var f=e.pop(),p=c[f];exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"ALIGNRP[]",f),s.setRelative(p,n,0,u),s.touch(p)}t.loop=1}function ph(t){exports.DEBUG&&console.log(t.step,"RTDG[]"),t.round=Of}function xa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),s=e.z0[o],u=e.fv,c=e.pv,f=e.cvt[n];exports.DEBUG&&console.log(e.step,"MIAP["+t+"]",n,"(",f,")",o);var p=c.distance(s,Hr);t&&(Math.abs(p-f)<e.cvCutIn&&(p=f),p=e.round(p)),u.setRelative(s,Hr,p,c),e.zp0===0&&(s.xo=s.x,s.yo=s.y),u.touch(s),e.rp0=e.rp1=o}function dh(t){var e=t.prog,r=t.ip,n=t.stack,o=e[++r];exports.DEBUG&&console.log(t.step,"NPUSHB[]",o);for(var s=0;s<o;s++)n.push(e[++r]);t.ip=r}function vh(t){var e=t.ip,r=t.prog,n=t.stack,o=r[++e];exports.DEBUG&&console.log(t.step,"NPUSHW[]",o);for(var s=0;s<o;s++){var u=r[++e]<<8|r[++e];u&32768&&(u=-((u^65535)+1)),n.push(u)}t.ip=e}function gh(t){var e=t.stack,r=t.store;r||(r=t.store=[]);var n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"WS",n,o),r[o]=n}function mh(t){var e=t.stack,r=t.store,n=e.pop();exports.DEBUG&&console.log(t.step,"RS",n);var o=r&&r[n]||0;e.push(o)}function yh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTP",r,n),t.cvt[n]=r/64}function wh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"RCVT",r),e.push(t.cvt[r]*64)}function ka(t,e){var r=e.stack,n=r.pop(),o=e.z2[n];exports.DEBUG&&console.log(e.step,"GC["+t+"]",n),r.push(e.dpv.distance(o,Hr,t,!1)*64)}function Ca(t,e){var r=e.stack,n=r.pop(),o=r.pop(),s=e.z1[n],u=e.z0[o],c=e.dpv.distance(u,s,t,t);exports.DEBUG&&console.log(e.step,"MD["+t+"]",n,o,"->",c),e.stack.push(Math.round(c*64))}function bh(t){exports.DEBUG&&console.log(t.step,"MPPEM[]"),t.stack.push(t.ppem)}function Sh(t){exports.DEBUG&&console.log(t.step,"FLIPON[]"),t.autoFlip=!0}function _h(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LT[]",r,n),e.push(n<r?1:0)}function Eh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"LTEQ[]",r,n),e.push(n<=r?1:0)}function Th(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GT[]",r,n),e.push(n>r?1:0)}function xh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"GTEQ[]",r,n),e.push(n>=r?1:0)}function kh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"EQ[]",r,n),e.push(r===n?1:0)}function Ch(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"NEQ[]",r,n),e.push(r!==n?1:0)}function Ph(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ODD[]",r),e.push(Math.trunc(r)%2?1:0)}function Ah(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"EVEN[]",r),e.push(Math.trunc(r)%2?0:1)}function Oh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"IF[]",e),e||(pa(t,!0),exports.DEBUG&&console.log(t.step,"EIF[]"))}function Rh(t){exports.DEBUG&&console.log(t.step,"EIF[]")}function Dh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"AND[]",r,n),e.push(r&&n?1:0)}function Uh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"OR[]",r,n),e.push(r||n?1:0)}function Bh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NOT[]",r),e.push(r?0:1)}function $o(t,e){var r=e.stack,n=r.pop(),o=e.fv,s=e.pv,u=e.ppem,c=e.deltaBase+(t-1)*16,f=e.deltaShift,p=e.z0;exports.DEBUG&&console.log(e.step,"DELTAP["+t+"]",n,r);for(var g=0;g<n;g++){var y=r.pop(),m=r.pop(),S=c+((m&240)>>4);if(S===u){var E=(m&15)-8;E>=0&&E++,exports.DEBUG&&console.log(e.step,"DELTAPFIX",y,"by",E*f);var k=p[y];o.setRelative(k,k,E*f,s)}}}function Mh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDB[]",r),t.deltaBase=r}function Fh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"SDS[]",r),t.deltaShift=Math.pow(.5,r)}function Lh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"ADD[]",r,n),e.push(n+r)}function Ih(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"SUB[]",r,n),e.push(n-r)}function Gh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"DIV[]",r,n),e.push(n*64/r)}function Nh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MUL[]",r,n),e.push(n*r/64)}function Hh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"ABS[]",r),e.push(Math.abs(r))}function zh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"NEG[]",r),e.push(-r)}function Wh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"FLOOR[]",r),e.push(Math.floor(r/64)*64)}function Vh(t){var e=t.stack,r=e.pop();exports.DEBUG&&console.log(t.step,"CEILING[]",r),e.push(Math.ceil(r/64)*64)}function Rn(t,e){var r=e.stack,n=r.pop();exports.DEBUG&&console.log(e.step,"ROUND[]"),r.push(e.round(n/64)*64)}function Yh(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"WCVTF[]",r,n),t.cvt[n]=r*t.ppem/t.font.unitsPerEm}function qo(t,e){var r=e.stack,n=r.pop(),o=e.ppem,s=e.deltaBase+(t-1)*16,u=e.deltaShift;exports.DEBUG&&console.log(e.step,"DELTAC["+t+"]",n,r);for(var c=0;c<n;c++){var f=r.pop(),p=r.pop(),g=s+((p&240)>>4);if(g===o){var y=(p&15)-8;y>=0&&y++;var m=y*u;exports.DEBUG&&console.log(e.step,"DELTACFIX",f,"by",m),e.cvt[f]+=m}}}function Xh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SROUND[]",e),t.round=ha;var r;switch(e&192){case 0:r=.5;break;case 64:r=1;break;case 128:r=2;break;default:throw new Error("invalid SROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid SROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function $h(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"S45ROUND[]",e),t.round=ha;var r;switch(e&192){case 0:r=Math.sqrt(2)/2;break;case 64:r=Math.sqrt(2);break;case 128:r=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(t.srPeriod=r,e&48){case 0:t.srPhase=0;break;case 16:t.srPhase=.25*r;break;case 32:t.srPhase=.5*r;break;case 48:t.srPhase=.75*r;break;default:throw new Error("invalid S45ROUND value")}e&=15,e===0?t.srThreshold=0:t.srThreshold=(e/8-.5)*r}function qh(t){exports.DEBUG&&console.log(t.step,"ROFF[]"),t.round=Af}function jh(t){exports.DEBUG&&console.log(t.step,"RUTG[]"),t.round=Df}function Zh(t){exports.DEBUG&&console.log(t.step,"RDTG[]"),t.round=Uf}function Kh(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANCTRL[]",e)}function Pa(t,e){var r=e.stack,n=r.pop(),o=r.pop(),s=e.z2[n],u=e.z1[o];exports.DEBUG&&console.log(e.step,"SDPVTL["+t+"]",n,o);var c,f;t?(c=s.y-u.y,f=u.x-s.x):(c=u.x-s.x,f=u.y-s.y),e.dpv=Nr(c,f)}function Qh(t){var e=t.stack,r=e.pop(),n=0;exports.DEBUG&&console.log(t.step,"GETINFO[]",r),r&1&&(n=35),r&32&&(n|=4096),e.push(n)}function Jh(t){var e=t.stack,r=e.pop(),n=e.pop(),o=e.pop();exports.DEBUG&&console.log(t.step,"ROLL[]"),e.push(n),e.push(r),e.push(o)}function ep(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MAX[]",r,n),e.push(Math.max(n,r))}function tp(t){var e=t.stack,r=e.pop(),n=e.pop();exports.DEBUG&&console.log(t.step,"MIN[]",r,n),e.push(Math.min(n,r))}function rp(t){var e=t.stack.pop();exports.DEBUG&&console.log(t.step,"SCANTYPE[]",e)}function np(t){var e=t.stack.pop(),r=t.stack.pop();switch(exports.DEBUG&&console.log(t.step,"INSTCTRL[]",e,r),e){case 1:t.inhibitGridFit=!!r;return;case 2:t.ignoreCvt=!!r;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Bt(t,e){var r=e.stack,n=e.prog,o=e.ip;exports.DEBUG&&console.log(e.step,"PUSHB["+t+"]");for(var s=0;s<t;s++)r.push(n[++o]);e.ip=o}function Mt(t,e){var r=e.ip,n=e.prog,o=e.stack;exports.DEBUG&&console.log(e.ip,"PUSHW["+t+"]");for(var s=0;s<t;s++){var u=n[++r]<<8|n[++r];u&32768&&(u=-((u^65535)+1)),o.push(u)}e.ip=r}function H(t,e,r,n,o,s){var u=s.stack,c=t&&u.pop(),f=u.pop(),p=s.rp0,g=s.z0[p],y=s.z1[f],m=s.minDis,S=s.fv,E=s.dpv,k,x,A,U;x=k=E.distance(y,g,!0,!0),A=x>=0?1:-1,x=Math.abs(x),t&&(U=s.cvt[c],n&&Math.abs(x-U)<s.cvCutIn&&(x=U)),r&&x<m&&(x=m),n&&(x=s.round(x)),S.setRelative(y,g,A*x,E),S.touch(y),exports.DEBUG&&console.log(s.step,(t?"MIRP[":"MDRP[")+(e?"M":"m")+(r?">":"_")+(n?"R":"_")+(o===0?"Gr":o===1?"Bl":o===2?"Wh":"")+"]",t?c+"("+s.cvt[c]+","+U+")":"",f,"(d =",k,"->",A*x,")"),s.rp1=s.rp0,s.rp2=f,e&&(s.rp0=f)}ua=[da.bind(void 0,mt),da.bind(void 0,ft),va.bind(void 0,mt),va.bind(void 0,ft),ga.bind(void 0,mt),ga.bind(void 0,ft),ma.bind(void 0,0),ma.bind(void 0,1),ya.bind(void 0,0),ya.bind(void 0,1),Mf,Ff,Lf,If,Gf,Nf,Hf,zf,Wf,Vf,Yf,Xf,$f,qf,jf,Zf,Kf,Qf,Jf,eh,void 0,void 0,th,Xo,rh,nh,oh,ah,uh,void 0,void 0,void 0,sh,ih,lh,void 0,wa.bind(void 0,0),wa.bind(void 0,1),ba.bind(void 0,mt),ba.bind(void 0,ft),Sa.bind(void 0,0),Sa.bind(void 0,1),_a.bind(void 0,0),_a.bind(void 0,1),Ea.bind(void 0,0),Ea.bind(void 0,1),ch,fh,Ta.bind(void 0,0),Ta.bind(void 0,1),hh,ph,xa.bind(void 0,0),xa.bind(void 0,1),dh,vh,gh,mh,yh,wh,ka.bind(void 0,0),ka.bind(void 0,1),void 0,Ca.bind(void 0,0),Ca.bind(void 0,1),bh,void 0,Sh,void 0,void 0,_h,Eh,Th,xh,kh,Ch,Ph,Ah,Oh,Rh,Dh,Uh,Bh,$o.bind(void 0,1),Mh,Fh,Lh,Ih,Gh,Nh,Hh,zh,Wh,Vh,Rn.bind(void 0,0),Rn.bind(void 0,1),Rn.bind(void 0,2),Rn.bind(void 0,3),void 0,void 0,void 0,void 0,Yh,$o.bind(void 0,2),$o.bind(void 0,3),qo.bind(void 0,1),qo.bind(void 0,2),qo.bind(void 0,3),Xh,$h,void 0,void 0,qh,void 0,jh,Zh,Xo,Xo,void 0,void 0,void 0,void 0,void 0,Kh,Pa.bind(void 0,0),Pa.bind(void 0,1),Qh,void 0,Jh,ep,tp,rp,np,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Bt.bind(void 0,1),Bt.bind(void 0,2),Bt.bind(void 0,3),Bt.bind(void 0,4),Bt.bind(void 0,5),Bt.bind(void 0,6),Bt.bind(void 0,7),Bt.bind(void 0,8),Mt.bind(void 0,1),Mt.bind(void 0,2),Mt.bind(void 0,3),Mt.bind(void 0,4),Mt.bind(void 0,5),Mt.bind(void 0,6),Mt.bind(void 0,7),Mt.bind(void 0,8),H.bind(void 0,0,0,0,0,0),H.bind(void 0,0,0,0,0,1),H.bind(void 0,0,0,0,0,2),H.bind(void 0,0,0,0,0,3),H.bind(void 0,0,0,0,1,0),H.bind(void 0,0,0,0,1,1),H.bind(void 0,0,0,0,1,2),H.bind(void 0,0,0,0,1,3),H.bind(void 0,0,0,1,0,0),H.bind(void 0,0,0,1,0,1),H.bind(void 0,0,0,1,0,2),H.bind(void 0,0,0,1,0,3),H.bind(void 0,0,0,1,1,0),H.bind(void 0,0,0,1,1,1),H.bind(void 0,0,0,1,1,2),H.bind(void 0,0,0,1,1,3),H.bind(void 0,0,1,0,0,0),H.bind(void 0,0,1,0,0,1),H.bind(void 0,0,1,0,0,2),H.bind(void 0,0,1,0,0,3),H.bind(void 0,0,1,0,1,0),H.bind(void 0,0,1,0,1,1),H.bind(void 0,0,1,0,1,2),H.bind(void 0,0,1,0,1,3),H.bind(void 0,0,1,1,0,0),H.bind(void 0,0,1,1,0,1),H.bind(void 0,0,1,1,0,2),H.bind(void 0,0,1,1,0,3),H.bind(void 0,0,1,1,1,0),H.bind(void 0,0,1,1,1,1),H.bind(void 0,0,1,1,1,2),H.bind(void 0,0,1,1,1,3),H.bind(void 0,1,0,0,0,0),H.bind(void 0,1,0,0,0,1),H.bind(void 0,1,0,0,0,2),H.bind(void 0,1,0,0,0,3),H.bind(void 0,1,0,0,1,0),H.bind(void 0,1,0,0,1,1),H.bind(void 0,1,0,0,1,2),H.bind(void 0,1,0,0,1,3),H.bind(void 0,1,0,1,0,0),H.bind(void 0,1,0,1,0,1),H.bind(void 0,1,0,1,0,2),H.bind(void 0,1,0,1,0,3),H.bind(void 0,1,0,1,1,0),H.bind(void 0,1,0,1,1,1),H.bind(void 0,1,0,1,1,2),H.bind(void 0,1,0,1,1,3),H.bind(void 0,1,1,0,0,0),H.bind(void 0,1,1,0,0,1),H.bind(void 0,1,1,0,0,2),H.bind(void 0,1,1,0,0,3),H.bind(void 0,1,1,0,1,0),H.bind(void 0,1,1,0,1,1),H.bind(void 0,1,1,0,1,2),H.bind(void 0,1,1,0,1,3),H.bind(void 0,1,1,1,0,0),H.bind(void 0,1,1,1,0,1),H.bind(void 0,1,1,1,0,2),H.bind(void 0,1,1,1,0,3),H.bind(void 0,1,1,1,1,0),H.bind(void 0,1,1,1,1,1),H.bind(void 0,1,1,1,1,2),H.bind(void 0,1,1,1,1,3)];function hr(t){this.char=t,this.state={},this.activeState=null}function jo(t,e,r){this.contextName=r,this.startIndex=t,this.endOffset=e}function op(t,e,r){this.contextName=t,this.openRange=null,this.ranges=[],this.checkStart=e,this.checkEnd=r}function ot(t,e){this.context=t,this.index=e,this.length=t.length,this.current=t[e],this.backtrack=t.slice(0,e),this.lookahead=t.slice(e+1)}function Dn(t){this.eventId=t,this.subscribers=[]}function sp(t){var e=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach(function(o){Object.defineProperty(e.events,o,{value:new Dn(o)})}),t&&r.forEach(function(o){var s=t[o];typeof s=="function"&&e.events[o].subscribe(s)});var n=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];n.forEach(function(o){e.events[o].subscribe(e.updateContextsRanges)})}function Ee(t){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],sp.call(this,t)}hr.prototype.setState=function(t,e){return this.state[t]=e,this.activeState={key:t,value:this.state[t]},this.activeState},hr.prototype.getState=function(t){return this.state[t]||null},Ee.prototype.inboundIndex=function(t){return t>=0&&t<this.tokens.length},Ee.prototype.composeRUD=function(t){var e=this,r=!0,n=t.map(function(s){return e[s[0]].apply(e,s.slice(1).concat(r))}),o=function(s){return typeof s=="object"&&s.hasOwnProperty("FAIL")};if(n.every(o))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(o)};this.dispatch("composeRUD",[n.filter(function(s){return!o(s)})])},Ee.prototype.replaceRange=function(t,e,r,n){e=e!==null?e:this.tokens.length;var o=r.every(function(u){return u instanceof hr});if(!isNaN(t)&&this.inboundIndex(t)&&o){var s=this.tokens.splice.apply(this.tokens,[t,e].concat(r));return n||this.dispatch("replaceToken",[t,e,r]),[s,r]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}},Ee.prototype.replaceToken=function(t,e,r){if(!isNaN(t)&&this.inboundIndex(t)&&e instanceof hr){var n=this.tokens.splice(t,1,e);return r||this.dispatch("replaceToken",[t,e]),[n[0],e]}else return{FAIL:"replaceToken: invalid token or index."}},Ee.prototype.removeRange=function(t,e,r){e=isNaN(e)?this.tokens.length:e;var n=this.tokens.splice(t,e);return r||this.dispatch("removeRange",[n,t,e]),n},Ee.prototype.removeToken=function(t,e){if(!isNaN(t)&&this.inboundIndex(t)){var r=this.tokens.splice(t,1);return e||this.dispatch("removeToken",[r,t]),r}else return{FAIL:"removeToken: invalid token index."}},Ee.prototype.insertToken=function(t,e,r){var n=t.every(function(o){return o instanceof hr});return n?(this.tokens.splice.apply(this.tokens,[e,0].concat(t)),r||this.dispatch("insertToken",[t,e]),t):{FAIL:"insertToken: invalid token(s)."}},Ee.prototype.registerModifier=function(t,e,r){this.events.newToken.subscribe(function(n,o){var s=[n,o],u=e===null||e.apply(this,s)===!0,c=[n,o];if(u){var f=r.apply(this,c);n.setState(t,f)}}),this.registeredModifiers.push(t)},Dn.prototype.subscribe=function(t){return typeof t=="function"?this.subscribers.push(t)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},Dn.prototype.unsubscribe=function(t){this.subscribers.splice(t,1)},ot.prototype.setCurrentIndex=function(t){this.index=t,this.current=this.context[t],this.backtrack=this.context.slice(0,t),this.lookahead=this.context.slice(t+1)},ot.prototype.get=function(t){switch(!0){case t===0:return this.current;case(t<0&&Math.abs(t)<=this.backtrack.length):return this.backtrack.slice(t)[0];case(t>0&&t<=this.lookahead.length):return this.lookahead[t-1];default:return null}},Ee.prototype.rangeToText=function(t){if(t instanceof jo)return this.getRangeTokens(t).map(function(e){return e.char}).join("")},Ee.prototype.getText=function(){return this.tokens.map(function(t){return t.char}).join("")},Ee.prototype.getContext=function(t){var e=this.registeredContexts[t];return e||null},Ee.prototype.on=function(t,e){var r=this.events[t];return r?r.subscribe(e):null},Ee.prototype.dispatch=function(t,e){var r=this,n=this.events[t];n instanceof Dn&&n.subscribers.forEach(function(o){o.apply(r,e||[])})},Ee.prototype.registerContextChecker=function(t,e,r){if(this.getContext(t))return{FAIL:"context name '"+t+"' is already registered."};if(typeof e!="function")return{FAIL:"missing context start check."};if(typeof r!="function")return{FAIL:"missing context end check."};var n=new op(t,e,r);return this.registeredContexts[t]=n,this.contextCheckers.push(n),n},Ee.prototype.getRangeTokens=function(t){var e=t.startIndex+t.endOffset;return[].concat(this.tokens.slice(t.startIndex,e))},Ee.prototype.getContextRanges=function(t){var e=this.getContext(t);return e?e.ranges:{FAIL:"context checker '"+t+"' is not registered."}},Ee.prototype.resetContextsRanges=function(){var t=this.registeredContexts;for(var e in t)if(t.hasOwnProperty(e)){var r=t[e];r.ranges=[]}},Ee.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var t=this.tokens.map(function(n){return n.char}),e=0;e<t.length;e++){var r=new ot(t,e);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Ee.prototype.setEndOffset=function(t,e){var r=this.getContext(e).openRange.startIndex,n=new jo(r,t,e),o=this.getContext(e).ranges;return n.rangeId=e+"."+o.length,o.push(n),this.getContext(e).openRange=null,n},Ee.prototype.runContextCheck=function(t){var e=this,r=t.index;this.contextCheckers.forEach(function(n){var o=n.contextName,s=e.getContext(o).openRange;if(!s&&n.checkStart(t)&&(s=new jo(r,null,o),e.getContext(o).openRange=s,e.dispatch("contextStart",[o,r])),s&&n.checkEnd(t)){var u=r-s.startIndex+1,c=e.setEndOffset(u,o);e.dispatch("contextEnd",[o,c])}})},Ee.prototype.tokenize=function(t){this.tokens=[],this.resetContextsRanges();var e=Array.from(t);this.dispatch("start");for(var r=0;r<e.length;r++){var n=e[r],o=new ot(e,r);this.dispatch("next",[o]),this.runContextCheck(o);var s=new hr(n);this.tokens.push(s),this.dispatch("newToken",[s,o])}return this.dispatch("end",[this.tokens]),this.tokens};function Ft(t){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(t)}function Aa(t){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(t)}function Lt(t){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(t)}function Un(t){return/[A-z]/.test(t)}function ip(t){return/\s/.test(t)}function Qe(t){this.font=t,this.features={}}function Xt(t){this.id=t.id,this.tag=t.tag,this.substitution=t.substitution}function zr(t,e){if(!t)return-1;switch(e.format){case 1:return e.glyphs.indexOf(t);case 2:for(var r=e.ranges,n=0;n<r.length;n++){var o=r[n];if(t>=o.start&&t<=o.end){var s=t-o.start;return o.index+s}}break;default:return-1}return-1}function ap(t,e){var r=zr(t,e.coverage);return r===-1?null:t+e.deltaGlyphId}function up(t,e){var r=zr(t,e.coverage);return r===-1?null:e.substitute[r]}function Zo(t,e){for(var r=[],n=0;n<t.length;n++){var o=t[n],s=e.current;s=Array.isArray(s)?s[0]:s;var u=zr(s,o);u!==-1&&r.push(u)}return r.length!==t.length?-1:r}function lp(t,e){var r=e.inputCoverage.length+e.lookaheadCoverage.length+e.backtrackCoverage.length;if(t.context.length<r)return[];var n=Zo(e.inputCoverage,t);if(n===-1)return[];var o=e.inputCoverage.length-1;if(t.lookahead.length<e.lookaheadCoverage.length)return[];for(var s=t.lookahead.slice(o);s.length&&Lt(s[0].char);)s.shift();var u=new ot(s,0),c=Zo(e.lookaheadCoverage,u),f=[].concat(t.backtrack);for(f.reverse();f.length&&Lt(f[0].char);)f.shift();if(f.length<e.backtrackCoverage.length)return[];var p=new ot(f,0),g=Zo(e.backtrackCoverage,p),y=n.length===e.inputCoverage.length&&c.length===e.lookaheadCoverage.length&&g.length===e.backtrackCoverage.length,m=[];if(y)for(var S=0;S<e.lookupRecords.length;S++)for(var E=e.lookupRecords[S],k=E.lookupListIndex,x=this.getLookupByIndex(k),A=0;A<x.subtables.length;A++){var U=x.subtables[A],O=this.getLookupMethod(x,U),V=this.getSubstitutionType(x,U);if(V==="12")for(var L=0;L<n.length;L++){var j=t.get(L),$=O(j);$&&m.push($)}}return m}function cp(t,e){var r=t.current,n=zr(r,e.coverage);if(n===-1)return null;for(var o,s=e.ligatureSets[n],u=0;u<s.length;u++){o=s[u];for(var c=0;c<o.components.length;c++){var f=t.lookahead[c],p=o.components[c];if(f!==p)break;if(c===o.components.length-1)return o}}return null}function fp(t,e){var r=zr(t,e.coverage);return r===-1?null:e.sequences[r]}Qe.prototype.getDefaultScriptFeaturesIndexes=function(){for(var t=this.font.tables.gsub.scripts,e=0;e<t.length;e++){var r=t[e];if(r.tag==="DFLT")return r.script.defaultLangSys.featureIndexes}return[]},Qe.prototype.getScriptFeaturesIndexes=function(t){var e=this.font.tables;if(!e.gsub)return[];if(!t)return this.getDefaultScriptFeaturesIndexes();for(var r=this.font.tables.gsub.scripts,n=0;n<r.length;n++){var o=r[n];if(o.tag===t&&o.script.defaultLangSys)return o.script.defaultLangSys.featureIndexes;var s=o.langSysRecords;if(s)for(var u=0;u<s.length;u++){var c=s[u];if(c.tag===t){var f=c.langSys;return f.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()},Qe.prototype.mapTagsToFeatures=function(t,e){for(var r={},n=0;n<t.length;n++){var o=t[n].tag,s=t[n].feature;r[o]=s}this.features[e].tags=r},Qe.prototype.getScriptFeatures=function(t){var e=this.features[t];if(this.features.hasOwnProperty(t))return e;var r=this.getScriptFeaturesIndexes(t);if(!r)return null;var n=this.font.tables.gsub;return e=r.map(function(o){return n.features[o]}),this.features[t]=e,this.mapTagsToFeatures(e,t),e},Qe.prototype.getSubstitutionType=function(t,e){var r=t.lookupType.toString(),n=e.substFormat.toString();return r+n},Qe.prototype.getLookupMethod=function(t,e){var r=this,n=this.getSubstitutionType(t,e);switch(n){case"11":return function(o){return ap.apply(r,[o,e])};case"12":return function(o){return up.apply(r,[o,e])};case"63":return function(o){return lp.apply(r,[o,e])};case"41":return function(o){return cp.apply(r,[o,e])};case"21":return function(o){return fp.apply(r,[o,e])};default:throw new Error("lookupType: "+t.lookupType+" - substFormat: "+e.substFormat+" is not yet supported")}},Qe.prototype.lookupFeature=function(t){var e=t.contextParams,r=e.index,n=this.getFeature({tag:t.tag,script:t.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+t.tag+"' for script '"+t.script+"'.");for(var o=this.getFeatureLookups(n),s=[].concat(e.context),u=0;u<o.length;u++)for(var c=o[u],f=this.getLookupSubtables(c),p=0;p<f.length;p++){var g=f[p],y=this.getSubstitutionType(c,g),m=this.getLookupMethod(c,g),S=void 0;switch(y){case"11":S=m(e.current),S&&s.splice(r,1,new Xt({id:11,tag:t.tag,substitution:S}));break;case"12":S=m(e.current),S&&s.splice(r,1,new Xt({id:12,tag:t.tag,substitution:S}));break;case"63":S=m(e),Array.isArray(S)&&S.length&&s.splice(r,1,new Xt({id:63,tag:t.tag,substitution:S}));break;case"41":S=m(e),S&&s.splice(r,1,new Xt({id:41,tag:t.tag,substitution:S}));break;case"21":S=m(e.current),S&&s.splice(r,1,new Xt({id:21,tag:t.tag,substitution:S}));break}e=new ot(s,r),!(Array.isArray(S)&&!S.length)&&(S=null)}return s.length?s:null},Qe.prototype.supports=function(t){if(!t.script)return!1;this.getScriptFeatures(t.script);var e=this.features.hasOwnProperty(t.script);if(!t.tag)return e;var r=this.features[t.script].some(function(n){return n.tag===t.tag});return e&&r},Qe.prototype.getLookupSubtables=function(t){return t.subtables||null},Qe.prototype.getLookupByIndex=function(t){var e=this.font.tables.gsub.lookups;return e[t]||null},Qe.prototype.getFeatureLookups=function(t){return t.lookupListIndexes.map(this.getLookupByIndex.bind(this))},Qe.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var r=this.features[e.script];return r?r.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function hp(t){var e=t.current,r=t.get(-1);return r===null&&Ft(e)||!Ft(r)&&Ft(e)}function pp(t){var e=t.get(1);return e===null||!Ft(e)}var dp={startCheck:hp,endCheck:pp};function vp(t){var e=t.current,r=t.get(-1);return(Ft(e)||Lt(e))&&!Ft(r)}function gp(t){var e=t.get(1);switch(!0){case e===null:return!0;case(!Ft(e)&&!Lt(e)):var r=ip(e);if(!r)return!0;if(r){var n=!1;if(n=t.lookahead.some(function(o){return Ft(o)||Lt(o)}),!n)return!0}break;default:return!1}}var mp={startCheck:vp,endCheck:gp};function yp(t,e,r){e[r].setState(t.tag,t.substitution)}function wp(t,e,r){e[r].setState(t.tag,t.substitution)}function bp(t,e,r){t.substitution.forEach(function(n,o){var s=e[r+o];s.setState(t.tag,n)})}function Sp(t,e,r){var n=e[r];n.setState(t.tag,t.substitution.ligGlyph);for(var o=t.substitution.components.length,s=0;s<o;s++)n=e[r+s+1],n.setState("deleted",!0)}var Oa={11:yp,12:wp,63:bp,41:Sp};function Ko(t,e,r){t instanceof Xt&&Oa[t.id]&&Oa[t.id](t,e,r)}function _p(t){for(var e=[].concat(t.backtrack),r=e.length-1;r>=0;r--){var n=e[r],o=Aa(n),s=Lt(n);if(!o&&!s)return!0;if(o)return!1}return!1}function Ep(t){if(Aa(t.current))return!1;for(var e=0;e<t.lookahead.length;e++){var r=t.lookahead[e],n=Lt(r);if(!n)return!0}return!1}function Tp(t){var e=this,r="arab",n=this.featuresTags[r],o=this.tokenizer.getRangeTokens(t);if(o.length!==1){var s=new ot(o.map(function(c){return c.getState("glyphIndex")}),0),u=new ot(o.map(function(c){return c.char}),0);o.forEach(function(c,f){if(!Lt(c.char)){s.setCurrentIndex(f),u.setCurrentIndex(f);var p=0;_p(u)&&(p|=1),Ep(u)&&(p|=2);var g;switch(p){case 1:g="fina";break;case 2:g="init";break;case 3:g="medi";break}if(n.indexOf(g)!==-1){var y=e.query.lookupFeature({tag:g,script:r,contextParams:s});if(y instanceof Error)return console.info(y.message);y.forEach(function(m,S){m instanceof Xt&&(Ko(m,o,S),s.context[S]=m.substitution)})}}})}}function Ra(t,e){var r=t.map(function(n){return n.activeState.value});return new ot(r,e||0)}function xp(t){var e=this,r="arab",n=this.tokenizer.getRangeTokens(t),o=Ra(n);o.context.forEach(function(s,u){o.setCurrentIndex(u);var c=e.query.lookupFeature({tag:"rlig",script:r,contextParams:o});c.length&&(c.forEach(function(f){return Ko(f,n,u)}),o=Ra(n))})}function kp(t){var e=t.current,r=t.get(-1);return r===null&&Un(e)||!Un(r)&&Un(e)}function Cp(t){var e=t.get(1);return e===null||!Un(e)}var Pp={startCheck:kp,endCheck:Cp};function Da(t,e){var r=t.map(function(n){return n.activeState.value});return new ot(r,e||0)}function Ap(t){var e=this,r="latn",n=this.tokenizer.getRangeTokens(t),o=Da(n);o.context.forEach(function(s,u){o.setCurrentIndex(u);var c=e.query.lookupFeature({tag:"liga",script:r,contextParams:o});c.length&&(c.forEach(function(f){return Ko(f,n,u)}),o=Da(n))})}function st(t){this.baseDir=t||"ltr",this.tokenizer=new Ee,this.featuresTags={}}st.prototype.setText=function(t){this.text=t},st.prototype.contextChecks={latinWordCheck:Pp,arabicWordCheck:dp,arabicSentenceCheck:mp};function Qo(t){var e=this.contextChecks[t+"Check"];return this.tokenizer.registerContextChecker(t,e.startCheck,e.endCheck)}function Op(){return Qo.call(this,"latinWord"),Qo.call(this,"arabicWord"),Qo.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Rp(){var t=this,e=this.tokenizer.getContextRanges("arabicSentence");e.forEach(function(r){var n=t.tokenizer.getRangeTokens(r);t.tokenizer.replaceRange(r.startIndex,r.endOffset,n.reverse())})}st.prototype.registerFeatures=function(t,e){var r=this,n=e.filter(function(o){return r.query.supports({script:t,tag:o})});this.featuresTags.hasOwnProperty(t)?this.featuresTags[t]=this.featuresTags[t].concat(n):this.featuresTags[t]=n},st.prototype.applyFeatures=function(t,e){if(!t)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Qe(t));for(var r=0;r<e.length;r++){var n=e[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},st.prototype.registerModifier=function(t,e,r){this.tokenizer.registerModifier(t,e,r)};function Jo(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Dp(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){Jo.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){Tp.call(t,n)})}}function Up(){var t=this,e="arab";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("rlig")!==-1){Jo.call(this);var n=this.tokenizer.getContextRanges("arabicWord");n.forEach(function(o){xp.call(t,o)})}}}function Bp(){var t=this,e="latn";if(this.featuresTags.hasOwnProperty(e)){var r=this.featuresTags[e];if(r.indexOf("liga")!==-1){Jo.call(this);var n=this.tokenizer.getContextRanges("latinWord");n.forEach(function(o){Ap.call(t,o)})}}}st.prototype.checkContextReady=function(t){return!!this.tokenizer.getContext(t)},st.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(Dp.call(this),Up.call(this)),this.checkContextReady("latinWord")&&Bp.call(this),this.checkContextReady("arabicSentence")&&Rp.call(this)},st.prototype.processText=function(t){(!this.text||this.text!==t)&&(this.setText(t),Op.call(this),this.applyFeaturesToContexts())},st.prototype.getBidiText=function(t){return this.processText(t),this.tokenizer.getText()},st.prototype.getTextGlyphs=function(t){this.processText(t);for(var e=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var o=n.activeState.value;e.push(Array.isArray(o)?o[0]:o)}}return e};function me(t){t=t||{},t.tables=t.tables||{},t.empty||(Ir(t.familyName,"When creating a new Font object, familyName is required."),Ir(t.styleName,"When creating a new Font object, styleName is required."),Ir(t.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),Ir(t.ascender,"When creating a new Font object, ascender is required."),Ir(t.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:t.familyName||" "},fontSubfamily:{en:t.styleName||" "},fullName:{en:t.fullName||t.familyName+" "+t.styleName},postScriptName:{en:t.postScriptName||(t.familyName+t.styleName).replace(/\s/g,"")},designer:{en:t.designer||" "},designerURL:{en:t.designerURL||" "},manufacturer:{en:t.manufacturer||" "},manufacturerURL:{en:t.manufacturerURL||" "},license:{en:t.license||" "},licenseURL:{en:t.licenseURL||" "},version:{en:t.version||"Version 0.1"},description:{en:t.description||" "},copyright:{en:t.copyright||" "},trademark:{en:t.trademark||" "}},this.unitsPerEm=t.unitsPerEm||1e3,this.ascender=t.ascender,this.descender=t.descender,this.createdTimestamp=t.createdTimestamp,this.tables=Object.assign(t.tables,{os2:Object.assign({usWeightClass:t.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:t.widthClass||this.usWidthClasses.MEDIUM,fsSelection:t.fsSelection||this.fsSelectionValues.REGULAR},t.tables.os2)})),this.supported=!0,this.glyphs=new ct.GlyphSet(this,t.glyphs||[]),this.encoding=new Di(this),this.position=new Lr(this),this.substitution=new Ke(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new ca(this)}})}me.prototype.hasChar=function(t){return this.encoding.charToGlyphIndex(t)!==null},me.prototype.charToGlyphIndex=function(t){return this.encoding.charToGlyphIndex(t)},me.prototype.charToGlyph=function(t){var e=this.charToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},me.prototype.updateFeatures=function(t){return this.defaultRenderOptions.features.map(function(e){return e.script==="latn"?{script:"latn",tags:e.tags.filter(function(r){return t[r]})}:e})},me.prototype.stringToGlyphs=function(t,e){var r=this,n=new st,o=function(y){return r.charToGlyphIndex(y.char)};n.registerModifier("glyphIndex",null,o);var s=e?this.updateFeatures(e.features):this.defaultRenderOptions.features;n.applyFeatures(this,s);for(var u=n.getTextGlyphs(t),c=u.length,f=new Array(c),p=this.glyphs.get(0),g=0;g<c;g+=1)f[g]=this.glyphs.get(u[g])||p;return f},me.prototype.nameToGlyphIndex=function(t){return this.glyphNames.nameToGlyphIndex(t)},me.prototype.nameToGlyph=function(t){var e=this.nameToGlyphIndex(t),r=this.glyphs.get(e);return r||(r=this.glyphs.get(0)),r},me.prototype.glyphIndexToName=function(t){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(t):""},me.prototype.getKerningValue=function(t,e){t=t.index||t,e=e.index||e;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,t,e):this.kerningPairs[t+","+e]||0},me.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},me.prototype.forEachGlyph=function(t,e,r,n,o,s){e=e!==void 0?e:0,r=r!==void 0?r:0,n=n!==void 0?n:72,o=Object.assign({},this.defaultRenderOptions,o);var u=1/this.unitsPerEm*n,c=this.stringToGlyphs(t,o),f;if(o.kerning){var p=o.script||this.position.getDefaultScriptName();f=this.position.getKerningTables(p,o.language)}for(var g=0;g<c.length;g+=1){var y=c[g];if(s.call(this,y,e,r,n,o),y.advanceWidth&&(e+=y.advanceWidth*u),o.kerning&&g<c.length-1){var m=f?this.position.getKerningValue(f,y.index,c[g+1].index):this.getKerningValue(y,c[g+1]);e+=m*u}o.letterSpacing?e+=o.letterSpacing*n:o.tracking&&(e+=o.tracking/1e3*n)}return e},me.prototype.getPath=function(t,e,r,n,o){var s=new Be;return this.forEachGlyph(t,e,r,n,o,function(u,c,f,p){var g=u.getPath(c,f,p,o,this);s.extend(g)}),s},me.prototype.getPaths=function(t,e,r,n,o){var s=[];return this.forEachGlyph(t,e,r,n,o,function(u,c,f,p){var g=u.getPath(c,f,p,o,this);s.push(g)}),s},me.prototype.getAdvanceWidth=function(t,e,r){return this.forEachGlyph(t,0,0,e,r,function(){})},me.prototype.draw=function(t,e,r,n,o,s){this.getPath(e,r,n,o,s).draw(t)},me.prototype.drawPoints=function(t,e,r,n,o,s){this.forEachGlyph(e,r,n,o,s,function(u,c,f,p){u.drawPoints(t,c,f,p)})},me.prototype.drawMetrics=function(t,e,r,n,o,s){this.forEachGlyph(e,r,n,o,s,function(u,c,f,p){u.drawMetrics(t,c,f,p)})},me.prototype.getEnglishName=function(t){var e=this.names[t];if(e)return e.en},me.prototype.validate=function(){var t=this;function e(n,o){}function r(n){var o=t.getEnglishName(n);o&&o.trim().length>0}r("fontFamily"),r("weightName"),r("manufacturer"),r("copyright"),r("version"),this.unitsPerEm>0},me.prototype.toTables=function(){return bf.fontToTable(this)},me.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},me.prototype.toArrayBuffer=function(){for(var t=this.toTables(),e=t.encode(),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];return r},me.prototype.download=function(t){var e=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");t=t||e.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if(_f())if(window.URL=window.URL||window.webkitURL,window.URL){var o=new DataView(n),s=new Blob([o],{type:"font/opentype"}),u=document.createElement("a");u.href=window.URL.createObjectURL(s),u.download=t;var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!1),u.dispatchEvent(c)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var f=require("fs"),p=Ef(n);f.writeFileSync(t,p)}},me.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},me.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},me.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var wt=new Array(10);wt[1]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();if(r===1)return{posFormat:1,coverage:this.parsePointer(C.coverage),value:this.parseValueRecord()};if(r===2)return{posFormat:2,coverage:this.parsePointer(C.coverage),values:this.parseValueRecordList()};Z.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},wt[2]=function(){var e=this.offset+this.relativeOffset,r=this.parseUShort();Z.assert(r===1||r===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(C.coverage),o=this.parseUShort(),s=this.parseUShort();if(r===1)return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:s,pairSets:this.parseList(C.pointer(C.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(o),value2:this.parseValueRecord(s)}})))};if(r===2){var u=this.parsePointer(C.classDef),c=this.parsePointer(C.classDef),f=this.parseUShort(),p=this.parseUShort();return{posFormat:r,coverage:n,valueFormat1:o,valueFormat2:s,classDef1:u,classDef2:c,class1Count:f,class2Count:p,classRecords:this.parseList(f,C.list(p,function(){return{value1:this.parseValueRecord(o),value2:this.parseValueRecord(s)}}))}}},wt[3]=function(){return{error:"GPOS Lookup 3 not supported"}},wt[4]=function(){return{error:"GPOS Lookup 4 not supported"}},wt[5]=function(){return{error:"GPOS Lookup 5 not supported"}},wt[6]=function(){return{error:"GPOS Lookup 6 not supported"}},wt[7]=function(){return{error:"GPOS Lookup 7 not supported"}},wt[8]=function(){return{error:"GPOS Lookup 8 not supported"}},wt[9]=function(){return{error:"GPOS Lookup 9 not supported"}},new Array(10);const $t=1e-8,pr=(t,e)=>He(t,e,$t*10);function Mp(t,e){const r=t.orientation==="clockwise"?-e:e,n=t.curves.map(p=>({offset:go(p,r),original:p})),o=[];let s=null,u=n.at(-1);if(!u)return[];if(o.length===1)return o;const c=p=>{s?p.offset instanceof _e?o.push(p.offset):pr(p.offset.firstPoint,p.offset.lastPoint)||o.push(Er(p.offset.firstPoint,p.offset.lastPoint)):s=p},f=function*(){for(const p of n.slice(0,-1))yield p;if(!s)throw new Error("Bug in the offset algorithm");yield s};for(const p of f()){const g=u.offset.lastPoint,y=p.offset.firstPoint;if(pr(g,y)){c(u),u=p;continue}let m=[];if(u.offset instanceof _e&&p.offset instanceof _e){const{intersections:E,commonSegmentsPoints:k}=_r(u.offset,p.offset,$t/100);m=[...E,...k]}if(m.length>0){let E=m[0];if(m.length>1){const A=u==null?void 0:u.original.lastPoint,U=m.map(O=>Vu(O,A));E=m[U.indexOf(Math.min(...U))]}const k=u.offset.splitAt([E],$t)[0],x=p.offset.splitAt([E],$t).at(-1);if(!x)throw new Error("Bug in the splitting algo in offset");c({offset:k,original:u.original}),u={offset:x,original:p.original};continue}const S=Ls(g,y,u.original.lastPoint);c(u),o.push(S),u=p}return c(u),o}function Fp(t,e){const r=Mp(t,e);if(r.length<2)return null;const n=new Map,o=(p,g)=>{const y=n.get(p)||[];n.set(p,[...y,...g])};if(r.forEach((p,g)=>{r.slice(g+1).forEach((y,m)=>{const{intersections:S,commonSegmentsPoints:E}=_r(p,y,$t),k=[...S,...E].filter(x=>{const A=pr(x,p.firstPoint)||pr(x,p.lastPoint),U=pr(x,y.firstPoint)||pr(x,y.lastPoint);return!(A&&U)});k.length&&(o(g,k),o(m+g+1,k))})}),!n.size){const p=new ae(r);return t.intersects(p)?null:p}const u=r.flatMap((p,g)=>{if(!n.has(g))return p;const y=n.get(g)||[];return p.splitAt(y,$t*100)}).filter(p=>!t.curves.find(y=>y.distanceFrom(p)<Math.abs(e)-$t));if(!u.length)return null;const f=sl(u).filter(p=>p.length>1).map(p=>new ae(p)).filter(p=>p.isClosed());return f.length?f.length===1?f[0]:new ee(f):null}const Ua=t=>{let e=t[0];for(let r=1;r<t.length;r++)e=gt(e,t[r]);return e};function Bn(t,e){if(t instanceof ae)return Fp(t,e);if(t instanceof ee)return Ua(t.blueprints.map(r=>Bn(r,e)));if(t instanceof ve){const r=Ua(t.blueprints.slice(1).map(n=>Bn(n,e)));return Ot(Bn(t.blueprints[0],e),r)}return null}function Ba(t,e,r,n){let o=()=>!0;n&&(o=n.shouldKeep.bind(n));const s=[e.curves[0]],u=(f,p)=>{o({firstCurve:f,secondCurve:p,point:f.lastPoint})?s.push(...t(f,p,r)):s.push(f,p)};e.curves.slice(1).forEach(f=>{const p=s.pop();if(!p)throw new Error("Bug in the blueprint filletting algo");u(p,f)});const c=s.at(-1);if(!c)throw new Error("Bug in the blueprint corner algo");if(He(s[0].firstPoint,c.lastPoint)&&s.length>1){const f=s.pop(),p=s.shift();if(!f||!p)throw new Error("Bug in the blueprint filletting algo");u(f,p)}return new ae(s)}function es(t,e,r,n){if(e instanceof ae)return Ba(t,e,r,n);if(e instanceof ve)return new ve(e.blueprints.map(o=>Ba(t,o,r,n)));if(e instanceof ee){const o=e.blueprints.map(s=>es(t,s,r,n)).filter(s=>s!==null);return new ee(o)}return null}function Lp(t,e,r){return es(mo,t,e,r)}function Ip(t,e,r){return es(yo,t,e,r)}class Oe{constructor(e=null){this.innerShape=e}clone(){var e;return new Oe(((e=this.innerShape)==null?void 0:e.clone())||null)}get boundingBox(){return this.innerShape?this.innerShape.boundingBox:new Sr}stretch(e,r,n){return this.innerShape?new Oe(this.innerShape.stretch(e,r,n)):new Oe}get repr(){return this.innerShape===null?"=== empty shape":this.innerShape.repr}rotate(e,r){return this.innerShape?new Oe(this.innerShape.rotate(e,r)):new Oe}translate(e,r=0){return this.innerShape?new Oe(this.innerShape.translate(e,r)):new Oe}scale(e,r){return this.innerShape?new Oe(this.innerShape.scale(e,r)):new Oe}mirror(e,r,n){return this.innerShape?new Oe(this.innerShape.mirror(e,r,n)):new Oe}cut(e){return new Oe(Ot(this.innerShape,e.innerShape))}fuse(e){return new Oe(gt(this.innerShape,e.innerShape))}intersect(e){return new Oe(Dr(this.innerShape,e.innerShape))}fillet(e,r){const n=r&&r(new an);return new Oe(Lp(this.innerShape,e,n))}chamfer(e,r){const n=r&&r(new an);return new Oe(Ip(this.innerShape,e,n))}sketchOnPlane(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnPlane(e,r)}sketchOnFace(e,r){if(!this.innerShape)throw new Error("Trying to sketch an empty drawing");return this.innerShape.sketchOnFace(e,r)}toSVG(e){var r;return((r=this.innerShape)==null?void 0:r.toSVG(e))||""}toSVGViewBox(e=1){var r;return((r=this.innerShape)==null?void 0:r.toSVGViewBox(e))||""}toSVGPaths(){var e;return((e=this.innerShape)==null?void 0:e.toSVGPaths())||[]}offset(e){return new Oe(Bn(this.innerShape,e))}get blueprint(){if(!(this.innerShape instanceof ae)){if(this.innerShape instanceof ee&&this.innerShape.blueprints.length===1&&this.innerShape.blueprints[0]instanceof ae)return this.innerShape.blueprints[0];throw new Error("This drawing is not a blueprint")}return this.innerShape}}class Gp extends xl{constructor(e=[0,0]){super(),this.pointer=e,this.firstPoint=e,this.pendingCurves=[]}done(){return new Oe(new ae(this.pendingCurves))}close(){return this._closeSketch(),this.done()}closeWithMirror(){return this._closeWithMirror(),this.close()}closeWithCustomCorner(e,r="fillet"){return this._closeSketch(),this._customCornerLastWithFirst(e,r),this.done()}}function Mn(t){const e=new Gp;return t&&e.movePointerTo(t),e}function Fn(t){return Mn().movePointerTo([-t,0]).sagittaArc(2*t,0,t).sagittaArc(-2*t,0,t).close()}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ma=Symbol("Comlink.proxy"),Np=Symbol("Comlink.endpoint"),Hp=Symbol("Comlink.releaseProxy"),ts=Symbol("Comlink.finalizer"),Ln=Symbol("Comlink.thrown"),Fa=t=>typeof t=="object"&&t!==null||typeof t=="function",zp={canHandle:t=>Fa(t)&&t[Ma],serialize(t){const{port1:e,port2:r}=new MessageChannel;return rs(t,e),[r,[r]]},deserialize(t){return t.start(),Xp(t)}},Wp={canHandle:t=>Fa(t)&&Ln in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},La=new Map([["proxy",zp],["throw",Wp]]);function Vp(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function rs(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(o){if(!o||!o.data)return;if(!Vp(r,o.origin)){console.warn(`Invalid origin '${o.origin}' for comlink proxy`);return}const{id:s,type:u,path:c}=Object.assign({path:[]},o.data),f=(o.data.argumentList||[]).map(qt);let p;try{const g=c.slice(0,-1).reduce((m,S)=>m[S],t),y=c.reduce((m,S)=>m[S],t);switch(u){case"GET":p=y;break;case"SET":g[c.slice(-1)[0]]=qt(o.data.value),p=!0;break;case"APPLY":p=y.apply(g,f);break;case"CONSTRUCT":{const m=new y(...f);p=Kp(m)}break;case"ENDPOINT":{const{port1:m,port2:S}=new MessageChannel;rs(t,S),p=Zp(m,[m])}break;case"RELEASE":p=void 0;break;default:return}}catch(g){p={value:g,[Ln]:0}}Promise.resolve(p).catch(g=>({value:g,[Ln]:0})).then(g=>{const[y,m]=Hn(g);e.postMessage(Object.assign(Object.assign({},y),{id:s}),m),u==="RELEASE"&&(e.removeEventListener("message",n),Ia(e),ts in t&&typeof t[ts]=="function"&&t[ts]())}).catch(g=>{const[y,m]=Hn({value:new TypeError("Unserializable return value"),[Ln]:0});e.postMessage(Object.assign(Object.assign({},y),{id:s}),m)})}),e.start&&e.start()}function Yp(t){return t.constructor.name==="MessagePort"}function Ia(t){Yp(t)&&t.close()}function Xp(t,e){return ns(t,[],e)}function In(t){if(t)throw new Error("Proxy has been released and is not useable")}function Ga(t){return dr(t,{type:"RELEASE"}).then(()=>{Ia(t)})}const Gn=new WeakMap,Nn="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Gn.get(t)||0)-1;Gn.set(t,e),e===0&&Ga(t)});function $p(t,e){const r=(Gn.get(e)||0)+1;Gn.set(e,r),Nn&&Nn.register(t,e,t)}function qp(t){Nn&&Nn.unregister(t)}function ns(t,e=[],r=function(){}){let n=!1;const o=new Proxy(r,{get(s,u){if(In(n),u===Hp)return()=>{qp(o),Ga(t),n=!0};if(u==="then"){if(e.length===0)return{then:()=>o};const c=dr(t,{type:"GET",path:e.map(f=>f.toString())}).then(qt);return c.then.bind(c)}return ns(t,[...e,u])},set(s,u,c){In(n);const[f,p]=Hn(c);return dr(t,{type:"SET",path:[...e,u].map(g=>g.toString()),value:f},p).then(qt)},apply(s,u,c){In(n);const f=e[e.length-1];if(f===Np)return dr(t,{type:"ENDPOINT"}).then(qt);if(f==="bind")return ns(t,e.slice(0,-1));const[p,g]=Na(c);return dr(t,{type:"APPLY",path:e.map(y=>y.toString()),argumentList:p},g).then(qt)},construct(s,u){In(n);const[c,f]=Na(u);return dr(t,{type:"CONSTRUCT",path:e.map(p=>p.toString()),argumentList:c},f).then(qt)}});return $p(o,t),o}function jp(t){return Array.prototype.concat.apply([],t)}function Na(t){const e=t.map(Hn);return[e.map(r=>r[0]),jp(e.map(r=>r[1]))]}const Ha=new WeakMap;function Zp(t,e){return Ha.set(t,e),t}function Kp(t){return Object.assign(t,{[Ma]:!0})}function Hn(t){for(const[e,r]of La)if(r.canHandle(t)){const[n,o]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},o]}return[{type:"RAW",value:t},Ha.get(t)||[]]}function qt(t){switch(t.type){case"HANDLER":return La.get(t.name).deserialize(t.value);case"RAW":return t.value}}function dr(t,e,r){return new Promise(n=>{const o=Qp();t.addEventListener("message",function s(u){!u.data||!u.data.id||u.data.id!==o||(t.removeEventListener("message",s),n(u.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:o},e),r)})}function Qp(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const za=t=>t*25.4,it=(t,e)=>{const r=e*Math.PI/180,n=t*Math.sin(r),o=t*Math.cos(r);return[n,o]},zn=(t,e)=>{const r=(2*t*t-e*e)/(2*t*t);return Math.acos(r)*(180/Math.PI)},vr=(t,e,r,n,o)=>Mn().movePointerTo(it(t,e/2)).threePointsArcTo(it(t,-e/2),[0,t]).lineTo(it(t-r,-e/2)).threePointsArcTo(it(t-r,e/2),[0,t-r]).close().sketchOnPlane(o).extrude(n),Wa=(t,e,r,n,o)=>Mn().movePointerTo(it(t,e/2)).threePointsArcTo(it(t,-e/2),[0,t]).threePointsArcTo(it(t-r,-e/2),it(t-r/2,-(e/2+zn(t-r/2,r/2)))).threePointsArcTo(it(t-r,e/2),[0,t-r]).threePointsArcTo(it(t,e/2),it(t-r/2,e/2+zn(t-r/2,r/2))).close().sketchOnPlane(o).extrude(n);function Jp(t,e){const r=e*Math.PI/180,n=t*Math.tan(r),o=t/Math.cos(r);return{sideA:n,hypotenuse:o}}const Wr=({plane:t,startRadius:e,chamferAngle:r,chamferWidth:n,chamferStartHeight:o,chamferUp:s,edgeInner:u=!0})=>{const{hypotenuse:c}=Jp(n,r),f=Mn().movePointerTo([e,0]).polarLine(c,u?180-r:r).lineTo([u?e-n:e+n,0]).close().sketchOnPlane(t).revolve().translateZ(s?o:-o);return s?f:f.mirror("XY",[0,0])},ed=({shellConstants:t,drum:e,interlockingTabPockets:r,updateProgress:n})=>{const{depth:o,radius:s,shellSegmentHeight:u,shellCenterPoint:c,tabVertexAngle:f,tabThickness:p,tabOuterRadius:g,tabFitmentToleranceDegrees:y,shellSegmentPlane:m}=t,{fitmentTolerance:S,lugs:E}=e,{shellThickness:k,lugsPerSegment:x}=e.shell,{lugType:A,lugRows:U,lugHoleDiameter:O,lugHoleSpacing:V,lugHoleDistanceFromEdge:L,lugHolePocketDiameter:j,lugHolePocketDepth:$}=E,X=t.shellSegmentVertexAngle*x,te=(he,se=0)=>{let de=Fn(O/2).sketchOnPlane("XZ",-s).extrude(k+10);if(j&&$){const pe=Fn(j/2).sketchOnPlane("XZ",-s).extrude($);de=de.fuse(pe)}const we=[];for(let pe=0;pe<(se?2:4);pe++)we.push(de.clone().translateZ(c-se/2).rotate(X/2)),we.push(de.clone().translateZ(c+se/2).rotate(X/2)),se&&(we.push(de.clone().translateZ(c+se/2).rotate(-X/2)),we.push(de.clone().translateZ(c-se/2).rotate(-X/2))),he===2&&(we.push(de.clone().translateZ(c+se/2)),we.push(de.clone().translateZ(c-se/2)));return we},ne=vr(s,X,k,u,m).rotate(f/2),K=vr(g,f,p,u,m).rotate(-X/2),Le=vr(g+S,f+y*2,p+S*2,u,m).rotate(X/2),Re=ne.fuse(K).cut(Le);n(.5,"Generating lug holes");let oe=[];U===1?A==="singlePoint"?oe=te(x):A==="doublePoint"&&(oe=te(x,V)):U===2&&L&&(A==="singlePoint"?oe=te(x,o-L*2):A==="doublePoint"&&V&&(oe=[...te(x,o-L*2),...te(x,o-(L+V)*2)])),n(.6,"Cutting lug holes and tab pockets");const ye=[...r,...oe],{shellSegment:Te}=ye.reduce(({shellSegment:he,progress:se},de,we)=>{const pe=he.cut(de);return se=se+(we+1)/ye.length*.4,n(se),{shellSegment:pe,progress:.6}},{shellSegment:Re,progress:.6});return Te},td=({shellConstants:t,drum:e,interlockingTabPockets:r,updateProgress:n})=>{const{lugsPerSegment:o,ventHoleDiameter:s}=e.shell,u=t.shellSegmentVertexAngle*o,{shellSegmentVertexAngle:c,radius:f,shellThickness:p,depth:g}=t;n(.4,"Generating base shell segment");const y=ed({shellConstants:t,drum:e,interlockingTabPockets:r,updateProgress:n}),m=[];for(let E=0;E<360/u;E++)if(o===1){let k=y.clone().rotate(E*u);m.push({shape:k,name:`Shell Segment ${E+1}`})}else if(o===2){let k=y.clone().rotate(E*u-u/4);m.push({shape:k,name:`Shell Segment ${E+1}`})}return m.map(E=>(E.shape=E.shape.cut(rd({ventHoleDiameter:s,radius:f,shellThickness:p,depth:g,shellSegmentVertexAngle:c})),E))},rd=({ventHoleDiameter:t,radius:e,shellThickness:r,depth:n,shellSegmentVertexAngle:o})=>Fn(t/2).sketchOnPlane("XZ").extrude(r*2).translateY(e+r/2).translateZ(n/2).rotate(-o*2),nd=({shellConstants:t,drum:e,updateProgress:r})=>{const{shellSegmentVertexAngle:n,shellSegmentHeight:o,tabThickness:s,tabOuterRadius:u,tabFitmentToleranceDegrees:c,interlockingTabHeight:f,shellSegmentPlane:p}=t,{fitmentTolerance:g}=e,{lugNumber:y}=e.lugs,{diameterInches:m}=e.shell,S=m>=12?2:1,E=Wa(u,n/(2*S),s,f,p),k=Wa(u+g,n/(2*S)+c,s+g*2,f,p);r(.15,"Positioning tabs");const x={interlockingTabs:[],interlockingTabPockets:[]};for(let A=0;A<y*S;A++){const O=(S>1?-n/(S*2):0)+A*(n/S);x.interlockingTabs.push({shape:E.clone().translateZ(o-f/2).rotate(O),name:`Interlocking Tab ${x.interlockingTabs.length+1}`}),x.interlockingTabs.push({shape:E.clone().translateZ(-(f/2)).rotate(O),name:`Interlocking Tab ${x.interlockingTabs.length+1}`}),x.interlockingTabPockets.push(k.clone().translateZ(o-f/2).rotate(O)),x.interlockingTabPockets.push(k.clone().translateZ(-(f/2)).rotate(O))}return x},od=({shellConstants:t,drum:e,interlockingTabPockets:r,updateProgress:n})=>{const{bearingEdgeHeight:o,radius:s,shellSegmentVertexAngle:u,shellSegmentHeight:c,basePlane:f}=t,{bearingEdges:p}=e,{shellThickness:g}=e.shell,y=u*e.bearingEdges.lugsPerSegment,{topBearingEdge:m,bottomBearingEdge:S}=p,E=S.thickness&&S.thickness>g?S.thickness:g,k=m.thickness&&m.thickness>g?m.thickness:g;n(.25,"Generating base bearing edge segments");const x=Va({shellConstants:t,drum:e,interlockingTabPockets:r,bearingEdgeVertexAngle:y,bearingEdgeThickness:E}),A=JSON.stringify(m)===JSON.stringify(S)?x:Va({shellConstants:t,drum:e,interlockingTabPockets:r,bearingEdgeVertexAngle:y,bearingEdgeThickness:k}),U=(V,L,j=f)=>V.ofCurveType("CIRCLE").atDistance(L,[0,0]).inPlane(j),O={bearingEdgesTop:[],bearingEdgesBottom:[]};n(.3,"Duplicating bearing edge segments and cutting bearing edges");for(let V=0;V<360/y;V++){const{outerEdge:L,innerEdge:j}=m;let $=A.clone().rotate(V*y);if(L.profileType==="roundover")$=$.fillet(L.profileSize-.01,K=>U(K,s));else if(L.profileType==="chamfer")$=$.chamfer(L.profileSize-.01,K=>U(K,s));else if(L.profileType==="customChamfer"&&L.customChamferAngle){const K=Wr({plane:Xe("XZ"),startRadius:s-p.topBearingEdge.outerEdge.profileSize,chamferAngle:L.customChamferAngle,chamferWidth:m.thickness-p.topBearingEdge.outerEdge.profileSize,chamferStartHeight:0,chamferUp:!0,edgeInner:!1});$=$.cut(K)}if(j.profileType==="roundover")$=$.fillet(k-L.profileSize-.01,K=>U(K,s-k));else if(j.profileType==="chamfer")$=$.chamfer(k-L.profileSize-.01,K=>U(K,s-k));else if(j.profileType==="customChamfer"&&j.customChamferAngle){const K=Wr({plane:Xe("XZ"),startRadius:s-p.topBearingEdge.outerEdge.profileSize,chamferAngle:j.customChamferAngle,chamferWidth:m.thickness-p.topBearingEdge.outerEdge.profileSize,chamferStartHeight:0,chamferUp:!0,edgeInner:!0});$=$.cut(K)}O.bearingEdgesTop.push({shape:$.mirror("XY",[0,0]).translateZ(c+o*2),name:`Bearing Edge Top ${V+1}`});const{outerEdge:X,innerEdge:te}=S;let ne=x.clone().rotate(V*y);if(X.profileType==="roundover")ne=ne.fillet(X.profileSize-.01,K=>U(K,s));else if(X.profileType==="chamfer")ne=ne.chamfer(X.profileSize-.01,K=>U(K,s));else if(X.profileType==="customChamfer"&&X.customChamferAngle){const K=Wr({plane:Xe("XZ"),startRadius:s-p.bottomBearingEdge.outerEdge.profileSize,chamferAngle:X.customChamferAngle,chamferWidth:S.thickness-p.bottomBearingEdge.outerEdge.profileSize,chamferStartHeight:0,chamferUp:!0,edgeInner:!1});ne=ne.cut(K)}if(te.profileType==="roundover")ne=ne.fillet(E-X.profileSize-.01,K=>U(K,s-E));else if(te.profileType==="chamfer")ne=ne.chamfer(E-X.profileSize-.1,K=>U(K,s-E));else if(te.profileType==="customChamfer"&&te.customChamferAngle){const K=Wr({plane:Xe("XZ"),startRadius:s-p.bottomBearingEdge.outerEdge.profileSize,chamferAngle:te.customChamferAngle,chamferWidth:S.thickness-p.bottomBearingEdge.outerEdge.profileSize,chamferStartHeight:0,chamferUp:!0,edgeInner:!0});ne=ne.cut(K)}O.bearingEdgesBottom.push({shape:ne,name:`Bearing Edge Bottom ${V+1}`})}if(e.drumType==="snare"&&e.snareBeds){n(.35,"Cutting snare beds");const{snareBedAngle:V,snareBedDepth:L,snareBedRadius:j}=e.snareBeds,$=[Ya({radius:s,snareBedAngle:V,snareBedDepth:L,snareBedRadius:j}),Ya({radius:s,snareBedAngle:V,snareBedDepth:L,snareBedRadius:j}).rotate(180)];O.bearingEdgesBottom=O.bearingEdgesBottom.map(X=>($.forEach(te=>{const ne=te.clone();X.shape=X.shape.cut(ne)}),X))}return O},Va=({shellConstants:t,drum:e,interlockingTabPockets:r,bearingEdgeVertexAngle:n,bearingEdgeThickness:o})=>{const{basePlane:s,bearingEdgeHeight:u,radius:c,tabVertexAngle:f,tabThickness:p,tabOuterRadius:g,tabFitmentToleranceDegrees:y}=t,{fitmentTolerance:m}=e,{shellThickness:S}=e.shell;let E=vr(c,n,o,u,s);if(o>S){const L=Wr({plane:Xe("XZ"),startRadius:c-S,chamferAngle:45,chamferWidth:o-S,chamferStartHeight:u,chamferUp:!1,edgeInner:!0});E=E.cut(L)}const k=u-10,x=Xe("XY",u-k),A=vr(g,f,p,k,x).rotate(-(n/2+f/2)),U=vr(g+m,f+y*2,p+m*2,k,x).rotate(n/2-f/2),O=E.fuse(A).cut(U);return r.reduce((L,j)=>L.cut(j),O)},Ya=({radius:t,snareBedRadius:e,snareBedAngle:r,snareBedDepth:n})=>Fn(e).sketchOnPlane("XZ").extrude(100).translateY(t+25).translateZ(-e+n).rotate(-r,[0,t,n],[1,0,0]),sd=(t,e,r,n,o)=>{const s=za(t),u=30,c=s-u*2,f=za(e)/2,p=10,g=Math.floor(n/3),y=Xe("XY",0),m=Xe("XY",u);return{bearingEdgeHeight:u,bearingEdgeSegmentCoverage:2,depth:s,radius:f,shellSegmentVertexAngle:360/r,shellSegmentHeight:c,shellCenterPoint:u+c/2,tabWidth:p,tabVertexAngle:zn(f,p),tabThickness:g,tabOuterRadius:f-(n-g)/2,tabFitmentToleranceDegrees:zn(f,o),interlockingTabHeight:10,diameterInches:e,shellThickness:n,fitmentTolerance:o,lugNumber:r,basePlane:y,shellSegmentPlane:m}},id=(t,e)=>{const{depthInches:r,diameterInches:n,shellThickness:o}=t.shell,{lugNumber:s}=t.lugs,u=sd(r,n,s,o,t.fitmentTolerance);return ad({shellConstants:u,drum:t,updateProgress:e})},ad=({shellConstants:t,drum:e,updateProgress:r})=>{r(.1,"Generating interlocking tabs");const{interlockingTabPockets:n,interlockingTabs:o}=nd({shellConstants:t,drum:e,updateProgress:r});r(.2,"Generating bearing edges");const{bearingEdgesTop:s,bearingEdgesBottom:u}=od({shellConstants:t,drum:e,interlockingTabPockets:n,updateProgress:r});r(.5,"Generating shell segments");const c=td({shellConstants:t,drum:e,interlockingTabPockets:n,updateProgress:r});return r(1,"Rendering model"),[...c,...o,...s,...u]};let Xa=!1;const $a=(async()=>{if(Xa)return Promise.resolve(!0);const t=await Au({locateFile:()=>Ou});return Xa=!0,Ru(t),!0})();let os;const ud=(t,e,r={tolerance:.01,angularTolerance:30})=>{if(e==="stl")return t.blobSTL(r);if(e==="stl-binary")return t.blobSTL({...r,binary:!0});if(e==="step")return t.blobSTEP();throw new Error(`Filetype "${e}" unknown for export.`)};function ld(){return $a.then(()=>os.map(({shape:t,name:e})=>({blob:ud(t,"stl"),name:e})))}function cd(t,e,r){return $a.then(()=>(os=id(t,e),os)).then(n=>n.filter(({shape:o})=>!(o instanceof Oe)||o.innerShape).map(({name:o,shape:s,color:u,strokeType:c,opacity:f})=>{const p={name:o,color:u,strokeType:c,opacity:f};try{p.mesh=s.mesh({tolerance:.1,angularTolerance:30}),p.edges=s.meshEdges({keepMesh:!0})}catch(g){return console.error(g),p.error=!0,p}return p})).then(n=>r(n))}rs({createBlobs:ld,createAssembly:cd})})();
